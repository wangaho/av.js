!function(a){function c(a,b){("object"!=typeof b||null===b)&&(b={}),Object.defineProperty(this,"index",{value:h.compilerAutoIncrement,writable:!1,configurable:!1}),h.compilerAutoIncrement++,"number"==typeof a&&(a=String(a)),"string"!=typeof a&&(a=""),Object.defineProperty(this,"template",{value:a,writable:!1,configurable:!1}),Object.defineProperty(this,"element",{value:document.createElement("render"),writable:!1,configurable:!1}),this.commandState="undefined"==typeof b.commandState||b.commandState?!0:!1,this.renderState="undefined"==typeof b.renderState||b.renderState?!0:!1,this.observerState="undefined"==typeof b.observerState||b.observerState?!0:!1,this.parent=b.parent&&"object"==typeof b.parent&&b.parent.constructor==c?b.parent:void 0,this.parentAbstractNodeTree=b.parentAbstractNodeTree&&"object"==typeof b.parentAbstractNodeTree&&b.parentAbstractNodeTree.constructor==d?b.parentAbstractNodeTree:void 0,this.abstractNodeTree=e(this,this.template,0,this.parentAbstractNodeTree)}function d(a){Object.defineProperty(this,"index",{value:h.abstractNodeTreeAutoIncrement,writable:!1,configurable:!1}),h.abstractNodeTreeAutoIncrement++,this.node=null,this.compiler=null,this.templateIndex=-1,this.tagError=!1,this.tagBeforeFirstIndex=-1,this.tagBeforeLastIndex=-1,this.tagAfterFirstIndex=-1,this.tagAfterLastIndex=-1,this.tagBefore="",this.tagAfter="",this.tagContent="",this.tagLabel=void 0,this.tagComment=void 0,this.tagText=void 0,this.tagTextLength=0,this.command={},this.commandTemplate={},this.commandError=!1,this.commandWarning=!1,this.commandValue={},this.attribute={},this.attributeTemplate={},this.eventListener={},this.renderFunction=void 0,this.parent=a,this.children=[],this.nodeName="",this.nodeType="",this.nodeVoid=!1,this.lastTemplateError="",this.lastTemplateWarning="",this.deleted=!1}function e(a,b,c,f){var g,h;for(c=c?c:0,g=[];;){if("number"==typeof b&&(b=String(b)),"string"!=typeof b||""==b)break;if(h=new d(f),e.match(h,b,0),h.templateIndex=c,h.compiler=a,g=h.tagError?e.tagErrorTrue(g,h,b):e.tagErrorFalse(g,h,b),(h.isLabel()||h.tagError&&h.tagBeforeLastIndex>=0)&&h.tagBeforeLastIndex>=0&&h.tagBeforeLastIndex<b.length)b=b.substr(h.tagBeforeLastIndex),c=h.tagBeforeLastIndex+h.templateIndex;else if(h.tagAfterLastIndex>=0&&h.tagAfterLastIndex<b.length)b=b.substr(h.tagAfterLastIndex),c=h.tagAfterLastIndex+h.templateIndex;else{if(!(h.tagBeforeFirstIndex>=0&&h.tagBeforeLastIndex<0&&h.tagBeforeFirstIndex+String("<").length<b.length))break;b=b.substr(h.tagBeforeFirstIndex+String("<").length),c=h.tagBeforeFirstIndex+String("<").length+h.templateIndex}}return g}function f(a){var d,e,g,b={compiler:a.compiler,abstractNodeTree:null,data:"object"!=typeof a.data||null===a.data?{}:a.data,refresh:a.refresh?!0:!1,onChange:null!==a.onChange&&"function"!=typeof a.onChange?function(){}:a.onChange,print:function(a){return"string"==typeof a||"number"==typeof a?a:""},encodeHTML:function(a){return w.encodeHTML(a)},decodeHTML:function(a){return w.decodeHTML(a)},argument:function(a,b,c){var d=b.toLowerCase();return"#abstractnodetree"==d||"#a"==d?a:"#node"==d||"#n"==d?a.node:"#template"==d||"#t"==d?a.templateLocation().content:"#event"==d||"#e"==d?c||r||window.event:"#value"!=d&&"#v"!=d||!a.node||"undefined"==typeof a.node.value?void 0:a.node.value}},c=null;for(a.selector&&null!==a.selector&&("object"==typeof a.selector&&(a.selector.constructor==Array||a.selector instanceof HTMLElement)?c=a.selector:("string"==typeof a.selector||"number"==typeof a.selector)&&(d=document.querySelectorAll(a.selector),d.length&&d[0]&&(c=d[0]))),c||(c=a.compiler.element),e=f.setting({group:a.compiler.abstractNodeTree}),g=0;g<a.compiler.abstractNodeTree.length;g++)e.index=g,f.node(c,a.compiler.abstractNodeTree[g],b,e);return c}function g(a){var b;return a&&"object"==typeof a&&null!==a?(a.constructor==Object?b=Object.keys(a).length:a.constructor==Array&&(b=a.length),Object.defineProperty(this,"length",{value:b,writable:!0,enumerable:!1}),Object.defineProperty(this,"props",{value:new Object,writable:!0,enumerable:!1}),Object.defineProperty(this,"notify",{value:new Object,writable:!0,enumerable:!1}),void 0):!1}function h(a,b){return new c(a,b)}function j(){this.protocol="",this.account="",this.domain="",this.host="",this.path="",this.query="",this.fragmentPath="",this.fragmentQuery="",this.fragment="",this.location="",this.link="",this.href="",this.scheme="",this.user="",this.password="",this.domainName="",this.port="",this.pathStruct=new Array,this.queryStruct=new Object,this.fragmentPathStruct=new Array,this.fragmentQueryStruct=new Object,this.fragmentExist=void 0,this.isFile=!1,this.isAbsolute=!1}function l(){var b,a=new j;if(0==arguments.length)l.parse(a,window.location.href);else for(b in arguments)arguments[b]&&("string"==typeof arguments[b]?l.parse(a,arguments[b]):"object"==typeof arguments[b]&&l.merge(a,arguments[b]));return l.build(a),a}function m(){this.element=void 0,this.file="",this.query="",this.charset="UTF-8",this.type="",this.selector="head",this.unique=!0}function n(a){var b=new m;return n.merge(b,a),n.createElement(b),b}function o(){this.XMLHttpRequest=void 0,this.url=window.location.href,this.method="GET",this.async=!0,this.data=void 0,this.header={"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},this.timeout=void 0,this.type=""}function p(a){var b=new o;return a&&"object"==typeof a&&p.merge(b,a),b}function q(a,b){var c,d,e,f,g;if("page"===a){if(q.prototype.pageList.callback(),q.prototype.pageList.callback=function(){},c=v.getHistoryPageMaximum(),1>c)return!1;if(d={title:document.title,router:b},e=q.prototype.pageList.back.length,1>e?q.prototype.pageList.back.push(d):(f=q.prototype.pageList.back[e-1],f.router.href!=b.href&&(e>c&&q.prototype.pageList.back.shift(),q.prototype.pageList.back.push(d))),e=q.prototype.pageList.forward.length,1>e)return!1;g=q.prototype.pageList.forward[e-1],g.router.href==b.href&&q.prototype.pageList.forward.splice(e-1,1)}else if("router"===a){if(q.prototype.routerList.callback(),q.prototype.routerList.callback=function(){},c=v.getHistoryRouterMaximum(),1>c)return!1;if(d={title:document.title,router:b},e=q.prototype.routerList.back.length,1>e?q.prototype.routerList.back.push(d):(f=q.prototype.routerList.back[e-1],f.router.href!=b.href&&(e>c&&q.prototype.routerList.back.shift(),q.prototype.routerList.back.push(d))),e=q.prototype.routerList.forward.length,1>e)return!1;g=q.prototype.routerList.forward[e-1],g.router.href==b.href&&q.prototype.routerList.forward.splice(e-1,1)}}function r(a){for(var b in a)this[b]=a[b]}function s(a){Object.defineProperty(this,"index",{value:t.autoIncrement,writable:!1,configurable:!1}),t.autoIncrement++,Object.defineProperty(this,"name",{value:a,writable:!1,configurable:!1}),this.data=new Object,this.parent=void 0,this.children=new Array}function t(a){var b=v();return"object"!=typeof a&&(a=new Object),"string"!=typeof a.name&&"number"!=typeof a.name&&(a.name=t.getUniqueName(b)),"undefined"==typeof b.project[a.name]&&t.create(a.name,a),b.project[a.name]}function u(){this.history=new q,this.pageProject=void 0,this.pageRouter=void 0,this.page=new Object,this.project=new Object,this.include=new Object,this.exec=function(){return v.monitor(),v.page(),this}}function v(a){return"undefined"==typeof v.instance&&Object.defineProperty(v,"instance",{value:new u,writable:!1,configurable:!1}),a&&v.setPrototype(a),v.instance}function w(){return t.find.apply(t.find,arguments)}c.prototype={constructor:c,render:function(a,b){var c,d;return b&&"object"==typeof b||(b={}),c={compiler:this,data:"object"!=typeof a||null===a?{}:a,selector:"undefined"==typeof b.selector?void 0:b.selector,refresh:"undefined"==typeof b.refresh?void 0:b.refresh,onChange:"undefined"==typeof b.onChange?void 0:b.onChange},(b.observerStart||"undefined"==typeof b.observerStart)&&(d=b.observerReload?!0:!1,h.observerStart(c.data,d)),f(c)},reload:function(){return this.abstractNodeTree=e(this,this.template,0,this.parentAbstractNodeTree),this}},d.prototype={constructor:d,templateLocation:function(){var a={content:"",start:0,length:0};return a.start=this.tagBeforeFirstIndex>0?this.templateIndex+this.tagBeforeFirstIndex:this.templateIndex,a.length=this.isText()?this.tagTextLength:this.isLabel()?this.tagLabel.length:this.tagError?this.tagBeforeLastIndex-this.tagBeforeFirstIndex:this.tagAfterLastIndex-this.tagBeforeFirstIndex,a.content=this.compiler.template.substr(a.start,a.length),a},templateError:function(a,b,c){this.lastTemplateError="[templateError]:“"+w.decodeHTML(a)+"” "+b+"\n------------------------------------\n"+this.templateLocation().content+"\n------------------------------------\n",c&&(this.commandError=!0),console.error(this.lastTemplateError)},templateWarning:function(a,b,c){this.lastTemplateWarning="[templateWarning]:“"+w.decodeHTML(a)+"” "+b+"\n------------------------------------\n"+this.templateLocation().content+"\n------------------------------------\n",c&&(this.commandWarning=!0),console.warn(this.lastTemplateWarning)},createNode:function(){if("comment"==this.nodeType)this.node=document.createComment(this.tagContent);else if("text"==this.nodeType)this.node=document.createTextNode(w.decodeHTML(this.tagText));else{if("element"!=this.nodeType)return!1;this.node=document.createElement(this.nodeName);for(var a in this.attribute)this.node.setAttribute(a,this.attribute[a])}return!0},remove:function(){if(this.node&&this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.children&&this.children.length)for(var a in this.children)try{this.children[a].remove()}catch(b){console.log(b,this)}this.deleted=!0},clear:function(){if(this.node&&this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.children&&this.children.length)for(var a in this.children)try{this.children[a].clear()}catch(b){console.log(b,this)}},removeChild:function(a){var b,c;for(a=parseInt(a),isNaN(a)&&(a=0),b=0,c=a;c<this.children.length;c++)this.children[c].remove(),b++;b>0&&this.children.splice(a,b)},clearChild:function(a){var b,c;for(a=parseInt(a),isNaN(a)&&(a=0),b=0,c=a;c<this.children.length;c++)this.children[c].clear(),b++},isError:function(){return this.lastTemplateError||this.commandError?(this.clear(),!0):!1},isVoid:function(){return this.command&&this.command["void"]||"av-void"==this.nodeName.toLowerCase()||this.nodeVoid?!0:!1},isLabel:function(){return"undefined"!=typeof this.tagLabel?!0:!1},isComment:function(){return"undefined"!=typeof this.tagComment?!0:!1},isText:function(){return"undefined"!=typeof this.tagText?!0:!1},isStylesheet:function(){return"style"==this.nodeName&&"element"==this.nodeType?!0:!1},isTextarea:function(){return"textarea"==this.nodeName&&"element"==this.nodeType?!0:!1},isRenderState:function(){return!this.compiler.renderState||this.compiler.parent&&!this.compiler.parent.renderState?!1:!0},isObserverState:function(){return!this.compiler.observerState||this.compiler.parent&&!this.compiler.parent.observerState?!1:!0}},e.tagErrorTrue=function(a,b,c){var d;return b.tagBeforeFirstIndex<0?""!=c.replace(/\s+/g,"")&&(a=a.concat(e.createTextNode(b,c))):b.tagBeforeFirstIndex>=0&&b.tagBeforeLastIndex<0?(d=c.substr(0,b.tagBeforeFirstIndex+String("<").length),""!=d.replace(/\s+/g,"")&&(a=a.concat(e.createTextNode(b,d)))):b.tagBeforeLastIndex>=0&&""==b.nodeName?(d=c.substr(0,b.tagBeforeLastIndex),""!=d.replace(/\s+/g,"")&&(a=a.concat(e.createTextNode(b,d)))):b.tagBeforeLastIndex>=0&&""!=b.nodeName&&(d=c.substr(0,b.tagBeforeFirstIndex),""!=d.replace(/\s+/g,"")&&(a=a.concat(e.createTextNode(b,d))),a.push(e.createElement(b))),a},e.tagErrorFalse=function(a,b,c){var g,h,f=c.substr(0,b.tagBeforeFirstIndex);return""!=f.replace(/\s+/g,"")&&(g=new d(b.parent),g.templateIndex=b.templateIndex,g.compiler=b.compiler,a=a.concat(e.createTextNode(g,f))),b.isComment()?a.push(e.createComment(b)):b.isLabel()?a.push(e.createElement(b)):(b=e.createElement(b),b&&b.command&&(b.command["for"]||b.command["template"])||(h=b.command["print"]?e.createPrintNode(b):e(b.compiler,b.tagContent,b.tagBeforeLastIndex+b.templateIndex,b),"object"==typeof h&&(b.children=b.children.concat(h))),a.push(b)),a},e.match=function(a,b,c){var d,e,f,g,h,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(a.tagBeforeFirstIndex=b.indexOf("<",c),a.tagBeforeFirstIndex<0)return a.tagError=!0,a;if("<!--"==b.substr(a.tagBeforeFirstIndex,4))return a.tagBeforeLastIndex=a.tagBeforeFirstIndex+String("<!--").length,a.tagAfterFirstIndex=b.indexOf("-->",a.tagBeforeFirstIndex),a.tagAfterFirstIndex<0?(a.tagError=!0,a):(a.tagAfterLastIndex=a.tagAfterFirstIndex+String("-->").length,a.tagComment=b.substr(a.tagBeforeFirstIndex,a.tagAfterLastIndex-a.tagBeforeFirstIndex),a.tagContent=b.substr(a.tagBeforeLastIndex,a.tagAfterFirstIndex-a.tagBeforeLastIndex),a);for(d=a.tagBeforeFirstIndex,e=void 0,f=void 0,g=void 0,h=void 0;;){if(e=b.indexOf(">",d),0>e)break;if(f=b.substr(a.tagBeforeFirstIndex,e-a.tagBeforeFirstIndex),m=(new Date).valueOf(),n="__TEMP_ESCAPE_SINGLE_QUOTES"+m+"__",o="__TEMP_ESCAPE_DOUBLE_QUOTES"+m+"__",p="__TEMP_SINGLE_QUOTES"+m+"__",q="__TEMP_DOUBLE_QUOTES"+m+"__",f=f.replace(/\\'/g,n),f=f.replace(/\\"/g,o),f=f.replace(/\'([^\']{0,})\'/g,p),f=f.replace(/\"([^\"]{0,})\"/g,q),g=f.match(/\'/g),h=f.match(/\"/g),!g&&!h){a.tagBeforeLastIndex=e+String(">").length;break}d=e+String(">").length}if(a.tagBeforeLastIndex<0)return a.tagError=!0,a;if(a.tagBefore=b.substr(a.tagBeforeFirstIndex,a.tagBeforeLastIndex-a.tagBeforeFirstIndex),a.tagBefore.match(/\/\s{0,}\>$/)&&(a.tagLabel=a.tagBefore),r=/^\<\s{0,}([^\<\>\s\/]+)/.exec(a.tagBefore),r&&(a.nodeName=r[1]),""==a.nodeName||!/^[\w\d\-\_]+$/.test(a.nodeName))return a.nodeName="",a.tagError=!0,a;if("undefined"!=typeof a.tagLabel)return a;for(s="</"+a.nodeName,t=a.nodeName.replace("-","\\-"),u=new RegExp("(\\<"+t+"\\s{1,}|\\<"+t+"\\s{0,}\\>)","g"),v=new RegExp("\\<\\/"+t+"\\s{0,}\\>","g"),w=new RegExp("\\<"+t+"\\s{0,}([^\\<\\>]+)?\\/\\s{0,}\\>","g"),x=void 0,y=void 0,z=a.tagBeforeLastIndex,e=void 0,A=void 0,B=void 0,f=void 0;;){if(e=b.indexOf(s,z),0>e)break;if(z=e+s.length,A=b.indexOf(">",e),!(0>A)&&(B=b.substr(e,A-e+String(">").length),B=B.replace(/\s+/g,""),s+String(">")===B&&(f=b.substr(a.tagBeforeLastIndex,e-a.tagBeforeLastIndex),m=(new Date).valueOf(),n="__TEMP_ESCAPE_SINGLE_QUOTES"+m+"__",o="__TEMP_ESCAPE_DOUBLE_QUOTES"+m+"__",p="__TEMP_SINGLE_QUOTES"+m+"__",q="__TEMP_DOUBLE_QUOTES"+m+"__",C="__TEMP_LABEL"+m+"__",f=f.replace(/\\'/g,n),f=f.replace(/\\"/g,o),f=f.replace(/\'([^\']+)\'/g,p),f=f.replace(/\"([^\"]+)\"/g,q),f=f.replace(w,C),x=f.match(u),y=f.match(v),!y&&!x||y&&x&&y.length==x.length))){a.tagAfterFirstIndex=e,a.tagAfterLastIndex=A+String(">").length;break}}return a.tagAfterFirstIndex<0?(a.tagError=!0,a):(a.tagAfter=b.substr(a.tagAfterFirstIndex,a.tagAfterLastIndex-a.tagAfterFirstIndex),a.tagContent=b.substr(a.tagBeforeLastIndex,a.tagAfterFirstIndex-a.tagBeforeLastIndex),a)},e.filter=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(!w.isString(a)||""===a)return a;for(c=a,d=(new Date).valueOf(),e="__TEMPORARY_FILTER_SINGLE_QUOTES_"+d+"__",f="__TEMPORARY_FILTER_DOUBLE_QUOTES_"+d+"__",c=c.replace(/\\'/g,e),c=c.replace(/\\"/g,f),g=/\'([^\']{0,})\'/g,h=/\"([^\"]{0,})\"/g,i=0,j="__TEMPORARY_FILTER_STRING_"+d+"__",k="",l=new Array,m="",n="";;){if(i++,k=j+i+"__",exec=g.exec(c),exec||(exec=h.exec(c)),!exec)break;l.push({regexp:k,replacement:exec[0]}),m=c.substr(0,exec.index),n=c.substr(exec.index+exec[0].length,exec.input.length-(exec.index+exec[0].length)),c=m+k+n}return b(c,l,e,f)},e.filterRecover=function(a,b,c,d){var f,g,h,e=null;for(f=b.length-1;f>=0;f--)e=new RegExp(b[f].regexp,"g"),a=a.replace(e,b[f].replacement);return g=new RegExp(c,"g"),h=new RegExp(d,"g"),a=a.replace(g,"\\'"),a=a.replace(h,'"')},e.createComment=function(a){return a.nodeType="comment",a},e.createPrintNode=function(a){var b,e;return""==a.tagContent?!1:a.attributeTemplate["av-text"]?(b=new d(a),b.templateIndex=a.tagBeforeLastIndex+a.templateIndex,b.compiler=a.compiler,b.tagTextLength=a.tagContent.length,b.nodeType="text",b.tagText=w.encodeHTML(a.tagContent),new Array(b)):a.attributeTemplate["av-html"]?(e=new c(a.tagContent,{commandState:!1,parent:a.compiler,parentAbstractNodeTree:a}),e.abstractNodeTree):!1},e.createTextNode=function(a,b){for(var c=new Array,f=/(\{\s{0,}\{[^\}\{]+\}\s{0,}\}|\{\s{0,}html\s{0,}\{[^\}\{]+\}\s{0,}\})/i,g=b,h=void 0,i=void 0,j=void 0,k=void 0;!a.isError()&&(h=f.exec(g))&&(h.index>0&&(i=new d(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=g.substr(0,h.index),i.tagTextLength=b.length,i.nodeType="text",c.push(i)),i=new d(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=h[1],i.tagTextLength=b.length,i.nodeType="text",e.createCommand(i,"{{}}",h[1],h[1]),c.push(i),j=h.index+h[0].length,k=h.input.length-j,g=g.substr(j,k),g&&!(g.length<=4)););return""!=g&&(i=new d(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=g,i.tagTextLength=b.length,i.nodeType="text",c.push(i)),c.length||(a.tagText=b,a.tagTextLength=b.length,a.nodeType="text",c.push(a)),c},e.createElement=function(a){return a.nodeType="element",a.tagBefore?(e.filter(a.tagBefore,function(b,c,d,f){var g,h,i,j,l;for(b=b.replace(/^(\<\s{0,})/,"").replace(/(\s{0,}\/?\s{0,}\>)$/,""),g=void 0,h=!0;;){if(g=/([^\s]+\s{0,}\=\s{0,}[^\s]+|[^\s]+)/.exec(b),!g)break;b=b.substr(g.index+g[0].length,g.input.length-g[0].length),h?h=!1:(i=g[1].split(/\=/),"undefined"==typeof i[1]?(j="",l=i[0]):(j=e.filterRecover(i[1],c,d,f),l=i[0]+"="+j,j=w.trim(j),j=0===j.search(/\"/)?j.replace(/(^\"|\"$)/g,""):j.replace(/(^\'|\'$)/g,"")),k=w.trim(i[0]),e.createCommand(a,k,j,l))}}),a):a},e.createCommand=function(a,b,c,d){if(a.isError())return!1;var f=b.toLowerCase();if(d=d.replace(/(^\s+)|(\s+$)/g,""),"undefined"==typeof a.attributeTemplate[f]&&(a.attributeTemplate[f]=new Array),a.attributeTemplate[f].push(d),a.compiler.commandState){if("av-if"==f||"av-elseif"==f||"av-else-if"==f||"av-else"==f)return e.commandIf(a,b,c,d,f);if("{{}}"==f)return e.commandPrint(a,b,c,d,f);if("av-text"==f)return e.commandPrintText(a,b,c,d,f);if("av-html"==f)return e.commandPrintHtml(a,b,c,d,f);if("av-for"==f)return e.commandFor(a,b,c,d,f);if("av-is"==f)return e.commandIs(a,b,c,d,f);if("av-attr"==f||"av-attribute"==f)return e.commandAttribute(a,b,c,d,f);if("av-event"==f)return e.commandEvent(a,b,c,d,f);if("av-class"==f)return e.commandClass(a,b,c,d,f);if("av-style"==f)return e.commandStyle(a,b,c,d,f);if("av-template"==f)return e.commandTemplate(a,b,c,d,f);if("av-void"==f)return e.commandVoid(a,b,c,d,f);if("av-before"==f)return e.commandBefore(a,b,c,d,f);if("av-after"==f)return e.commandAfter(a,b,c,d,f)}return a.attribute[b]=c,!0},e.createFunction=function(a,b,c,d){return function(){try{return new Function("$callback","$event",c)}catch(e){return"warning"==d?a.templateWarning(b,e+"\n",!0):a.templateError(b,e+"\n",!0),!1}}()},e.commandIf=function(a,b,c,d,f){var g,h,i,j,k;return d=w.encodeHTML(d),"undefined"!=typeof a.command["if"]||"undefined"!=typeof a.command["elseif"]||"undefined"!=typeof a.command["else"]?a.templateWarning(d,"if、else if、else 命令不能在同一个标签中同时存在或存在多个"):"av-else"==f?(a.command["else"]=!0,a.commandTemplate["else"]=w.decodeHTML(d),!0):"av-if"==f&&""==c.replace(/\s/g,"")?a.templateWarning(d,"if 命令不能为空",!0):"av-elseif"!=f&&"av-else-if"!=f||""!=c.replace(/\s/g,"")?(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=e.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (Boolean(function(){try{return "+i+";}catch(e){"+h+'.abstractNodeTree.templateError("'+d+'",e);return false;}}()));\n',j+="}",k=e.createFunction(a,d,j),"function"!=typeof k?!1:("av-if"==f?(a.command["if"]=k,a.commandTemplate["if"]=w.decodeHTML(d)):(a.command["elseif"]=k,a.commandTemplate["elseif"]=w.decodeHTML(d)),void 0)):a.templateWarning(d,"else if命令不能为空",!0)},e.commandPrint=function(a,b,c,d){var g,h,i,j,k,l,m,n;return d=w.encodeHTML(d),c=c.replace(/(^\s+|\s+$)/g,""),g=/\{\s{0,}([^\{\}]+)?\{([^\{\}]+)\}\s{0,}\}/,(h=g.exec(c))?(h[1]&&(h[1]=h[1].replace(/(^\s+|\s+$)/g,"").toLowerCase()),i=w.trim(h[2]),j=(new Date).valueOf(),k="$_TEMPORARY_THIS_"+j+"_",l=e.getCommandArguments(k,i),m="var "+k+"=this;\n",m+="with(this.data){\n",m+="	 try{\n",m+="html"==h[1]?"		 return "+k+".print("+l+");\n":"		 return "+k+".print("+k+".encodeHTML("+l+"));\n",m+="	 }catch(e){\n",m+="		 "+k+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',m+="	 }\n",m+="}",n=e.createFunction(a,d,m),"function"!=typeof n?!1:(a.nodeVoid=!0,a.command["print"]=n,a.commandTemplate["print"]=w.decodeHTML(d),void 0)):a.templateError(d,"{{ }}声明错误。示例：{{var}}、{html{var}}",!0)},e.commandPrintHtml=function(a,b,c,d){var g,h,i,j,k;return d=w.encodeHTML(d),"undefined"!=typeof a.command["print"]?a.templateWarning(d,"av-html、av-text 命令不能在同一个标签中同时存在或存在多个"):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=e.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="		 return "+h+".print("+i+");\n",j+="		 }catch(e){\n",j+="		 "+h+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',j+="		 }\n",j+="	 }());\n",j+="}",k=e.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["print"]=k,a.commandTemplate["print"]=w.decodeHTML(d),void 0))},e.commandPrintText=function(a,b,c,d){var g,h,i,j,k;return d=w.encodeHTML(d),"undefined"!=typeof a.command["print"]?a.templateWarning(d,"av-html、av-text 命令不能在同一个标签中同时存在或存在多个"):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=e.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="		 return "+h+".print("+h+".encodeHTML("+i+"));\n",j+="		 }catch(e){\n",j+="		 "+h+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',j+="		 }\n",j+="	 }());\n",j+="}",k=e.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["print"]=k,a.commandTemplate["print"]=w.decodeHTML(d),void 0))},e.commandTemplate=function(a,b,c,d){var g,h,i,j,k,l;if(d=w.encodeHTML(d),"undefined"!=typeof a.command["template"])return a.templateWarning(a,d,"template 命令不能在同一个标签中存在多个");if(""!=c){if(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i="$_TEMPORARY_STRING_"+g+"_",j=e.getCommandArguments(h,c),k="var "+h+"=this;\n",k+="with(this.data){\n",k+="	 return (function(){\n",k+="		 try{\n",k+="		 var "+i+"="+j+";\n",k+="		 if(typeof "+i+" == 'string'){\n",k+="			 return "+i+";\n",k+="		 }else{\n",k+="			 throw '"+c.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是字符串';\n",k+="		 }\n",k+="		 }catch(e){\n",k+="		 "+h+'.abstractNodeTree.templateWarning("'+d+'",e);return ""; \n',k+="		 }\n",k+="	 }());\n",k+="}",l=e.createFunction(a,d,k),"function"!=typeof l)return!1}else l=function(){return""};a.command["template"]=l,a.commandTemplate["template"]=w.decodeHTML(d)},e.commandFor=function(a,b,c,d){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,x,y;return d=w.encodeHTML(d),"undefined"!=typeof a.command["for"]?a.templateWarning(d,"for 命令不能在同一个标签中存在多个"):""==c.replace(/\s/g,"")?a.templateError(d,"for 命令不能为空",!0):(g=void 0,h=void 0,i=void 0,j=!1,k="",l=/\s{0,}\(([^\(\)\,]+)\,([^\(\)\,]+)\)\s{0,}([^\(\)\s]+)\s{0,}(\([^\(\)]{0,}\))?\s{0,}/,m=l.exec(c),m?(h=m[1].replace(/(^\s+|\s+$)/g,""),g=m[2].replace(/(^\s+|\s+$)/g,""),i=m[3].replace(/(^\s+|\s+$)/g,""),m[4]&&(j=!0,k=m[4])):(l=/\s{0,}\(([^\(\)\,]+)\)\s{0,}([^\(\)\s]+)\s{0,}(\([^\(\)]{0,}\))?\s{0,}/,m=l.exec(c),m&&(h=m[1].replace(/(^\s+|\s+$)/g,""),i=m[2].replace(/(^\s+|\s+$)/g,""),m[3]&&(j=!0,k=m[3]))),i&&h?(j&&(i+=k),n=(new Date).valueOf(),o="$_TEMPORARY_THIS_"+n+"_",p="$_TEMPORARY_CALLBACK_"+n+"_",q="$_TEMPORARY_FOR_OBJECT_"+n+"_",r="$_TEMPORARY_FOR_INDEX_"+n+"_",s="$_TEMPORARY_FOR_NUMBER_"+n+"_",t="'"+h+"'",u="undefined"!=typeof g?"'"+g+"'":"undefined",v=e.getCommandArguments(o,i),x="var "+o+"=this;\n",x+="var "+p+"=$callback;\n",x+="with(this.data){\n",x+="	 return (function(){\n",x+="		 try{\n",x+="			 if(typeof "+o+".data."+h+"!='undefined')"+" throw '"+h+" 是渲染数据的属性，不能定义为遍历单元值的别名称';\n","undefined"!=typeof g&&(x+="			 if(typeof "+o+".data."+g+"!='undefined')"+" throw '"+g+" 是渲染数据的属性，不能定义为遍历单元键的别名称';\n"),x+="			 var "+q+"="+v+";\n",x+="			 if(typeof "+q+"!='object') "+"throw '"+i.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是一个对象，无法进行遍历操作';\n",x+="			 if("+q+" && "+q+".constructor == Array){\n",x+="				 for(var "+r+"=0; "+r+"<"+q+".length; "+r+"++){\n","undefined"!=typeof g&&(x+="					 "+o+".data."+g+"="+r+"; \n"),x+="					 "+o+".data."+h+"="+q+"["+r+"]; \n",x+="					 "+p+"("+o+","+r+","+q+","+r+","+t+","+u+"); \n",x+="				 }\n",x+="			 }else{\n",x+="				 var "+s+"=0;\n",x+="				 for(var "+r+" in "+q+"){\n","undefined"!=typeof g&&(x+="					 "+o+".data."+g+"="+r+"; \n"),x+="					 "+o+".data."+h+"="+q+"["+r+"]; \n",x+="					 "+p+"("+o+","+s+","+q+","+r+","+t+","+u+"); \n",x+="					 "+s+"++;\n",x+="				 }\n",x+="			 }\n",x+="			 if(typeof "+o+".data."+h+" != 'undefined') delete "+o+".data."+h+";\n","undefined"!=typeof g&&(x+="			 if(typeof "+o+".data."+g+" != 'undefined') delete "+o+".data."+g+";\n"),x+="		 }catch(e){\n",x+="			 "+o+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',x+="		 }\n",x+="	 }());\n",x+="}",y=e.createFunction(a,d,x),"function"!=typeof y?!1:(a.command["for"]=y,a.commandTemplate["for"]=w.decodeHTML(d),void 0)):a.templateError(d,'for 命令错误。示例：av-for="(value,index) Object"、av-for="(value) Object"、av-for="(value,index) Object()"、av-for="(value) Object()"',!0))},e.commandIs=function(a,b,c,d,f){var g,h,i,j,k;return d=w.encodeHTML(d),"undefined"!=typeof a.command["is"]?a.templateWarning(d,"is 命令不能在同一个标签中同时存在或存在多个"):"av-is"==f&&""==c.replace(/\s/g,"")?a.templateError(d,"is 命令不能为空",!0):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=e.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (Boolean(function(){try{return "+i+";}catch(e){"+h+'.abstractNodeTree.templateError("'+d+'",e);return false;}}()));\n',j+="}",k=e.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["is"]=k,a.commandTemplate["is"]=w.decodeHTML(d),void 0))},e.commandVoid=function(a,b,c,d){a.command["void"]=!0,a.commandTemplate["void"]=w.decodeHTML(d)},e.commandAttribute=function(a,b,c,d){var g,h;return d=w.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"attribute 命令不能为空"):(h=e.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(e.setCommandAppend(a,"attribute",h),e.setCommandTemplate(a,"attribute",w.decodeHTML(d)),void 0))},e.commandClass=function(a,b,c,d){var g,h;return d=w.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"class 命令不能为空"):(h=e.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(e.setCommandAppend(a,"class",h),e.setCommandTemplate(a,"class",w.decodeHTML(d)),void 0))},e.commandStyle=function(a,b,c,d){var g,h;return d=w.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"style 命令不能为空"):(h=e.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(e.setCommandAppend(a,"style",h),e.setCommandTemplate(a,"style",w.decodeHTML(d)),void 0))},e.commandEvent=function(a,b,c,d){var g,h,i,j,k,l,m,n,o,p,q,r;if(d=w.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g)return a.templateWarning(d,"event 命令不能为空");if(h=/^\[([^\[\]]+)\]\s{0,}(.*)?/i,i=h.exec(g),!i)return a.templateWarning(d,"event 命令不合法");if(i[1]=w.trim(i[1]),""==i[1])return a.templateWarning(d,"event 命令缺少事件名称");if(j=i[1].split(/\s+/),k=i[2],l=(new Date).valueOf(),m="$_TEMPORARY_THIS_"+l+"_",n="$_TEMPORARY_EVENT_"+l+"_",o=e.getCommandArguments(m,k,n),p="var "+m+"=this;\n",p+="var "+n+"=$event;\n",p+="with(this.data){\n",p+="	 return (function(){\n",p+="		 try{\n",p+="			 return "+o+";\n",p+="		 }catch(e){\n",p+="			 "+m+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',p+="		 }\n",p+="	 }());\n",p+="}",q=e.createFunction(a,d,p,"warning"),"function"!=typeof q)return!1;e.setCommandTemplate(a,"event",w.decodeHTML(d)),"undefined"==typeof a.command["event"]&&(a.command["event"]=new Object);for(r in j)"undefined"==typeof a.command["event"][j[r]]&&(a.command["event"][j[r]]=new Array),a.command["event"][j[r]].push(q)},e.commandBefore=function(a,b,c,d){var g,h;return d=w.encodeHTML(d),g=w.trim(c),""==g?a.templateWarning(d,"before 命令不能为空"):(h=e.setBeforeAfterFunction(a,b,g,d),"function"!=typeof h?!1:(e.setCommandAppend(a,"before",h),e.setCommandTemplate(a,"before",w.decodeHTML(d)),void 0))},e.commandAfter=function(a,b,c,d){var g,h;return d=w.encodeHTML(d),g=w.trim(c),""==g?a.templateWarning(d,"after 命令不能为空"):(h=e.setBeforeAfterFunction(a,b,g,d),"function"!=typeof h?!1:(e.setCommandAppend(a,"after",h),e.setCommandTemplate(a,"after",w.decodeHTML(d)),void 0))},e.setBeforeAfterFunction=function(a,b,c,d){var f=(new Date).valueOf(),g="$_TEMPORARY_THIS_"+f+"_",h=e.getCommandArguments(g,c),i="var "+g+"=this;\n";return i+="with(this.data){\n",i+="	 return (function(){\n",i+="		 try{\n",i+="			"+h+";\n",i+="		 }catch(e){\n",i+="			 "+g+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',i+="		 }\n",i+="	 }());\n",i+="}",e.createFunction(a,d,i,"warning")},e.setAttrClassStyleFunction=function(a,b,c,d){var f=(new Date).valueOf(),g="$_TEMPORARY_THIS_"+f+"_",h="$_TEMPORARY_OBJECT_"+f+"_",i=e.getCommandArguments(g,c),j="var "+g+"=this;\n";return j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="			 var "+h+"="+i+";\n",j+="			 if(typeof "+h+" == 'object'){\n",j+="				 return "+h+";\n",j+="			 }else{\n",j+="				 throw '"+c.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是对象';\n",j+="			 }\n",j+="		 }catch(e){\n",j+="			 "+g+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',j+="		 }\n",j+="	 }());\n",j+="}",e.createFunction(a,d,j,"warning")},e.setCommandAppend=function(a,b,c){"undefined"==typeof a.command[b]&&(a.command[b]=new Array),a.command[b].push(c)},e.setCommandTemplate=function(a,b,c){"undefined"==typeof a.commandTemplate[b]&&(a.commandTemplate[b]=new Array),a.commandTemplate[b].push(c)},e.getCommandArguments=function(a,b,c){return e.filter(b,function(b,d,f,g){return b=b.replace(/\#\s{0,}(\w+)/g,a+".argument("+a+".abstractNodeTree,'#$1',"+c+")"),e.filterRecover(b,d,f,g)})},f.setting=function(a){var c,b={commands:void 0,group:void 0,index:-1,each:void 0,bound:f.boundClone()};if(a)for(c in a)"undefined"!=typeof a[c]&&(b[c]=a[c]);return b},f.bound={global:{},props:{abstractNodeTree:void 0,command:void 0},notify:{abstractNodeTree:void 0,command:void 0}},f.boundClone=function(){var a={notify:{abstractNodeTree:f.bound.notify.abstractNodeTree,command:f.bound.notify.command}};return a},f.boundRecover=function(a){f.bound.notify.abstractNodeTree=a.notify.abstractNodeTree,f.bound.notify.command=a.notify.command},f.boundProps=function(a,b,c){f.bound.props.abstractNodeTree=a,f.bound.props.command=b;var d=c();return f.bound.props.abstractNodeTree=void 0,f.bound.props.command=void 0,d},f.boundNotify=function(a,b,c){if(f.bound.notify.abstractNodeTree&&f.bound.notify.command)return c();f.bound.notify.abstractNodeTree=a,f.bound.notify.command=b;var d=c();return f.bound.notify.abstractNodeTree=void 0,f.bound.notify.command=void 0,d},f.commandLogStorage=new Object,f.commandLog=function(a,b){if("undefined"==typeof f.commandLogStorage[a.index])f.commandLogStorage[a.index]=[b];else{var c=","+f.commandLogStorage[a.index].join(",")+",";c.indexOf(","+b+",")<0&&f.commandLogStorage[a.index].push(b)}},f.commandState=function(a,b,c){if(f.commandLog(a,c),"undefined"==typeof b.commands)return!0;for(var d in b.commands){if("if"==b.commands[d]||"is"==b.commands[d]||"print"==b.commands[d]||"for"==b.commands[d]||"template"==b.commands[d])return!0;if(b.commands[d]==c)return!0}return!1},f.node=function(a,b,c,d){var e,g,h;if(b.deleted)return b.remove(),b=null,!1;if(!b||b.commandError||!b.isRenderState())return!1;if(e=f.setting(d),b.renderFunction=function(d){"undefined"!=typeof d.commands&&(e.commands=d.commands),f.trigger(c,e,function(){c.refresh=!1,f.node(a,b,c,e),c.onChange(b,d)})},b.lastTemplateError="",c.abstractNodeTree=b,b.command["before"]){if(b.isError())return null;f.boundProps(b,"before",function(){f.commandBefore(b,c,d,"before")})}if(b.isError())return null;if(g=f.boundProps(b,"if",function(){return f.commandIf(b,c,d,"if")
}),!g)return!1;if(b.command["template"]){if(b.isError())return null;f.boundProps(b,"template",function(){f.commandTemplate(b,c,d,"template")})}if(b.command["for"])return b.isError()?null:f.boundProps(b,"for",function(){return f.commandFor(a,b,c,d,"for")});if(b.command["is"]){if(b.isError())return null;if(h=f.boundProps(b,"is",function(){return f.commandIs(b,c,d,"is")}),!h)return!1}if(b.command["print"]){if(b.isError())return null;f.boundProps(b,"print",function(){f.commandPrint(b,c,d,"print")})}if(b.isVoid())return b.isError()?null:f.boundProps(b,"void",function(){return f.commandVoid(a,b,c,d,"void")});if(!b.node&&!b.isVoid()){if(b.isError())return null;b.createNode()}if(b.node){if(b.command["attribute"]){if(b.isError())return null;f.boundProps(b,"attribute",function(){f.commandAttribute(b,c,d,"attribute")})}if(b.command["class"]){if(b.isError())return null;f.boundProps(b,"class",function(){f.commandClass(b,c,d,"class")})}if(b.command["style"]){if(b.isError())return null;f.boundProps(b,"style",function(){f.commandStyle(b,c,d,"style")})}if(b.command["event"]){if(b.isError())return null;f.boundProps(b,"event",function(){f.commandEvent(b,c,d,"event")})}if(b.isStylesheet()){if(b.isError())return null;f.boundProps(b,"stylesheet",function(){f.commandStylesheet(b,c,d,"stylesheet","stylesheet-notify")})}if(b.isTextarea()){if(b.isError())return null;f.boundProps(b,"textarea",function(){f.commandTextarea(b,c,d,"textarea","textarea-notify")})}}if(b.command["after"]){if(b.isError())return null;f.boundProps(b,"after",function(){f.commandAfter(b,c,d,"after")})}if(b.node&&!b.isStylesheet()&&!b.isTextarea()){if(b.isError())return null;f.boundProps(b,"childAbstractNodeTree",function(){f.childAbstractNodeTree(b,c,d,"childAbstractNodeTree")})}f.childNode(a,b,c,d)},f.trigger=function(a,b,c){var i,k,l,m,d=new Array,e=new Object,g=w.encodeHTML("av-for"),h=void 0;try{if(b.each&&b.each.length)for(i in b.each)if(h=b.each[i].abstractNodeTree,b.each[i].forObject,k=b.each[i].index,l=b.each[i].valueName,m=b.each[i].keyName,void 0!==l){if("undefined"==typeof e[l]){if("undefined"!=typeof a.data[l])throw l+" 是渲染数据的属性，不能定义为遍历单元值的别名称";e[l]=!0}if(a.data[l]=b.each[i].forObject[k],d.push(l),void 0!==m){if("undefined"==typeof e[m]){if("undefined"!=typeof a.data[m])throw m+" 是渲染数据的属性，不能定义为遍历单元键的别名称";e[m]=!0}a.data[m]=k,d.push(m)}}b.bound&&f.boundRecover(b.bound),c()}catch(n){h.templateError(g,n)}if(d.length)for(i in d)"undefined"!=typeof a.data[d[i]]&&delete a.data[d[i]]},f.childAbstractNodeTree=function(a,b,c,d){var e,g;if(!f.commandState(a,c,d))return!1;if(a.children&&a.children.length)for(e=f.setting({commands:c.commands,group:a.children,each:c.each}),g=0;g<a.children.length;g++)e.index=g,f.node(a.node,a.children[g],b,e)},f.childNode=function(a,b,c,d){if(!a||!b||!b.node)return!1;if(a instanceof HTMLElement&&b.node.parentNode!=a){b.node.parentNode&&b.node.parentNode.removeChild(b.node);try{var e=f.getBrotherAbstractNodeTree(a,b,c,d);e?a.insertBefore(b.node,e.node):a.appendChild(b.node)}catch(g){console.error(g)}return!0}},f.getBrotherAbstractNodeTree=function(a,b,c){var e,g,h,i,j,k,l;if("undefined"==typeof b)return void 0;if(!a.childNodes)return void 0;for(e=b,g=new Array,h=!1,i=2;i>0;){if(e.isVoid()||e.command["for"]||i--,"undefined"==typeof e.parent?(g=c.compiler.abstractNodeTree,h=!0):g=e.parent.children,g.length){for(j=!1,k=0;k<g.length;k++)if(!g[k].deleted)if(g[k].index!=e.index){if(j)if(g[k].isVoid()||g[k].command["for"]){if(l=f.getValidAbstractNodeTree(a,g[k].children))return l}else if(g[k].node&&g[k].node.parentNode==a)return g[k]}else j=!0}else if(h)return void 0;if("undefined"==typeof e.parent)return void 0;e=e.parent}},f.getValidAbstractNodeTree=function(a,b){var c,d;if(!b.length)return void 0;for(c=0;c<b.length;c++)if(!b[c].deleted)if(b[c].isVoid()||b[c].command["for"]){if(d=f.getValidAbstractNodeTree(a,b[c].children))return d}else if(b[c].node&&b[c].node.parentNode==a)return b[c];return void 0},f.eventListener=function(a,b,c,d,e){var e=e||r||window.event;f.trigger(b,c,function(){var c,f;b.refresh=!1,b.abstractNodeTree=a;for(c in d)f=d[c].apply(b,void 0,e),!1===f&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0})},f.nodeElementValue=function(a,b,c,d,e,g){var j,h=c+"Node",i=c+"Value";"undefined"==typeof a.commandValue[h]&&(a.commandValue[h]=document.createElement("div")),e||a.children&&a.children.length&&f.boundNotify(a,d,function(){var d,c=f.setting({group:a.children});for(d=0;d<a.children.length;d++)c.index=d,f.node(a.commandValue[h],a.children[d],b,c)}),j="undefined"!=typeof a.commandValue[h].textContent?a.commandValue[h].textContent:"undefined"!=typeof a.commandValue[h].innerText?a.commandValue[h].innerText:"",(a.commandValue[i]!=j||b.refresh)&&(g(j),a.commandValue[i]=j)},f.forTagBeforeClear=function(a){var d,b=a.tagBefore,c=a.attributeTemplate["av-for"];a.attributeTemplate["av-if"]&&(c=c.concat(a.attributeTemplate["av-if"])),a.attributeTemplate["av-elseif"]&&(c=c.concat(a.attributeTemplate["av-elseif"])),a.attributeTemplate["av-else-if"]&&(c=c.concat(a.attributeTemplate["av-else-if"])),a.attributeTemplate["av-else"]&&(c=c.concat(a.attributeTemplate["av-else"])),a.attributeTemplate["av-template"]&&(c=c.concat(a.attributeTemplate["av-template"]));for(d in c)b=b.replace(" "+c[d],"");return b},f.ifElseSyntax=function(a,b){var d,e,f,c=0;if("undefined"==typeof b.group||"undefined"==typeof b.index||0==b.index)return c;for(d=parseInt(b.index)-1,c=2,e=d;e>=0;e--)if(f=b.group[e],"element"==f.nodeType){if("undefined"!=typeof f.commandValue["if"]){f.command["if"].call(a),f.commandValue["if"]&&(c=1);break}"undefined"!=typeof f.commandValue["elseif"]?(f.command["elseif"].call(a),f.commandValue["elseif"]&&(c=1)):c=0}return c},f.commandIf=function(a,b,c,d){var e;if(a.command&&a.command["if"]){if(f.commandState(a,c,d)&&(a.commandValue["if"]=a.command["if"].call(b)),!a.commandValue["if"])return a.clear(),!1}else if(a.command&&a.command["elseif"]){if(e=f.ifElseSyntax(b,c),0==e)return a.clear(),a.templateError(w.encodeHTML("av-else-if/av-elseif"),"“else if”命令错误,必须是if接else if",!0),!1;if(f.commandState(a,c,d)&&(a.commandValue["elseif"]=a.command["elseif"].call(b)),1==e&&(a.commandValue["elseif"]=!1),!a.commandValue["elseif"])return a.clear(),!1}else if(a.command&&a.command["else"]){if(e=f.ifElseSyntax(b,c),0==e)return a.clear(),a.templateError(w.encodeHTML("av-else"),"“else”命令错误,必须是if、else if接else",!0),!1;if(a.commandValue["else"]=1==e?!1:!0,!a.commandValue["else"])return a.clear(),!1}return!0},f.commandTemplate=function(a,b,d,e){var g,h,i;if(!f.commandState(a,d,e))return null;if(g=a.command["template"].call(b),g=a.tagContent+g,"undefined"==typeof a.commandValue["template"]||a.commandValue["template"]!=g){if(a.commandValue["template"]=g,a.clear(),a.node&&a.node.childNodes)for(;a.node.childNodes.length;)a.node.removeChild(a.node.firstChild);a.removeChild(),a.children=new Array,a.command["for"]?(h=f.forTagBeforeClear(a),a.commandValue["forTemplate"]=h+a.commandValue["template"]+a.tagAfter):(i=new c(a.commandValue["template"],{parent:b.compiler,parentAbstractNodeTree:a}),a.children=i.abstractNodeTree)}},f.commandFor=function(a,b,d,e,g){var h,i,j;return f.commandState(b,e,g)?("undefined"==typeof b.commandValue["forTemplate"]&&(h=f.forTagBeforeClear(b),b.commandValue["forTemplate"]=h+b.tagContent+b.tagAfter,b.removeChild(),b.children=new Array),i=f.setting({group:b.children}),j=0,b.command["for"].call(d,function(h,k,l,m,n,o){if("undefined"==typeof b.children[k]){var p=new c(b.commandValue["forTemplate"],{parent:d.compiler,parentAbstractNodeTree:b});b.children.push(p.abstractNodeTree[0])}j++,i.index=k,i.each=new Array,w.isArray(e.each)&&(i.each=i.each.concat(e.each)),i.each.push({abstractNodeTree:b,forObject:l,index:m,valueName:n,keyName:o}),f.node(a,b.children[k],h,i),f.bound.props.abstractNodeTree=b,f.bound.props.command=g}),b.removeChild(j),null):null},f.commandIs=function(a,b,c,d){return f.commandState(a,c,d)&&(a.commandValue["is"]=a.command["is"].call(b)),a.commandValue["is"]?!0:(a.clear(),!1)},f.commandPrint=function(a,b,d,e){var g,h,i,j;if(g=f.commandState(a,d,e)?a.command["print"].call(b):a.commandValue["print"],"undefined"==typeof a.commandValue["print"]||a.commandValue["print"]!=g||b.refresh){if("object"==typeof a.commandValue["printAbstractNodeTree"]){for(h in a.commandValue["printAbstractNodeTree"]){for(i in a.children)if(a.children[i]==a.commandValue["printAbstractNodeTree"][h]){a.children.splice(i,1);break}a.commandValue["printAbstractNodeTree"][h].remove()}a.commandValue["printAbstractNodeTree"]=new Array}""!==g&&(j=new c(g,{commandState:!1,parent:b.compiler,parentAbstractNodeTree:a}),a.children=a.children.concat(j.abstractNodeTree),a.commandValue["printAbstractNodeTree"]=j.abstractNodeTree),a.commandValue["print"]=g}},f.commandVoid=function(a,b,c,d,e){var g,h;if(!f.commandState(b,d,e))return!1;for(g=f.setting({commands:d.commands,group:b.children,each:d.each}),h=0;h<b.children.length;h++)g.index=h,f.node(a,b.children[h],c,g);return null},f.commandAttribute=function(a,b,c,d){var e,g,h,i,j;if(!f.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["attribute"]&&(a.commandValue["attribute"]=new Object);for(e in a.command["attribute"])if(g=a.command["attribute"][e].call(b),g&&"object"==typeof g)for(h in g)i="function"==typeof g[h]?g[h]():g[h],("undefined"==typeof a.commandValue["attribute"][h]||a.commandValue["attribute"][h]!=i||b.refresh)&&("input"==a.node.nodeName.toLowerCase()&&("checked"!=k.toLowerCase()||"checkbox"!=a.node.type&&"radio"!=a.node.type?"value"==k.toLowerCase()&&a.node.value!=i&&(a.node.value="string"!=typeof i&&"number"!=typeof i?"":i):a.node.checked=i?!0:!1),"textarea"==a.node.nodeName.toLowerCase()&&"value"==k.toLowerCase()&&(a.node.value="string"!=typeof i&&"number"!=typeof i?"":i),"option"==a.node.nodeName.toLowerCase()&&"selected"==k.toLowerCase()&&(a.node.selected=i?!0:!1),j=a.node.getAttribute(h),i===!1||""===i?null!==j&&a.node.removeAttribute(h):j!=i&&a.node.setAttribute(h,i),a.commandValue["attribute"][h]=i)},f.commandClass=function(a,b,c,d){var e,g,h,i,j,k;if(!f.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["class"]&&(a.commandValue["class"]=new Object);for(e in a.command["class"])if(g=a.command["class"][e].call(b),g&&"object"==typeof g)for(h in g)i="function"==typeof g[h]?g[h]():g[h],("undefined"==typeof a.commandValue["class"][h]||a.commandValue["class"][h]!=i||b.refresh)&&(i?(j=h.replace(/(^\s*)|(\s*$)/g,""),k=new RegExp("(\\s|^)"+j+"(\\s|$)"),a.node.className&&a.node.className.match(k)||(a.node.className?a.node.className+=" "+j:a.node.className=j)):(j=h.replace(/(^\s*)|(\s*$)/g,""),k=new RegExp("(\\s|^)"+j+"(\\s|$)","g"),a.node.className.match(k)&&(a.node.className=a.node.className.replace(k," ").replace(/(^\s*)|(\s*$)/g,""))),a.commandValue["class"][h]=i);""==a.node.className&&a.node.removeAttribute("class")},f.commandStyle=function(a,b,c,d){var e,g,h,i,j,k;if(!f.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["style"]&&(a.commandValue["style"]=new Object);for(e in a.command["style"])if(g=a.command["style"][e].call(b),g&&"object"==typeof g)for(h in g)if(i="function"==typeof g[h]?g[h]():g[h],"undefined"==typeof a.commandValue["style"][h]||a.commandValue["style"][h]!=i||b.refresh){if(j=h.replace(/(^\s*)|(\s*$)/g,""),"object"==typeof i){for(k in i)if(a.node.style[j]=i[k],a.node.style[j]==i[k])break}else a.node.style[j]=i;a.commandValue["style"][h]=i}""==a.node.getAttribute("style")&&a.node.removeAttribute("style")},f.commandEvent=function(a,b,c,d){if(!f.commandState(a,c,d))return null;for(var e in a.command["event"])!function(d){var e,g;"undefined"!=typeof a.eventListener[d]&&("function"==typeof a.node.removeEventListener?a.node.removeEventListener(d,a.eventListener[d],!1):"function"==typeof a.node.detachEvent?a.node.detachEvent("on"+d,a.eventListener[d]):a.node["on"+d]=null,delete a.eventListener[d]),e=new Array;for(g in a.command["event"][d])e.push(a.command["event"][d][g]);return e.length?(a.eventListener[d]=function(d){f.eventListener(a,b,c,e,d)},"function"==typeof a.node.addEventListener?(a.node.addEventListener(d,a.eventListener[d],!1),a.node.removeEventListener(d,a.eventListener[d],!0)):"function"==typeof a.node.attachEvent?a.node.attachEvent("on"+d,a.eventListener[d]):a.node["on"+d]=a.eventListener[d],void 0):!1}(e)},f.commandBefore=function(a,b,c,d){if(!f.commandState(a,c,d))return null;for(var e in a.command["before"])a.command["before"][e].call(b);"undefined"==typeof a.commandValue["before"]?a.commandValue["before"]=1:a.commandValue["before"]++},f.commandAfter=function(a,b,c,d){if(!f.commandState(a,c,d))return null;for(var e in a.command["after"])a.command["after"][e].call(b);"undefined"==typeof a.commandValue["after"]?a.commandValue["after"]=1:a.commandValue["after"]++},f.commandStylesheet=function(a,b,c,d,e){var i,g=f.commandState(a,c,d),h=f.commandState(a,c,e);return g||h?(i=g?!1:!0,f.nodeElementValue(a,b,d,e,i,function(b){"undefined"!=typeof a.node.textContent?a.node.textContent=b:"undefined"!=typeof a.node.innerText&&(a.node.innerText=b)}),void 0):!1},f.commandTextarea=function(a,b,c,d,e){var i,g=f.commandState(a,c,d),h=f.commandState(a,c,e);return g||h?(i=g?!1:!0,f.nodeElementValue(a,b,d,e,i,function(b){a.node.value=b}),void 0):!1},g.prototype={constructor:g,trigger:function(a,b){return"undefined"==typeof this.props[a]?!1:(h.observerTrigger(this,a,b),void 0)},bound:function(a){var b=f.bound;"undefined"!=typeof b.props.abstractNodeTree&&"undefined"!=typeof b.props.command&&h.observerBound(this,a,b.props.abstractNodeTree,b.props.command),"undefined"!=typeof b.notify.abstractNodeTree&&"undefined"!=typeof b.notify.command&&(this.notify[a]={abstractNodeTree:b.notify.abstractNodeTree,command:b.notify.command})},remove:function(a,b,c){var e,f,d=new Array;c=","+c.join(",")+",";for(e in this.props[a][b.index][1])f=this.props[a][b.index][1][e],c.indexOf(","+f+",")<0&&d.push(f);this.props[a][b.index][1]=null,this.props[a][b.index][1]=d}},h.compilerAutoIncrement=0,h.abstractNodeTreeAutoIncrement=0,h.observerStart=function(a,b){var c;if(w.isObject(a))for(c in a)h.defineProperty(a,c,a[c]);else{if(!w.isArray(a))return!1;for(c=0;c<a.length;c++)"undefined"==typeof a[c]&&(a[c]=void 0),h.defineProperty(a,c,a[c])}(!a.hasOwnProperty("__actionViewForJavaScript__")||b)&&Object.defineProperty(a,"__actionViewForJavaScript__",{value:new g(a),writable:!0,enumerable:!1})},h.observerBound=function(a,b,c,d){if(!c.isObserverState())return!1;if("undefined"==typeof a.props[b])a.props[b]=new Object,a.props[b][c.index]=new Array(c,[d]);else if("undefined"==typeof a.props[b][c.index])a.props[b][c.index]=new Array(c,[d]);else{var e=","+a.props[b][c.index][1].join(",")+",";e.indexOf(","+d+",")<0&&a.props[b][c.index][1].push(d)}},h.observerTrigger=function(a,b,c){var e,g,i,j,k,d=a.props[b];f.commandLogStorage=new Object;for(e in d)if(g=d[e][0],i=d[e][1],g&&g.isObserverState())if(g.deleted)delete d[e],g=null;else if(g&&"function"==typeof g.renderFunction){if(j=h.observerCommands(g,i),j.length<1)continue;a.remove(b,g,j),g.renderFunction({property:b,message:c,commands:j})}k=a.notify[b],k&&"undefined"!=typeof k.abstractNodeTree&&"undefined"!=typeof k.command&&k.abstractNodeTree.renderFunction({property:b,message:c,commands:[k.command]})},h.observerCommands=function(a,b){var c,d,e;if("undefined"==typeof f.commandLogStorage[a.index])return b;c=","+f.commandLogStorage[a.index].join(",")+",",d=new Array;for(e in b)c.indexOf(","+b[e]+",")<0&&d.push(b[e]);return d},h.observerLengthContrast=function(a,b,c){var d;b.constructor==Object?d=Object.keys(b).length:b.constructor==Array&&(d=b.length),a.length!=d&&(a.length=d,c())},h.isObserver=function(a){return a&&"object"==typeof a&&a.__actionViewForJavaScript__?!0:!1},h.defineProperty=function(a,b,c){return h.observerStart(c),Object.getOwnPropertyDescriptor(a,b)&&Object.getOwnPropertyDescriptor(a,b).get&&Object.getOwnPropertyDescriptor(a,b).set?!0:(Object.defineProperty(a,b,{configurable:!0,get:function(){return h.isObserver(a)&&a.__actionViewForJavaScript__.bound(b),h.isObserver(c)&&setTimeout(function(){return h.isObserver(c)?(h.observerLengthContrast(c.__actionViewForJavaScript__,c,function(){h.defineProperty(a,b,c),h.isObserver(a)&&a.__actionViewForJavaScript__.trigger(b,"length change")}),void 0):!1},0),c},set:function(d){var e=!1;typeof c!=typeof d?e=!0:"function"==typeof c&&"function"==typeof d?c.toString()!=d.toString()&&(e=!0):c!=d&&(e=!0),e&&(c=d,setTimeout(function(){h.defineProperty(a,b,c),h.isObserver(a)&&a.__actionViewForJavaScript__.trigger(b,"set change")},0))}}),void 0)},j.prototype={constructor:j,reload:function(a){return a?window.location.reload(!0):window.location.reload(),this},request:function(a){return a?window.location.replace(this.href):window.location.assign(this.href),this},open:function(a,b,c){var d={};return d.width=a&&"number"==typeof a?a:100,d.height=b&&"number"==typeof b?b:100,d.left=c&&"number"==typeof c.left?c.left:(window.screen.width-d.width)/2,d.top=c&&"number"==typeof c.top?c.top:(window.screen.height-d.height)/2,d.target=!c||"string"!=typeof c.target&&"number"!=typeof c.target?"_blank":c.target,d.toolbar=c&&"string"==typeof c.toolbar?c.toolbar:"no",d.scrollbars=c&&"string"==typeof c.scrollbars?c.scrollbars:"no",d.menubar=c&&"string"==typeof c.menubar?c.menubar:"no",d.location=c&&"string"==typeof c.location?c.location:"no",d.resizable=c&&"string"==typeof c.resizable?c.resizable:"no",d.status=c&&"string"==typeof c.status?c.status:"no",window.open(this.href,d.target,"height="+d.height+", width="+d.width+", top="+d.top+", left="+d.left+", toolbar="+d.toolbar+", menubar="+d.menubar+", scrollbars="+d.scrollbars+", resizable="+d.resizable+",location="+d.location+", status="+d.status),this}},l.merge=function(a,b){"undefined"!=typeof b.isAbsolute&&(a.isAbsolute=b.isAbsolute);for(var c in a)"undefined"!=typeof b[c]&&("pathStruct"==c?a[c]=l.mergePathStruct(a[c],b[c],a.isAbsolute):"queryStruct"==c||"fragmentQueryStruct"==c||"fragmentPathStruct"==c?a[c]=l.mergeStruct(a[c],b[c]):"fragmentExist"==c?void 0!==b[c]&&(a[c]=b[c]):a[c]=b[c])},l.mergeStruct=function(a,b){if(b&&"object"==typeof b)for(var c in b)a[c]=w.clone(b[c]);return a},l.mergePathStruct=function(a,b,c){var d,e;if(w.isArray(a)||(a=new Array),w.isArray(b))if(a.length>1&&a.length>b.length&&!c)for(d=b.length-1,e=a.length-1;e>=0&&!(0>d);e--)a[e]=w.clone(b[d]),d--;else for(e in b)a[e]=w.clone(b[e]);return a},l.parse=function(a,b){var c,d,e,f,g,h;return w.isString(b)?(b=w.trim(b),c=/^([a-zA-Z_]+)\:\/\/([^\/]{0,})/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.scheme=d[1],void 0!==d[2]&&(e=/^([^\:\@]+)\:([^\@]+)\@([^\:]+)[\:]?(.*)?/,f=e.exec(d[2]),f?(a.user=f[1],a.password=f[2],a.domainName=f[3],"undefined"==typeof f[4]&&(a.port=f[4])):(e=/^([^\:]+)[\:]?(.*)?/,f=e.exec(d[2]),f&&(a.domainName=f[1],a.port=f[2])))),c=/^([^\?\#]+)/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.isAbsolute=d[1].match(/^\//g)?!0:!1,a.isFile=d[1].match(/\/$/g)?!1:!0,d[1]=d[1].replace(/(^\/)|(\/$)/g,""),""!=d[1]&&(g=d[1].split("/"),a.pathStruct=l.mergePathStruct(a.pathStruct,g,a.isAbsolute))),c=/^([^\#]+)/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.queryStruct=l.mergeStruct(a.queryStruct,l.parseQuery(d[1]))),c=/^\#([^\#]+)?/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.fragmentExist=!0,void 0!==d[1]&&(h=new j,l.parse(h,d[1]),a.fragmentPathStruct=l.mergeStruct(a.fragmentPathStruct,h.pathStruct),a.fragmentQueryStruct=l.mergeStruct(a.fragmentQueryStruct,h.queryStruct))),void 0):!1},l.parseQuery=function(a){var b,c,d,e,f,g,h,i,j,k;if("number"==typeof a&&(a=a.toString()),"string"!=typeof a)return!1;for(b=a.replace(/^(\?|\#){0,}/g,""),c=b.split("&"),d=new Object,e=0;e<c.length;e++)if(f=c[e].split("="),g=f.shift(),h=f.join("="),i=/\[([^\[\]]*){0,}\]$/g,g.match(i)){if(j=g.split("["),k=j.shift(),""==k)continue;d[k]=void 0!==d[k]?d[k]:new Object,d[k]=l.parseQueryChild(d[k],j,h)}else d[g]=h;return d=w.decodeURL(d)},l.parseQueryChild=function(a,b,c){var g,d=b.shift(),e=d.replace(/\]$/g,""),f=/^\d$/g;for(e.match(f)&&(e=parseInt(e)),g=0;""==e&&0!==e;){if(void 0===a[g]){e=g;break}g++}return b.length?(a[e]=void 0!==a[e]?a[e]:new Object,a[e]=l.parseQueryChild(a[e],b,c),a):(a[e]=c,a)},l.buildQuery=function(a){var b,c,d,e;if("object"!=typeof a)return a;b="";for(c in a){d=l.buildQueryChild(a[c]);for(e in d)c=w.encodeURL(c),b+=c+d[e]+"&"}return b=b.substr(0,b.length-1)},l.buildQueryChild=function(a){var c,d,e,b=new Array;if("object"==typeof a)for(c in a){d=l.buildQueryChild(a[c]);for(e in d)c=w.encodeURL(c),b.push("["+c+"]"+d[e])}else a="="+w.encodeURL(a),b.push(a);return b},l.build=function(a){var b;if(a.protocol=a.scheme?a.scheme+"://":"",a.account=a.user||a.password?a.user+(a.password?":":"")+a.password+"@":"",a.domain=a.domainName||a.port?a.domainName+(a.port?":":"")+a.port:"",a.host=a.account||a.domain?a.protocol+a.account+a.domain+"/":"",a.path="",w.isArray(a.pathStruct)&&a.pathStruct.length){for(b in a.pathStruct)a.path+="file"==a.scheme?"/"+w.decodeURL(a.pathStruct[b]):"/"+w.encodeURL(a.pathStruct[b]);a.isFile||(a.path+="/")}if(""!=a.path&&(""==a.host&&""==a.protocol&&!a.isAbsolute||""!=a.host)&&(a.path=a.path.replace(/^\//g,"")),a.query="",w.isObject(a.queryStruct)&&Object.keys(a.queryStruct).length&&(a.query="?"+l.buildQuery(a.queryStruct)),a.fragmentPath="",w.isArray(a.fragmentPathStruct)&&a.fragmentPathStruct.length)for(b in a.fragmentPathStruct)a.fragmentPath+="/"+w.encodeURL(a.fragmentPathStruct[b]);a.fragmentQuery="",w.isObject(a.fragmentQueryStruct)&&Object.keys(a.fragmentQueryStruct).length&&(a.fragmentQuery="?"+l.buildQuery(a.fragmentQueryStruct)),""!=a.fragmentPath||!a.fragmentExist&&""==a.fragmentQuery||(a.fragmentPath="/"),a.fragment="",(""!=a.fragmentPath||""!=a.fragmentQuery)&&(a.fragment="#"+a.fragmentPath+a.fragmentQuery),a.location=""==a.host?a.protocol+a.path:a.host+a.path,a.link=a.location+a.query,a.href=a.link+a.fragment},m.prototype={constructor:m,isExists:function(){var a,b,c,d,e;if(""==this.file||""==this.type)return!1;if(a=!1,b={js:"script",css:"link"},c=b[this.type],void 0!=c){d=document.getElementsByTagName(c);for(e in d)if(d[e].href&&"-1"!=d[e].href.toString().indexOf(this.file)||d[e].src&&"-1"!=d[e].src.toString().indexOf(this.file)){a=!0;break}}return a},removeAll:function(){var a,b,c,d,e;if(""==this.file||""==this.type)return!1;if(a=!1,b={js:"script",css:"link"},c=b[this.type],void 0!=c){d=document.getElementsByTagName(c);for(e in d)(d[e].href&&"-1"!=d[e].href.toString().indexOf(this.file)||d[e].src&&"-1"!=d[e].src.toString().indexOf(this.file))&&(d[e].parentNode.removeChild(d[e]),a=!0)}return a},remove:function(){return"object"!=typeof this.element||!this.element.constructor||this.element.constructor!=HTMLLinkElement&&this.element.constructor!=HTMLScriptElement?!1:(this.element.parentNode&&this.element.parentNode.removeChild(this.element),!0)},isLoad:function(){return"object"!=typeof this.element||!this.element.constructor||this.element.constructor!=HTMLLinkElement&&this.element.constructor!=HTMLScriptElement?!1:this.element.parentNode?!0:!1},load:function(a){var b,c;return"object"!=typeof this.element||!this.element.constructor||this.element.constructor!=HTMLLinkElement&&this.element.constructor!=HTMLScriptElement?!1:this.isExists()&&this.unique?!0:("object"==typeof this.selector&&this.selector instanceof HTMLElement?b=this.selector:("string"==typeof this.selector||"number"==typeof this.selector)&&(c=document.querySelectorAll(this.selector),b=c.length&&c[0]?c[0]:void 0),"function"==typeof this.onError&&(this.element.onerror=this.onError),"function"==typeof this.onSuccess&&(this.element.onload=this.onSuccess),"function"==typeof a?(a.call(this,b),!0):b&&"function"==typeof b.appendChild?(b.appendChild(this.element),!0):!1)},onError:void 0,onSuccess:void 0},n.merge=function(a,b){var c,d,e;"object"!=typeof b.element||!b.element.constructor||b.element.constructor!=HTMLLinkElement&&b.element.constructor!=HTMLScriptElement||(a.element=b.element),("string"==typeof b.file||"number"==typeof b.file)&&(a.file=b.file,"number"==typeof a.file&&(a.file=a.file.toString()),c=l(a.file),a.file=c.location,a.query=c.query),d="","string"==typeof b.type&&(d=w.trim(b.type.toLowerCase())),""==d&&""!=a.file&&(d=w.trim(a.file.split(".").pop().toLowerCase())),("css"==d||"js"==d)&&(a.type=d),""!=a.query&&(a.query=w.trim(a.query),a.query="?"+a.query.replace(/^\?{0,}/g,"")),("string"==typeof b.query||"number"==typeof b.query)&&(e=b.query,"number"==typeof e&&(e=e.toString()),e=w.trim(e),e=e.replace(/^\?{0,}/g,"").replace(/^\&{0,}/g,""),""!=a.query?a.query+="&"+e:a.query="?"+e),("string"==typeof b.charset||"number"==typeof b.charset)&&(a.charset=b.charset),"object"==typeof b.selector&&b.selector instanceof HTMLElement?a.selector=b.selector:("string"==typeof b.selector||"number"==typeof b.selector)&&(a.selector=b.selector)},n.isHTMLLinkElement=function(a){return a.element?"undefined"==typeof a.element.constructor?!1:a.element.constructor==HTMLLinkElement?!0:!1:!1},n.isHTMLScriptElement=function(a){return a.element?"undefined"==typeof a.element.constructor?!1:a.element.constructor==HTMLScriptElement?!0:!1:!1},n.createElement=function(a){if("css"===a.type||n.isHTMLLinkElement(a))n.isHTMLLinkElement(a)||(a.element=document.createElement("link")),a.element.rel="stylesheet",a.element.href=a.file+a.query,a.charset&&(a.element.charset=a.charset);else{if("js"!==a.type&&!n.isHTMLScriptElement(a))return!1;n.isHTMLScriptElement(a)||(a.element=document.createElement("script")),a.element.type="text/javascript",a.element.src=a.file+a.query,a.charset&&(a.element.charset=a.charset)}},o.prototype={constructor:o,request:function(){return p.send(this,this.method),this},post:function(){return p.send(this,"POST"),this},get:function(){return p.send(this,"GET"),this},abort:function(){return"undefined"!=typeof this.XMLHttpRequest&&"undefined"!=typeof this.XMLHttpRequest.abort&&this.XMLHttpRequest.abort(),this},onReady:function(){},onRequest:function(){},onResponse:function(){},onSuccess:function(){},onError:function(){}},p.merge=function(a,b){var c,d,e,f;"string"==typeof b.url&&(a.url=b.url),"string"==typeof b.method&&(c=w.trim(b.method.toUpperCase()),("POST"==c||"GET"==c)&&(a.method=c)),"undefined"!=typeof b.async&&(a.async=b.async?!0:!1),"undefined"!=typeof b.data&&(d=b.data,("string"==typeof b.data||"number"==typeof b.data)&&(d=l.parseQuery(b.data)),d&&"object"==typeof d&&(a.data=d)),b.header&&"object"==typeof b.header&&(a.header=b.header),"undefined"!=typeof b.timeout&&(e=parseInt(b.timeout),e&&!isNaN(e)&&(a.timeout=e)),"string"==typeof b.type&&(f=w.trim(b.type.toLowerCase()),("text"==f||"xml"==f||"json"==f)&&(a.type=f)),"function"==typeof b.onReady&&(a.onReady=b.onReady),"function"==typeof b.onRequest&&(a.onRequest=b.onRequest),"function"==typeof b.onSuccess&&(a.onSuccess=b.onSuccess),"function"==typeof b.onError&&(a.onError=b.onError),"function"==typeof b.onResponse&&(a.onResponse=b.onResponse)},p.createXMLHttpRequest=function(a){var b,c;if("undefined"!=typeof a.XMLHttpRequest&&"undefined"!=typeof a.XMLHttpRequest.abort&&a.XMLHttpRequest.abort(),a.XMLHttpRequest=void 0,window.XMLHttpRequest)a.XMLHttpRequest=new XMLHttpRequest;else if(window.ActiveXObject)for(b=["Microsoft.XMLHTTP","MSXML2.XMLHTTP"],c=0;c<b.length;c++)try{a.XMLHttpRequest=new ActiveXObject(b[c]);break}catch(d){a.onError.call(a,"您的浏览器不支持Ajax")}return!0},p.send=function(a,b){var c,d,e,f,g,h;if(p.createXMLHttpRequest(a),"undefined"==typeof a.XMLHttpRequest||"undefined"==typeof a.XMLHttpRequest.open)return!1;if(c={url:"",data:null,isTimeout:!1,setTimeoutId:null,errorExecuted:!1,error:function(a,b,c,d){return this.errorExecuted?!1:(this.errorExecuted=!0,"undefined"==typeof c&&(c=a.XMLHttpRequest.status),"undefined"==typeof d&&(d=a.XMLHttpRequest.statusText),a.onError.call(a,b,c,d))}},a.XMLHttpRequest.onreadystatechange=function(){var b,e,f,g;if(a.onReady.call(a,a.XMLHttpRequest.readyState),4==a.XMLHttpRequest.readyState){if(clearTimeout(c.setTimeoutId),b=void 0,"text"==a.type)b=a.XMLHttpRequest.responseText;else if("xml"==a.type)b=a.XMLHttpRequest.responseXML;else if("json"==a.type)try{b=""!==a.XMLHttpRequest.response?JSON.parse(a.XMLHttpRequest.response):{}}catch(d){b={},console.warn(d)}else b=a.XMLHttpRequest.response;return e=a.XMLHttpRequest.status,f=a.XMLHttpRequest.statusText,!c.isTimeout&&(e>=200&&300>e||304==e)?a.onSuccess.call(a,b,e,f):c.isTimeout?(a.XMLHttpRequest.fireEvent?a.XMLHttpRequest.fireEvent("ontimeout"):(g=document.createEvent("HTMLEvents"),g.initEvent("timeout",!1,!0),a.XMLHttpRequest.dispatchEvent(g)),f="The request timeout",c.error(a,"timeout",e,f)):setTimeout(function(){c.error(a,"error",e,f)},0),a.onResponse.call(a,b,e,f),!0}},a.XMLHttpRequest.onabort=function(){c.error(a,"abort")},a.XMLHttpRequest.onerror=function(){c.error(a,"error")},d=w.clone(a.header),"POST"==b?(c.url=a.url,a.data&&"object"==typeof a.data?"undefined"!=typeof FormData&&a.data.constructor==FormData?(c.data=a.data,"undefined"!=typeof d["Content-Type"]&&delete d["Content-Type"]):c.data=l.buildQuery(a.data):("string"==typeof a.data||"number"==typeof a.data)&&(c.data=String(a.data))):"GET"==b?("undefined"!=typeof a.data?(e=l(a.url),f=new Object,!a.data||"object"!=typeof a.data||"undefined"!=typeof FormData&&a.data.constructor==FormData?("string"==typeof a.data||"number"==typeof a.data)&&(f=l.parseQuery(a.data)):f=a.data,l.mergeStruct(e.queryStruct,f),c.url=l(e).href):c.url=a.url,c.data=null):(c.url=a.url,c.data=null),a.XMLHttpRequest.open(b,c.url,a.async),g=a.onRequest.call(a,a.XMLHttpRequest),!1===g)return a.XMLHttpRequest.abort(),!1;if(d&&"object"==typeof d)for(h in d)a.XMLHttpRequest.setRequestHeader(h,d[h]);w.isNumeric(a.timeout)&&(console.log("设置了超时时间",parseInt(a.timeout)),c.setTimeoutId=setTimeout(function(){4!=a.XMLHttpRequest.readyState&&(c.isTimeout=!0,a.XMLHttpRequest.onabort=null,a.XMLHttpRequest.abort(),clearTimeout(c.setTimeoutId))},parseInt(a.timeout))),a.XMLHttpRequest.send(c.data)},q.prototype={constructor:q,pageList:{back:new Array,forward:new Array,callback:function(){}},routerList:{back:new Array,forward:new Array,callback:function(){}}},r.prototype={constructor:r},s.prototype={constructor:s,debug:function(){return console.log(t.structs[this.index]),this},error:function(a){return v.triggerOnError("project",1,a),this},"new":function(a){return t.createChild(this,a)},ready:function(a){var b,c;return"function"==typeof a&&(b=this,c=setInterval(function(){return"undefined"==typeof t.prepares[b.index]?(clearInterval(c),a(),!0):void 0},0)),this},template:function(a){var b=t.structs[this.index];return"undefined"==typeof a?b.template:("number"==typeof a&&(a=String(a)),"string"==typeof a&&(b.template=a,"object"==typeof b.compiler&&b.compiler.template!=a&&(b.compiler=h(a))),this)},compiler:function(){return t.structs[this.index].compiler},selector:function(a){var b=t.structs[this.index];return"undefined"!=typeof a&&(b.selector=a,v.projectRenderSelectorCreate(this,a)),b.renderSelector},render:function(a){return v.projectRender(this,a),this},run:function(){return v.projectRun(this),this},start:function(){var a=t.structs[this.index];return a.runState=1,a.runEvent=!0,this},pause:function(){var a=t.structs[this.index];return a.runState=2,a.runEvent=!0,this},stop:function(){var a=t.structs[this.index];return a.runState=0,a.runEvent=!0,this},html:function(){var a=t.structs[this.index];return a.renderSelector?a.renderSelector.innerHTML:a.compiler?a.compiler.element.innerHTML:void 0},text:function(){var b,a=t.structs[this.index];if(a.renderSelector)b=a.renderSelector;else{if(!a.compiler)return void 0;b=a.compiler.element}return"undefined"!=typeof b.innerText?b.innerText:"undefined"!=typeof b.textContent?b.textContent:void 0},node:function(){var a=t.structs[this.index];return a.renderSelector?a.renderSelector:a.compiler?a.compiler.element:void 0},onPageBefore:null,onPageAfter:null,onPageNotFound:null,onPageChange:null,onProgress:null,onRouterChange:null,onIncludeBefore:null,onIncludeAfter:null,onLoadBefore:null,onLoadAfter:null,onReadyBefore:null,onReadyAfter:null,onRunBefore:null,onRunAfter:null,onRunStart:null,onRunPause:null,onRunStop:null,onRenderBefore:null,onRenderAfter:null,onRenderChange:null,onWindowResize:null,onWindowShow:null,onWindowHide:null,onError:null},t.autoIncrement=0,t.find=function(a){var b=v();
if("undefined"==typeof a){if(b.pageProject)return b.pageProject}else if("string"==typeof a&&b.project[a])return b.project[a];return void 0},t.create=function(a,b){var c=v();v.triggerOnLoad("onLoadBefore",a),c.project[a]=new s(a),t.setStruct(c.project[a],b),t.setData(c.project[a],b),t.setPrototype(c.project[a],b),t.prepares[c.project[a].index]=c.project[a],v.triggerOnLoad("onLoadAfter",a)},t.createChild=function(a,b){var d,c=v();return"string"!=typeof b&&"number"!=typeof b&&(b=t.getUniqueName(c)),"undefined"!=typeof c.project[b]?!1:(d=t.structs[a.index],t.create(b,d.struct),v.projectReady(c.project[b]),"undefined"!=typeof c.project[b]&&(a.children.push(c.project[b]),c.project[b].parent=a),c.project[b])},t.getUniqueName=function(a){for(var b=23,c="ABCDEFGHIJKLMNOPQRSTVUWXYZabcdefghijklmnopqrstvuwxyz1234567890",d=c.length,e="";;){for(e=(new Date).valueOf().toString(),i=0;b>i;i++)e+=c.charAt(Math.floor(Math.random()*d));if("undefined"==typeof a.project[e])break}return e},t.structs=new Object,t.prepares=new Object,t.setStruct=function(a,b){var c,d,e,f,g;if(t.structs[a.index]={struct:b,compiler:void 0,selector:"undefined"!=typeof b.selector?b.selector:void 0,include:new Object,includeState:!1,extend:w.isArray(b.extend)?b.extend:new Array,template:"string"==typeof b.template||"number"==typeof b.template?String(b.template):void 0,renderSelector:null,renderCount:0,runEvent:!1,runState:1,runInterval:null,runCount:0},w.isArray(b.include))for(c in b.include)d=void 0,e=void 0,"string"==typeof b.include[c]?d=v.getIncludeResource(b.include[c]):b.include[c]&&"string"==typeof b.include[c].file&&(f="string"==typeof b.include[c].type?w.trim(b.include[c].type):void 0,g="undefined"!=typeof b.include[c].selector?b.include[c].selector:void 0,d=v.getIncludeResource(b.include[c].file,f,g,b.include[c].async),"function"==typeof b.include[c].callback&&(e=b.include[c].callback)),d&&(t.structs[a.index].include[d.index]={file:d,callback:e})},t.setData=function(a,b){"function"==typeof b.data?(b.data.prototype.constructor=Object,a.data=new b.data):w.isObject(b.data)&&(a.data=w.clone(b.data))},t.setPrototype=function(a,b){if(b)for(var c in b)0===c.indexOf("on")&&"undefined"!=typeof s.prototype[c]&&(a[c]=b[c])},u.prototype={constructor:u,includeSelector:"action",includeQueryTime:!1,renderSelector:"view",historyPageMaximum:10,historyRouterMaximum:10,debug:!1,version:"2.0.0",onPage:null,onPageBefore:null,onPageAfter:null,onPageNotFound:null,onPageChange:null,onProgress:null,onRouterChange:null,onIncludeBefore:null,onIncludeAfter:null,onLoadBefore:null,onLoadAfter:null,onReadyBefore:null,onReadyAfter:null,onRunBefore:null,onRunAfter:null,onRunStart:null,onRunPause:null,onRunStop:null,onRenderBefore:null,onRenderAfter:null,onRenderChange:null,onWindowResize:null,onWindowShow:null,onWindowHide:null,onError:null},v.instance=void 0,v.setPrototype=function(a){if(a)for(var b in a)"constructor"!=b&&("page"==b?v.setPage(a[b]):"undefined"!=typeof u.prototype[b]&&(v.instance[b]=a[b]))},v.setPage=function(a){var b,c,d;if(a&&"object"==typeof a){b=l();for(c in a)a[c]&&"object"==typeof a[c]&&(d={file:"string"!=typeof a[c].file?void 0:a[c].file,project:"string"!=typeof a[c].project?void 0:a[c].project,callback:"function"!=typeof a[c].callback?void 0:a[c].callback,router:void 0},d.router=""===c?l(b.link):l(b.link,"#"+c),d.router.fragmentQueryStruct=new Object,d.router=l(d.router),v.instance.page[d.router.href]=d)}},v.resourceAutoIncrement=0,v.setInclude=function(a,b,c,d){v.triggerOnInclude("onIncludeBefore",a),a.constructor==m?(a.onSuccess=function(c){v.triggerOnInclude("onIncludeAfter",a),b(c)},a.onError=function(b){a.remove(),v.triggerOnError("include",1,"“"+a.file+"” 文件引入异常"),v.triggerOnInclude("onIncludeAfter",a),c(b)},a.load(d)):a.constructor==o&&(a.onSuccess=function(c,d,e){v.triggerOnInclude("onIncludeAfter",a),b(c,d,e)},a.onError=function(b,d,e){v.triggerOnError("include",1,"“"+a.url+"” 文件引入异常:"+JSON.stringify({type:b,status:d,statusText:e})),v.triggerOnInclude("onIncludeAfter",a),c(b,d,e)},a.get())},v.getIncludeResource=function(a,b,c,d){var f,g,h,e=l(a);if("string"!=typeof b&&(b=w.trim(e.location.split(".").pop().toLowerCase()),"js"!=b&&"css"!=b&&"json"!=b&&(b="text")),"undefined"==typeof v.instance.include[b]&&(v.instance.include[b]=new Object),f=v.instance.include[b],"undefined"==typeof f[e.location]){if("js"==b||"css"==b){if("object"==typeof c&&c instanceof HTMLElement)g=c;else{if("string"!=typeof c&&"number"!=typeof c&&(c=v.getIncludeSelector()),h=document.querySelectorAll(c),!h.length||!h[0])return v.triggerOnError("include",1,"在 document 中没有找到“"+c+"”筛选元素，无法引入文件"),void 0;g=h[0]}f[e.location]={type:b,isExecute:!1,error:!1,async:d?!0:!1,location:e.location,resource:n({file:a,query:v.getIncludeQuery(),selector:g,type:b})}}else{if("json"!=b&&"text"!=b)return void 0;f[e.location]={data:void 0,type:b,isExecute:!1,error:!1,async:d?!0:!1,location:e.location,resource:p({url:a,data:v.getIncludeQuery(),method:"GET",async:!0,type:b})}}Object.defineProperty(f[e.location],"index",{value:v.resourceAutoIncrement,writable:!1,configurable:!1}),v.resourceAutoIncrement++}return f[e.location]},v.getIncludeSelector=function(){var a=u.prototype.includeSelector;return("string"==typeof v.instance.includeSelector||"number"==typeof v.instance.includeSelector)&&(a=v.instance.includeSelector),a},v.getRenderSelector=function(){var a=u.prototype.renderSelector;return("string"==typeof v.instance.renderSelector||"number"==typeof v.instance.renderSelector)&&(a=v.instance.renderSelector),a},v.getIncludeQuery=function(){var c,a={},b=u.prototype.version;return("string"==typeof v.instance.version||"number"==typeof v.instance.version)&&(b=v.instance.version),c=u.prototype.includeQueryTime,"undefined"!=typeof v.instance.includeQueryTime&&(c=v.instance.includeQueryTime?!0:!1),""!==b&&(a["version"]=b),c&&(a["time"]=w.date("yyyy.MM.dd.hh.mm.ss.S",(new Date).getTime())),l.buildQuery(a)},v.getHistoryPageMaximum=function(){var b,a=u.prototype.historyPageMaximum;return"undefined"!=typeof v.instance.historyPageMaximum&&(b=Number(v.instance.historyPageMaximum),isNaN(b)||(a=b)),a},v.getHistoryRouterMaximum=function(){var b,a=u.prototype.historyRouterMaximum;return"undefined"!=typeof v.instance.historyRouterMaximum&&(b=Number(v.instance.historyRouterMaximum),isNaN(b)||(a=b)),a},v.trigger=function(a,b,c){for(var d in a)if(a[d]===b){"function"==typeof v.instance[a[d]]&&v.instance[a[d]](c),c.project&&"function"==typeof c.project[a[d]]&&c.project[a[d]](c);break}},v.triggerOnPage=function(a,b,c,d,e){var g,f=new r({type:"page",target:a,project:v.instance.pageProject,router:b,page:c,accept:d,ignore:e});"onPage"===a?"function"==typeof v.instance.onPage?v.instance.onPage(f):c():"onPageChange"===a?"function"==typeof v.instance.onPageChange?(f.project&&"function"==typeof f.project.onPageChange&&(f.accept=function(){f.accept=d,f.project.onPageChange(f)}),v.instance.onPageChange(f)):f.project&&"function"==typeof f.project.onPageChange?f.project.onPageChange(f):d():(g=["onPageNotFound","onPageBefore","onPageAfter"],v.trigger(g,a,f))},v.triggerOnProgress=function(a,b){var c=new r({type:"progress",target:a,project:v.instance.pageProject,total:10,loaded:b}),d=["onProgress"];v.trigger(d,a,c)},v.triggerOnRouter=function(a,b){var c=new r({type:"router",target:a,project:v.instance.pageProject,router:b}),d=["onRouterChange"];v.trigger(d,a,c)},v.triggerOnInclude=function(a,b){var c=new r({type:"include",target:a,project:v.instance.pageProject,resource:b}),d=["onIncludeBefore","onIncludeAfter"];v.trigger(d,a,c)},v.triggerOnLoad=function(a,b){var c=new r({type:"ready",target:a,project:v.instance.pageProject,loadProjectName:b}),d=["onLoadBefore","onLoadAfter"];v.trigger(d,a,c)},v.triggerOnReady=function(a,b){var c=new r({type:"ready",target:a,project:v.instance.pageProject,readyProject:b}),d=["onReadyBefore","onReadyAfter"];v.trigger(d,a,c)},v.triggerOnRun=function(a,b,c,d){var f,g,h,i,e=new r({type:"run",target:a,project:b,state:c});f="undefined"==typeof d||"boolean"!=typeof d?[v.instance,b]:d?[b]:[v.instance],g=["onRunBefore","onRunStart","onRunPause","onRunStop","onRunAfter"];for(h in g)if(g[h]===a){for(i in f)f[i]&&"function"==typeof f[i][g[h]]&&f[i][g[h]](e);break}},v.triggerOnRender=function(a,b,c,d){var e=new r({type:"render",target:a,project:v.instance.pageProject,renderProject:b,abstractNodeTree:c,trigger:d}),f=["onRenderBefore","onRenderChange","onRenderAfter"];v.trigger(f,e.target,e)},v.triggerOnWindow=function(a,b,c,d){var f,e=new r({type:"window",target:a,project:v.instance.pageProject,width:c,height:d,visibility:b});"visibility"===a&&("hidden"===b?e.target="onWindowHide":"visible"===b&&(e.target="onWindowShow")),f=["onWindowResize","onWindowHide","onWindowShow"],v.trigger(f,e.target,e)},v.triggerOnError=function(a,b,c){var d=new r({type:"error",target:a,project:v.instance.pageProject,code:b,message:c}),e=["onError"];v.trigger(e,"onError",d)},v.monitorWindowVisibility=function(){var b={hidden:null,change:null,eventListener:function(){v.triggerOnWindow("visibility",document.visibilityState,a.innerWidth,a.innerHeight)}};return"undefined"!=typeof document.hidden?(b.hidden="hidden",b.change="visibilitychange"):"undefined"!=typeof document.mozHidden?(b.hidden="mozHidden",b.change="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(b.hidden="msHidden",b.change="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(b.hidden="webkitHidden",b.change="webkitvisibilitychange"),b.hidden&&b.change?(document.addEventListener?(document.addEventListener(b.change,b.eventListener,!1),document.removeEventListener(b.change,b.eventListener,!0)):document.attachEvent?document.attachEvent("on"+b.change,b.eventListener):document["on"+b.change]=b.eventListener,!0):!1},v.monitorWindowClose=function(){},v.monitorIntervalId=null,v.monitor=function(){var b,c,d,e,f;return v.monitorIntervalId?!1:(v.monitorWindowVisibility(),v.monitorWindowClose(),b=l(),c=null,q("page",b),q("router",b),d=a.innerWidth,e=a.innerHeight,f=null,v.monitorIntervalId=setInterval(function(){c||(c=setTimeout(function(){var d,e,a=l();b.fragmentPath!==a.fragmentPath?(d=function(){q("page",a),q("router",a),b=a,c=null,v.page()},e=function(){b.fragmentExist||(b.fragmentExist=!0,b=l(b)),b.request(),c=null},v.triggerOnPage("onPageChange",a,void 0,d,e)):b.fragment!==a.fragment?(q("router",a),b=a,c=null,v.triggerOnRouter("onRouterChange",a)):c=null},0)),f||(f=setTimeout(function(){var b,c;f=null,b=a.innerHeight,c=a.innerWidth,(b!=e||c!=d)&&(e=b,d=c,v.triggerOnWindow("onWindowResize",document.visibilityState,c,b))},0))},0),void 0)},v.page=function(){var a,b,c;v.instance.pageProject&&(a=t.structs[v.instance.pageProject.index],a.compiler&&(a.compiler.observerState=!1)),v.instance.pageProject=void 0,v.instance.pageRouter=void 0,b=l(),v.triggerOnProgress("onProgress",1),v.triggerOnPage("onPageBefore",b),b.fragmentQueryStruct=new Object,b=l(b),"undefined"==typeof v.instance.page[b.href]?(c=function(a){v.pageLoad(a,b)},v.triggerOnPage("onPage",b,c)):v.pageLoad(v.instance.page[b.href],b)},v.pageLoad=function(a,b){var c,d,e,f;return!a||"string"!=typeof a.project&&"number"!=typeof a.project?(v.triggerOnError("page",1,"“"+b.href+"” 页面不存在"),v.triggerOnPage("onPageNotFound",b),v.pageEnd(),!1):(v.triggerOnProgress("onProgress",2),a.file&&"string"==typeof a.file?(c=v.getIncludeResource(a.file,"js"))?c.resource.isLoad()?v.pageProject(a.project,b):(c.isExecute=!0,d=function(){},e=function(){return v.pageProject(a.project,b)},f="function"==typeof a.callback?a.callback:void 0,v.setInclude(c.resource,e,d,f),void 0):!1:v.pageProject(a.project,b))},v.pageEnd=function(){v.triggerOnProgress("onProgress",9),v.triggerOnPage("onPageAfter",v.instance.pageRouter),v.triggerOnProgress("onProgress",10)},v.pageProject=function(a,b){return"undefined"==typeof v.instance.project[a]?(v.triggerOnError("project",1,"工程名称为 “"+a+"” 的页面不存在"),v.triggerOnPage("onPageNotFound",b),v.pageEnd(),!1):(v.triggerOnProgress("onProgress",3),v.instance.pageProject=v.instance.project[a],v.instance.pageRouter=b,v.projectPrepares(function(){return v.projectRun(v.instance.pageProject)}),void 0)},v.projectPrepares=function(a){for(var b in t.prepares)return v.projectReady(t.prepares[b],function(){return v.projectPrepares(a)});return a?a():void 0},v.projectReady=function(a,b){v.triggerOnReady("onReadyBefore",a),v.projectReadyStart(a,b)},v.projectReadyStart=function(a,b){var c,d,e,f,g;if("undefined"==typeof t.prepares[a.index])return b?b():void 0;if(c=t.structs[a.index],!c.includeState){for(d in c.include)if(!c.include[d].file.isExecute){if(c.include[d].file.isExecute=!0,!c.include[d].file.async)return v.projectReadyInclude(c.include[d],a,b);v.projectReadyInclude(c.include[d],a,b)}c.includeState=!0}if(c.extend.length){for(d in c.extend)if(e=v.instance.project[c.extend[d]],e&&"undefined"!=typeof t.prepares[e.index])return v.projectReady(e,function(){return v.projectReadyStart(a,b)});for(d in c.extend)if(e=v.instance.project[c.extend[d]],"undefined"!=typeof e){for(f in e)0===f.indexOf("on")&&"function"!=typeof a[f]&&"function"==typeof e[f]&&(a[f]=e[f]);for(f in e.data)"undefined"==typeof a.data[f]&&(a.data[f]=w.clone(e.data[f]));g=t.structs[e.index],"undefined"==typeof c.selector&&"undefined"!=typeof g.selector&&(c.selector=g.selector),"undefined"==typeof c.template&&"string"==typeof g.template&&(c.template=g.template)}else v.triggerOnError("project",1,"当前工程名称为 “"+a.name+"” 继承 父级工程名称为“"+c.extend[d]+"” 失败！av('"+c.extend[d]+"') 工程不存在！")}return"undefined"==typeof c.template&&(c.template=""),delete t.prepares[a.index],v.triggerOnReady("onReadyAfter",a),b?b():void 0},v.projectReadyInclude=function(a,b,c){var g,h,d=a.file.resource,e=a.file.async,f=a.callback;return e?(g=function(){a.file.error=!0},h=d.constructor==m?function(){}:function(c){a.file.data=c,"function"==typeof f&&f.call(b,c)}):(g=function(){return a.file.error=!0,v.projectReadyStart(b,c)},h=d.constructor==m?function(){return v.projectReadyStart(b,c)}:function(d){return a.file.data=d,"function"==typeof f&&f.call(b,d),v.projectReadyStart(b,c)}),v.setInclude(d,h,g,f)},v.projectRun=function(a){v.triggerOnProgress("onProgress",4);var b=t.structs[a.index];b.runCount++,b.runState=1,v.triggerOnRun("onRunBefore",a,b.runState,!1),v.projectRunState(a,function(){v.triggerOnProgress("onProgress",5),v.triggerOnRun("onRunBefore",a,b.runState,!0),v.projectRunState(a,function(){v.triggerOnProgress("onProgress",6),v.projectRender(a),v.projectRunState(a,function(){v.triggerOnProgress("onProgress",7),v.triggerOnRun("onRunAfter",a,b.runState,!1),v.projectRunState(a,function(){v.triggerOnProgress("onProgress",8),v.triggerOnRun("onRunAfter",a,b.runState,!0),v.projectRunState(a,function(){v.pageEnd()})})})})})},v.projectRunState=function(a,b){var c=t.structs[a.index];return v.instance.pageProject&&v.instance.pageProject.index==a.index?1==c.runState?(c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunStart",a,c.runState)),b()):2!=c.runState?(console.log("【工程运行状态】已关闭！","工程ID："+a.name),c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunStop",a,c.runState)),v.pageEnd(),!1):(c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunPause",a,c.runState)),c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),c.runInterval=setInterval(function(){return v.instance.pageProject&&v.instance.pageProject.index==a.index?2==c.runState?(c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunPause",a,c.runState)),!0):(c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),1==c.runState?(c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunStart",a,c.runState)),b()):(c.runEvent&&(c.runEvent=!1,v.triggerOnRun("onRunStop",a,c.runState)),v.pageEnd(),!1)):(c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),!1)},0),void 0):!1},v.projectRender=function(a,b){v.triggerOnRender("onRenderBefore",a);var c=t.structs[a.index];"object"!=typeof c.compiler&&(c.compiler=h(c.template)),c.compiler.observerState=!0,b||(b=new Object),b.refresh=b.refresh?!0:!1,b.reload=b.reload?!0:!1,(!c.renderSelector||b.reload)&&v.projectRenderSelectorCreate(a,b.selector),v.projectRenderSelectorClear(c.renderSelector,c.compiler,b.reload),c.compiler.render(a.data,{selector:c.renderSelector,refresh:b.refresh,onChange:function(b,c){v.triggerOnRender("onRenderChange",a,b,c)}}),v.triggerOnRender("onRenderAfter",a)},v.projectRenderSelectorClear=function(a,b,c){if("object"!=typeof a)return!1;if(!c&&b){var d=f.getValidAbstractNodeTree(a,b.abstractNodeTree);if(d)return!0}for(;a.childNodes.length;)a.removeChild(a.firstChild)},v.projectRenderSelectorCreate=function(a,b){var d,e,c=t.structs[a.index];if(d=b&&"undefined"!=typeof b?b:"undefined"!=typeof c.selector?c.selector:v.getRenderSelector(),c.renderSelector=void 0,"object"==typeof d&&d instanceof HTMLElement)c.renderSelector=d;else if("string"==typeof d||"number"==typeof d)try{e=document.querySelectorAll(d),e.length&&e[0]&&(c.renderSelector=e[0])}catch(f){console.log("【筛选器错误】"+f),v.triggerOnError("render",1,"筛选器错误："+f)}},w.prototype={constructor:w,debug:!1,log:function(a){return w.prototype.debug?"function"==typeof a?a():(console.log(a),void 0):!1}},w.constructor=w,w.version="2.0.0",w.js="av.js 全称 Action View for JavaScript，是JavaScript操作视图的小引擎、SPA架构小框架！v"+w.version,w.framework=function(){return v.apply(v,arguments)},w.project=function(){return t.apply(t,arguments)},w.compiler=function(){return h.apply(h,arguments)},w.router=function(){return l.apply(l,arguments)},w.include=function(){return n.apply(n,arguments)},w.ajax=function(){return p.apply(p,arguments)},w.test=function(){},w.trim=function(a){return w.isString(a)&&(a=a.replace(/(^\s+)|(\s+$)/g,"")),a},w.clone=function(a){var b,c;if(w.isArray(a))for(b=new Array,c=0;c<a.length;c++)w.isArray(a)||w.isObject(a)?b.push(w.clone(a[c])):b.push(a[c]);else if(w.isObject(a)){b=new Object;for(c in a)b[c]=w.isArray(a)||w.isObject(a)?w.clone(a[c]):a[c]}else b=a;return b},w.isArray=function(a){return null===a||"object"!=typeof a||a.constructor!=Array?!1:!0},w.isObject=function(a){return null===a||"object"!=typeof a||a.constructor!=Object?!1:!0},w.isString=function(a){return null===a||"string"!=typeof a?!1:!0},w.isNumber=function(a){return null===a||"number"!=typeof a?!1:!0},w.isNumeric=function(a){return null===a||"number"!=typeof a&&"string"!=typeof a?!1:/^[0-9]+$|^[0-9]+\.[0-9]+$/.test(a)},w.encodeURL=function(a){var b,c,d;if(0==arguments.length)return null;if(!a)return a;if(w.isArray(a)){for(b=new Array,c=0;c<a.length;c++)b[c]=w.encodeURL(a[c]);return b}if(w.isObject(a)){d=new Object;for(c in a)d[w.encodeURL(c)]=w.encodeURL(a[c]);return d}return w.isString(a)?encodeURIComponent(a):a},w.decodeURL=function(a){var b,c,d;if(0==arguments.length)return null;if(!a)return a;if(w.isArray(a)){for(b=new Array,c=0;c<a.length;c++)b[c]=w.decodeURL(a[c]);return b}if(w.isObject(a)){d=new Object;for(c in a)d[w.decodeURL(c)]=w.decodeURL(a[c]);return d}return w.isString(a)?decodeURIComponent(a):a},w.encodeHTML=function(a){var b,c;return 0==arguments.length?null:"string"!=typeof a?a:(b=document.createElement("DIV"),b.innerText?b.innerText=a:b.textContent=a,c=b.innerHTML,b=null,c=c.replace(/\'/g,"&apos;").replace(/\"/g,"&quot;"))},w.decodeHTML=function(a){var b,c;return 0==arguments.length?null:"string"!=typeof a?a:(b=document.createElement("DIV"),b.innerHTML=a,c=b.innerText||b.textContent,b=null,c)},w.date=function(a,b){var c,d,e,f;c=b?new Date(b):new Date,d={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":0==c.getHours()%12?12:c.getHours()%12,"H+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()},e={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(a)&&(a=a.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+e[c.getDay()+""]));for(f in d)new RegExp("("+f+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?d[f]:("00"+d[f]).substr((""+d[f]).length)));return decodeURI(a)},w.byte=function(a,b){var c,d,e;return isNaN(a)?"":(c=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(a)/Math.log(2)),1>d&&(d=0),e=Math.floor(d/10),a/=Math.pow(2,10*e),a.toString().length>a.toFixed(2).toString().length&&(a=a.toFixed(2)),"string"!=typeof b&&(b=""),a+b+c[e])},w.triggerClick=function(a){var c,b="Microsoft Internet Explorer"==navigator.appName?!0:!1;b?a.click():(c=document.createEvent("MouseEvents"),c.initEvent("click",!0,!0),a.dispatchEvent(c))},w.getFileURL=function(a){var b="";try{void 0!=window.createObjectURL?b=window.createObjectURL(a):void 0!=window.URL?b=window.URL.createObjectURL(a):void 0!=window.webkitURL&&(b=window.webkitURL.createObjectURL(a))}catch(c){b=""}return b},w.setWindowTitle=function(a,b){if(w.isString(a)||w.isNumber(a)||(a=""),document.title==a)return!1;if(document.title=a,"string"==typeof b){var c=document.createElement("iframe");c.style["left"]="-99999px",c.style["position"]="absolute",c.src=b,c.onload=function(){document.body.removeChild(c)},document.body.appendChild(c)}return!0},a.av=w}(window,document);