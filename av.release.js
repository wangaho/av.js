!function(a,b,c){function d(a,b){("object"!=typeof b||null===b)&&(b={}),Object.defineProperty(this,"index",{value:j.compilerAutoIncrement,writable:!1,configurable:!1}),j.compilerAutoIncrement++,"number"==typeof a&&(a=String(a)),"string"!=typeof a&&(a=""),Object.defineProperty(this,"template",{value:a,writable:!1,configurable:!1}),Object.defineProperty(this,"element",{value:document.createElement("render"),writable:!1,configurable:!1}),this.commandState="undefined"==typeof b.commandState||b.commandState?!0:!1,this.renderState="undefined"==typeof b.renderState||b.renderState?!0:!1,this.observerState="undefined"==typeof b.observerState||b.observerState?!0:!1,this.parent=b.parent&&"object"==typeof b.parent&&b.parent.constructor==d?b.parent:void 0,this.parentAbstractNodeTree=b.parentAbstractNodeTree&&"object"==typeof b.parentAbstractNodeTree&&b.parentAbstractNodeTree.constructor==e?b.parentAbstractNodeTree:void 0,this.abstractNodeTree=f(this,this.template,0,this.parentAbstractNodeTree)}function e(a){Object.defineProperty(this,"index",{value:j.abstractNodeTreeAutoIncrement,writable:!1,configurable:!1}),j.abstractNodeTreeAutoIncrement++,this.node=null,this.compiler=null,this.templateIndex=-1,this.tagError=!1,this.tagBeforeFirstIndex=-1,this.tagBeforeLastIndex=-1,this.tagAfterFirstIndex=-1,this.tagAfterLastIndex=-1,this.tagBefore="",this.tagAfter="",this.tagContent="",this.tagLabel=void 0,this.tagComment=void 0,this.tagText=void 0,this.tagTextLength=0,this.command={},this.commandTemplate={},this.commandError=!1,this.commandWarning=!1,this.commandValue={},this.attribute={},this.attributeTemplate={},this.eventListener={},this.renderFunction=void 0,this.parent=a,this.children=[],this.nodeName="",this.nodeType="",this.nodeVoid=!1,this.lastTemplateError="",this.lastTemplateWarning="",this.deleted=!1}function f(a,b,c,d){var g,h;for(c=c?c:0,g=[];;){if("number"==typeof b&&(b=String(b)),"string"!=typeof b||""==b)break;if(h=new e(d),f.match(h,b,0),h.templateIndex=c,h.compiler=a,g=h.tagError?f.tagErrorTrue(g,h,b):f.tagErrorFalse(g,h,b),(h.isLabel()||h.tagError&&h.tagBeforeLastIndex>=0)&&h.tagBeforeLastIndex>=0&&h.tagBeforeLastIndex<b.length)b=b.substr(h.tagBeforeLastIndex),c=h.tagBeforeLastIndex+h.templateIndex;else if(h.tagAfterLastIndex>=0&&h.tagAfterLastIndex<b.length)b=b.substr(h.tagAfterLastIndex),c=h.tagAfterLastIndex+h.templateIndex;else{if(!(h.tagBeforeFirstIndex>=0&&h.tagBeforeLastIndex<0&&h.tagBeforeFirstIndex+String("<").length<b.length))break;b=b.substr(h.tagBeforeFirstIndex+String("<").length),c=h.tagBeforeFirstIndex+String("<").length+h.templateIndex}}return g}function g(a){var d,e,f,b={compiler:a.compiler,abstractNodeTree:null,data:"object"!=typeof a.data||null===a.data?{}:a.data,refresh:a.refresh?!0:!1,onChange:null!==a.onChange&&"function"!=typeof a.onChange?function(){}:a.onChange,print:function(a){return"string"==typeof a||"number"==typeof a?a:""},encodeHTML:function(a){return x.encodeHTML(a)},decodeHTML:function(a){return x.decodeHTML(a)},argument:function(a,b,c){var d=b.toLowerCase();return"#abstractnodetree"==d||"#a"==d?a:"#node"==d||"#n"==d?a.node:"#template"==d||"#t"==d?a.templateLocation().content:"#event"==d||"#e"==d?c||s||window.event:"#value"!=d&&"#v"!=d||!a.node||"undefined"==typeof a.node.value?void 0:a.node.value}},c=null;for(a.selector&&null!==a.selector&&("object"==typeof a.selector&&(a.selector.constructor==Array||a.selector instanceof HTMLElement)?c=a.selector:("string"==typeof a.selector||"number"==typeof a.selector)&&(d=document.querySelectorAll(a.selector),d.length&&d[0]&&(c=d[0]))),c||(c=a.compiler.element),e=g.setting({group:a.compiler.abstractNodeTree}),f=0;f<a.compiler.abstractNodeTree.length;f++)e.index=f,g.node(c,a.compiler.abstractNodeTree[f],b,e);return c}function h(a){var b;return a&&"object"==typeof a&&null!==a?(a.constructor==Object?b=Object.keys(a).length:a.constructor==Array&&(b=a.length),Object.defineProperty(this,"length",{value:b,writable:!0,enumerable:!1}),Object.defineProperty(this,"props",{value:new Object,writable:!0,enumerable:!1}),Object.defineProperty(this,"notify",{value:new Object,writable:!0,enumerable:!1}),void 0):!1}function j(a,b){return new d(a,b)}function l(){this.protocol="",this.account="",this.domain="",this.host="",this.path="",this.query="",this.fragmentPath="",this.fragmentQuery="",this.fragment="",this.location="",this.link="",this.href="",this.scheme="",this.user="",this.password="",this.domainName="",this.port="",this.pathStruct=new Array,this.queryStruct=new Object,this.fragmentPathStruct=new Array,this.fragmentQueryStruct=new Object,this.fragmentExist=void 0,this.isFile=!1,this.isAbsolute=!1}function m(){var b,a=new l;if(0==arguments.length)m.parse(a,window.location.href);else for(b in arguments)arguments[b]&&("string"==typeof arguments[b]?m.parse(a,arguments[b]):"object"==typeof arguments[b]&&m.merge(a,arguments[b]));return m.build(a),a}function n(){this.element=void 0,this.file="",this.query="",this.charset="UTF-8",this.type="",this.selector="head",this.unique=!0}function o(a){var b=new n;return o.merge(b,a),b}function p(){this.XMLHttpRequest=void 0,this.url=window.location.href,this.method="GET",this.async=!0,this.data=void 0,this.header={"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},this.timeout=void 0,this.type=""}function q(a){var b=new p;return a&&"object"==typeof a&&q.merge(b,a),b}function r(a,b){var c,d,e,f,g;if("page"===a){if(r.prototype.pageList.callback(),r.prototype.pageList.callback=function(){},c=w.getHistoryPageMaximum(),1>c)return!1;if(d={title:document.title,router:b},e=r.prototype.pageList.back.length,1>e?r.prototype.pageList.back.push(d):(f=r.prototype.pageList.back[e-1],f.router.href!=b.href&&(e>c&&r.prototype.pageList.back.shift(),r.prototype.pageList.back.push(d))),e=r.prototype.pageList.forward.length,1>e)return!1;g=r.prototype.pageList.forward[e-1],g.router.href==b.href&&r.prototype.pageList.forward.splice(e-1,1)}else if("router"===a){if(r.prototype.routerList.callback(),r.prototype.routerList.callback=function(){},c=w.getHistoryRouterMaximum(),1>c)return!1;if(d={title:document.title,router:b},e=r.prototype.routerList.back.length,1>e?r.prototype.routerList.back.push(d):(f=r.prototype.routerList.back[e-1],f.router.href!=b.href&&(e>c&&r.prototype.routerList.back.shift(),r.prototype.routerList.back.push(d))),e=r.prototype.routerList.forward.length,1>e)return!1;g=r.prototype.routerList.forward[e-1],g.router.href==b.href&&r.prototype.routerList.forward.splice(e-1,1)}}function s(a){for(var b in a)this[b]=a[b]}function t(a){Object.defineProperty(this,"index",{value:u.autoIncrement,writable:!1,configurable:!1}),u.autoIncrement++,Object.defineProperty(this,"name",{value:a,writable:!1,configurable:!1}),this.data=new Object,this.parent=void 0,this.children=new Array}function u(a){var b=w();return"object"!=typeof a&&(a=new Object),"string"!=typeof a.name&&"number"!=typeof a.name&&(a.name=u.getUniqueName(b)),"undefined"==typeof b.project[a.name]&&u.create(a.name,a),b.project[a.name]}function v(){this.history=new r,this.runtime=0,this.isPageFirstLoad=!1,this.pageProject=void 0,this.pageRouter=void 0,this.page=new Object,this.project=new Object,this.include=new Object,this.exec=function(){return w.monitor(),w.page(!0),this}}function w(a){return"undefined"==typeof w.instance&&Object.defineProperty(w,"instance",{value:new v,writable:!1,configurable:!1}),a&&w.setPrototype(a),w.instance}function x(){return u.find.apply(u.find,arguments)}d.prototype={constructor:d,render:function(a,b){var c,d;return b&&"object"==typeof b||(b={}),c={compiler:this,data:"object"!=typeof a||null===a?{}:a,selector:"undefined"==typeof b.selector?void 0:b.selector,refresh:"undefined"==typeof b.refresh?void 0:b.refresh,onChange:"undefined"==typeof b.onChange?void 0:b.onChange},(b.observerStart||"undefined"==typeof b.observerStart)&&(d=b.observerReload?!0:!1,j.observerStart(c.data,d)),g(c)},reload:function(){return this.abstractNodeTree=f(this,this.template,0,this.parentAbstractNodeTree),this}},e.prototype={constructor:e,templateLocation:function(){var a={content:"",start:0,length:0};return a.start=this.tagBeforeFirstIndex>0?this.templateIndex+this.tagBeforeFirstIndex:this.templateIndex,a.length=this.isText()?this.tagTextLength:this.isLabel()?this.tagLabel.length:this.tagError?this.tagBeforeLastIndex-this.tagBeforeFirstIndex:this.tagAfterLastIndex-this.tagBeforeFirstIndex,a.content=this.compiler.template.substr(a.start,a.length),a},templateError:function(a,b,c){this.lastTemplateError="[templateError]:“"+x.decodeHTML(a)+"” "+b+"\n------------------------------------\n"+this.templateLocation().content+"\n------------------------------------\n",c&&(this.commandError=!0),console.error(this.lastTemplateError)},templateWarning:function(a,b,c){this.lastTemplateWarning="[templateWarning]:“"+x.decodeHTML(a)+"” "+b+"\n------------------------------------\n"+this.templateLocation().content+"\n------------------------------------\n",c&&(this.commandWarning=!0),console.warn(this.lastTemplateWarning)},createNode:function(){if("comment"==this.nodeType)this.node=document.createComment(this.tagContent);else if("text"==this.nodeType)this.node=document.createTextNode(x.decodeHTML(this.tagText));else{if("element"!=this.nodeType)return!1;this.node=document.createElement(this.nodeName);for(var a in this.attribute)this.node.setAttribute(a,this.attribute[a])}return!0},remove:function(){if(this.node&&this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.children&&this.children.length)for(var a in this.children)try{this.children[a].remove()}catch(b){console.log(b,this)}this.deleted=!0},clear:function(){if(this.node&&this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.children&&this.children.length)for(var a in this.children)try{this.children[a].clear()}catch(b){console.log(b,this)}},removeChild:function(a){var b,c;for(a=parseInt(a),isNaN(a)&&(a=0),b=0,c=a;c<this.children.length;c++)this.children[c].remove(),b++;b>0&&this.children.splice(a,b)},clearChild:function(a){var b,c;for(a=parseInt(a),isNaN(a)&&(a=0),b=0,c=a;c<this.children.length;c++)this.children[c].clear(),b++},isError:function(){return this.lastTemplateError||this.commandError?(this.clear(),!0):!1},isVoid:function(){return this.command&&this.command["void"]||"av-void"==this.nodeName.toLowerCase()||this.nodeVoid?!0:!1},isLabel:function(){return"undefined"!=typeof this.tagLabel?!0:!1},isComment:function(){return"undefined"!=typeof this.tagComment?!0:!1},isText:function(){return"undefined"!=typeof this.tagText?!0:!1},isStylesheet:function(){return"style"==this.nodeName&&"element"==this.nodeType?!0:!1},isTextarea:function(){return"textarea"==this.nodeName&&"element"==this.nodeType?!0:!1},isRenderState:function(){return!this.compiler.renderState||this.compiler.parent&&!this.compiler.parent.renderState?!1:!0},isObserverState:function(){return!this.compiler.observerState||this.compiler.parent&&!this.compiler.parent.observerState?!1:!0}},f.tagErrorTrue=function(a,b,c){var d;return b.tagBeforeFirstIndex<0?""!=c.replace(/\s+/g,"")&&(a=a.concat(f.createTextNode(b,c))):b.tagBeforeFirstIndex>=0&&b.tagBeforeLastIndex<0?(d=c.substr(0,b.tagBeforeFirstIndex+String("<").length),""!=d.replace(/\s+/g,"")&&(a=a.concat(f.createTextNode(b,d)))):b.tagBeforeLastIndex>=0&&""==b.nodeName?(d=c.substr(0,b.tagBeforeLastIndex),""!=d.replace(/\s+/g,"")&&(a=a.concat(f.createTextNode(b,d)))):b.tagBeforeLastIndex>=0&&""!=b.nodeName&&(d=c.substr(0,b.tagBeforeFirstIndex),""!=d.replace(/\s+/g,"")&&(a=a.concat(f.createTextNode(b,d))),a.push(f.createElement(b))),a},f.tagErrorFalse=function(a,b,c){var g,h,d=c.substr(0,b.tagBeforeFirstIndex);return""!=d.replace(/\s+/g,"")&&(g=new e(b.parent),g.templateIndex=b.templateIndex,g.compiler=b.compiler,a=a.concat(f.createTextNode(g,d))),b.isComment()?a.push(f.createComment(b)):b.isLabel()?a.push(f.createElement(b)):(b=f.createElement(b),b&&b.command&&(b.command["for"]||b.command["template"])||(h=b.command["print"]?f.createPrintNode(b):f(b.compiler,b.tagContent,b.tagBeforeLastIndex+b.templateIndex,b),"object"==typeof h&&(b.children=b.children.concat(h))),a.push(b)),a},f.match=function(a,b,c){var d,e,f,g,h,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(a.tagBeforeFirstIndex=b.indexOf("<",c),a.tagBeforeFirstIndex<0)return a.tagError=!0,a;if("<!--"==b.substr(a.tagBeforeFirstIndex,4))return a.tagBeforeLastIndex=a.tagBeforeFirstIndex+String("<!--").length,a.tagAfterFirstIndex=b.indexOf("-->",a.tagBeforeFirstIndex),a.tagAfterFirstIndex<0?(a.tagError=!0,a):(a.tagAfterLastIndex=a.tagAfterFirstIndex+String("-->").length,a.tagComment=b.substr(a.tagBeforeFirstIndex,a.tagAfterLastIndex-a.tagBeforeFirstIndex),a.tagContent=b.substr(a.tagBeforeLastIndex,a.tagAfterFirstIndex-a.tagBeforeLastIndex),a);for(d=a.tagBeforeFirstIndex,e=void 0,f=void 0,g=void 0,h=void 0;;){if(e=b.indexOf(">",d),0>e)break;if(f=b.substr(a.tagBeforeFirstIndex,e-a.tagBeforeFirstIndex),m=(new Date).valueOf(),n="__TEMP_ESCAPE_SINGLE_QUOTES"+m+"__",o="__TEMP_ESCAPE_DOUBLE_QUOTES"+m+"__",p="__TEMP_SINGLE_QUOTES"+m+"__",q="__TEMP_DOUBLE_QUOTES"+m+"__",f=f.replace(/\\'/g,n),f=f.replace(/\\"/g,o),f=f.replace(/\'([^\']{0,})\'/g,p),f=f.replace(/\"([^\"]{0,})\"/g,q),g=f.match(/\'/g),h=f.match(/\"/g),!g&&!h){a.tagBeforeLastIndex=e+String(">").length;break}d=e+String(">").length}if(a.tagBeforeLastIndex<0)return a.tagError=!0,a;if(a.tagBefore=b.substr(a.tagBeforeFirstIndex,a.tagBeforeLastIndex-a.tagBeforeFirstIndex),a.tagBefore.match(/\/\s{0,}\>$/)&&(a.tagLabel=a.tagBefore),r=/^\<\s{0,}([^\<\>\s\/]+)/.exec(a.tagBefore),r&&(a.nodeName=r[1]),""==a.nodeName||!/^[\w\d\-\_]+$/.test(a.nodeName))return a.nodeName="",a.tagError=!0,a;if("undefined"!=typeof a.tagLabel)return a;for(s="</"+a.nodeName,t=a.nodeName.replace("-","\\-"),u=new RegExp("(\\<"+t+"\\s{1,}|\\<"+t+"\\s{0,}\\>)","g"),v=new RegExp("\\<\\/"+t+"\\s{0,}\\>","g"),w=new RegExp("\\<"+t+"\\s{0,}([^\\<\\>]+)?\\/\\s{0,}\\>","g"),x=void 0,y=void 0,z=a.tagBeforeLastIndex,e=void 0,A=void 0,B=void 0,f=void 0;;){if(e=b.indexOf(s,z),0>e)break;if(z=e+s.length,A=b.indexOf(">",e),!(0>A)&&(B=b.substr(e,A-e+String(">").length),B=B.replace(/\s+/g,""),s+String(">")===B&&(f=b.substr(a.tagBeforeLastIndex,e-a.tagBeforeLastIndex),m=(new Date).valueOf(),n="__TEMP_ESCAPE_SINGLE_QUOTES"+m+"__",o="__TEMP_ESCAPE_DOUBLE_QUOTES"+m+"__",p="__TEMP_SINGLE_QUOTES"+m+"__",q="__TEMP_DOUBLE_QUOTES"+m+"__",C="__TEMP_LABEL"+m+"__",f=f.replace(/\\'/g,n),f=f.replace(/\\"/g,o),f=f.replace(/\'([^\']+)\'/g,p),f=f.replace(/\"([^\"]+)\"/g,q),f=f.replace(w,C),x=f.match(u),y=f.match(v),!y&&!x||y&&x&&y.length==x.length))){a.tagAfterFirstIndex=e,a.tagAfterLastIndex=A+String(">").length;break}}return a.tagAfterFirstIndex<0?(a.tagError=!0,a):(a.tagAfter=b.substr(a.tagAfterFirstIndex,a.tagAfterLastIndex-a.tagAfterFirstIndex),a.tagContent=b.substr(a.tagBeforeLastIndex,a.tagAfterFirstIndex-a.tagBeforeLastIndex),a)},f.filter=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(!x.isString(a)||""===a)return a;for(c=a,d=(new Date).valueOf(),e="__TEMPORARY_FILTER_SINGLE_QUOTES_"+d+"__",f="__TEMPORARY_FILTER_DOUBLE_QUOTES_"+d+"__",c=c.replace(/\\'/g,e),c=c.replace(/\\"/g,f),g=/\'([^\']{0,})\'/g,h=/\"([^\"]{0,})\"/g,i=0,j="__TEMPORARY_FILTER_STRING_"+d+"__",k="",l=new Array,m="",n="";;){if(i++,k=j+i+"__",exec=g.exec(c),exec||(exec=h.exec(c)),!exec)break;l.push({regexp:k,replacement:exec[0]}),m=c.substr(0,exec.index),n=c.substr(exec.index+exec[0].length,exec.input.length-(exec.index+exec[0].length)),c=m+k+n}return b(c,l,e,f)},f.filterRecover=function(a,b,c,d){var f,g,h,e=null;for(f=b.length-1;f>=0;f--)e=new RegExp(b[f].regexp,"g"),a=a.replace(e,b[f].replacement);return g=new RegExp(c,"g"),h=new RegExp(d,"g"),a=a.replace(g,"\\'"),a=a.replace(h,'"')},f.createComment=function(a){return a.nodeType="comment",a},f.createPrintNode=function(a){var b,c;return""==a.tagContent?!1:a.attributeTemplate["av-text"]?(b=new e(a),b.templateIndex=a.tagBeforeLastIndex+a.templateIndex,b.compiler=a.compiler,b.tagTextLength=a.tagContent.length,b.nodeType="text",b.tagText=x.encodeHTML(a.tagContent),new Array(b)):a.attributeTemplate["av-html"]?(c=new d(a.tagContent,{commandState:!1,parent:a.compiler,parentAbstractNodeTree:a}),c.abstractNodeTree):!1},f.createTextNode=function(a,b){for(var c=new Array,d=/(\{\s{0,}\{[^\}\{]+\}\s{0,}\}|\{\s{0,}html\s{0,}\{[^\}\{]+\}\s{0,}\})/i,g=b,h=void 0,i=void 0,j=void 0,k=void 0;!a.isError()&&(h=d.exec(g))&&(h.index>0&&(i=new e(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=g.substr(0,h.index),i.tagTextLength=b.length,i.nodeType="text",c.push(i)),i=new e(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=h[1],i.tagTextLength=b.length,i.nodeType="text",f.createCommand(i,"{{}}",h[1],h[1]),c.push(i),j=h.index+h[0].length,k=h.input.length-j,g=g.substr(j,k),g&&!(g.length<=4)););return""!=g&&(i=new e(a.parent),i.templateIndex=a.templateIndex,i.compiler=a.compiler,i.tagText=g,i.tagTextLength=b.length,i.nodeType="text",c.push(i)),c.length||(a.tagText=b,a.tagTextLength=b.length,a.nodeType="text",c.push(a)),c},f.createElement=function(a){return a.nodeType="element",a.tagBefore?(f.filter(a.tagBefore,function(b,c,d,e){var g,h,i,j,l;for(b=b.replace(/^(\<\s{0,})/,"").replace(/(\s{0,}\/?\s{0,}\>)$/,""),g=void 0,h=!0;;){if(g=/([^\s]+\s{0,}\=\s{0,}[^\s]+|[^\s]+)/.exec(b),!g)break;b=b.substr(g.index+g[0].length,g.input.length-g[0].length),h?h=!1:(i=g[1].split(/\=/),"undefined"==typeof i[1]?(j="",l=i[0]):(j=f.filterRecover(i[1],c,d,e),l=i[0]+"="+j,j=x.trim(j),j=0===j.search(/\"/)?j.replace(/(^\"|\"$)/g,""):j.replace(/(^\'|\'$)/g,"")),k=x.trim(i[0]),f.createCommand(a,k,j,l))}}),a):a},f.createCommand=function(a,b,c,d){if(a.isError())return!1;var e=b.toLowerCase();if(d=d.replace(/(^\s+)|(\s+$)/g,""),"undefined"==typeof a.attributeTemplate[e]&&(a.attributeTemplate[e]=new Array),a.attributeTemplate[e].push(d),a.compiler.commandState){if("av-if"==e||"av-elseif"==e||"av-else-if"==e||"av-else"==e)return f.commandIf(a,b,c,d,e);if("{{}}"==e)return f.commandPrint(a,b,c,d,e);if("av-text"==e)return f.commandPrintText(a,b,c,d,e);if("av-html"==e)return f.commandPrintHtml(a,b,c,d,e);if("av-for"==e)return f.commandFor(a,b,c,d,e);if("av-is"==e)return f.commandIs(a,b,c,d,e);if("av-attr"==e||"av-attribute"==e)return f.commandAttribute(a,b,c,d,e);if("av-event"==e)return f.commandEvent(a,b,c,d,e);if("av-class"==e)return f.commandClass(a,b,c,d,e);if("av-style"==e)return f.commandStyle(a,b,c,d,e);if("av-template"==e)return f.commandTemplate(a,b,c,d,e);if("av-void"==e)return f.commandVoid(a,b,c,d,e);if("av-before"==e)return f.commandBefore(a,b,c,d,e);if("av-after"==e)return f.commandAfter(a,b,c,d,e)}return a.attribute[b]=c,!0},f.createFunction=function(a,b,c,d){return function(){try{return new Function("$callback","$event",c)}catch(e){return"warning"==d?a.templateWarning(b,e+"\n",!0):a.templateError(b,e+"\n",!0),!1}}()},f.commandIf=function(a,b,c,d,e){var g,h,i,j,k;return d=x.encodeHTML(d),"undefined"!=typeof a.command["if"]||"undefined"!=typeof a.command["elseif"]||"undefined"!=typeof a.command["else"]?a.templateWarning(d,"if、else if、else 命令不能在同一个标签中同时存在或存在多个"):"av-else"==e?(a.command["else"]=!0,a.commandTemplate["else"]=x.decodeHTML(d),!0):"av-if"==e&&""==c.replace(/\s/g,"")?a.templateWarning(d,"if 命令不能为空",!0):"av-elseif"!=e&&"av-else-if"!=e||""!=c.replace(/\s/g,"")?(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=f.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (Boolean(function(){try{return "+i+";}catch(e){"+h+'.abstractNodeTree.templateError("'+d+'",e);return false;}}()));\n',j+="}",k=f.createFunction(a,d,j),"function"!=typeof k?!1:("av-if"==e?(a.command["if"]=k,a.commandTemplate["if"]=x.decodeHTML(d)):(a.command["elseif"]=k,a.commandTemplate["elseif"]=x.decodeHTML(d)),void 0)):a.templateWarning(d,"else if命令不能为空",!0)},f.commandPrint=function(a,b,c,d){var g,h,i,j,k,l,m,n;return d=x.encodeHTML(d),c=c.replace(/(^\s+|\s+$)/g,""),g=/\{\s{0,}([^\{\}]+)?\{([^\{\}]+)\}\s{0,}\}/,(h=g.exec(c))?(h[1]&&(h[1]=h[1].replace(/(^\s+|\s+$)/g,"").toLowerCase()),i=x.trim(h[2]),j=(new Date).valueOf(),k="$_TEMPORARY_THIS_"+j+"_",l=f.getCommandArguments(k,i),m="var "+k+"=this;\n",m+="with(this.data){\n",m+="	 try{\n",m+="html"==h[1]?"		 return "+k+".print("+l+");\n":"		 return "+k+".print("+k+".encodeHTML("+l+"));\n",m+="	 }catch(e){\n",m+="		 "+k+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',m+="	 }\n",m+="}",n=f.createFunction(a,d,m),"function"!=typeof n?!1:(a.nodeVoid=!0,a.command["print"]=n,a.commandTemplate["print"]=x.decodeHTML(d),void 0)):a.templateError(d,"{{ }}声明错误。示例：{{var}}、{html{var}}",!0)},f.commandPrintHtml=function(a,b,c,d){var g,h,i,j,k;return d=x.encodeHTML(d),"undefined"!=typeof a.command["print"]?a.templateWarning(d,"av-html、av-text 命令不能在同一个标签中同时存在或存在多个"):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=f.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="		 return "+h+".print("+i+");\n",j+="		 }catch(e){\n",j+="		 "+h+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',j+="		 }\n",j+="	 }());\n",j+="}",k=f.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["print"]=k,a.commandTemplate["print"]=x.decodeHTML(d),void 0))},f.commandPrintText=function(a,b,c,d){var g,h,i,j,k;return d=x.encodeHTML(d),"undefined"!=typeof a.command["print"]?a.templateWarning(d,"av-html、av-text 命令不能在同一个标签中同时存在或存在多个"):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=f.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="		 return "+h+".print("+h+".encodeHTML("+i+"));\n",j+="		 }catch(e){\n",j+="		 "+h+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',j+="		 }\n",j+="	 }());\n",j+="}",k=f.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["print"]=k,a.commandTemplate["print"]=x.decodeHTML(d),void 0))},f.commandTemplate=function(a,b,c,d){var g,h,i,j,k,l;if(d=x.encodeHTML(d),"undefined"!=typeof a.command["template"])return a.templateWarning(a,d,"template 命令不能在同一个标签中存在多个");if(""!=c){if(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i="$_TEMPORARY_STRING_"+g+"_",j=f.getCommandArguments(h,c),k="var "+h+"=this;\n",k+="with(this.data){\n",k+="	 return (function(){\n",k+="		 try{\n",k+="		 var "+i+"="+j+";\n",k+="		 if(typeof "+i+" == 'string'){\n",k+="			 return "+i+";\n",k+="		 }else{\n",k+="			 throw '"+c.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是字符串';\n",k+="		 }\n",k+="		 }catch(e){\n",k+="		 "+h+'.abstractNodeTree.templateWarning("'+d+'",e);return ""; \n',k+="		 }\n",k+="	 }());\n",k+="}",l=f.createFunction(a,d,k),"function"!=typeof l)return!1}else l=function(){return""};a.command["template"]=l,a.commandTemplate["template"]=x.decodeHTML(d)},f.commandFor=function(a,b,c,d){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,y,z,A;return d=x.encodeHTML(d),"undefined"!=typeof a.command["for"]?a.templateWarning(d,"for 命令不能在同一个标签中存在多个"):""==c.replace(/\s/g,"")?a.templateError(d,"for 命令不能为空",!0):(g=void 0,h=void 0,i=void 0,j=void 0,k=!1,l="",m=/\s{0,}\(([^\(\)\,]+)\,{0,1}\s{0,}([^\(\)\,]+)?\,{0,1}\s{0,}([^\(\)\,]+)?\)\s{0,}([^\(\)\s]+)\s{0,}(\([^\(\)]{0,}\))?\s{0,}/,n=m.exec(c),n&&(g=x.trim(n[1]),"undefined"!=typeof n[2]&&(n[2]=x.trim(n[2]),""!==n[2]&&(h=n[2])),"undefined"!=typeof n[3]&&(n[3]=x.trim(n[3]),""!==n[3]&&(i=n[3])),j=x.trim(n[4]),n[5]&&(k=!0,l=n[5])),j&&g?(k&&(j+=l),o=(new Date).valueOf(),p="$_TEMPORARY_THIS_"+o+"_",q="$_TEMPORARY_CALLBACK_"+o+"_",r="$_TEMPORARY_FOR_OBJECT_"+o+"_",s="$_TEMPORARY_FOR_INDEX_"+o+"_",t="$_TEMPORARY_FOR_NUMBER_"+o+"_",u="'"+g+"'",v="undefined"!=typeof h?"'"+h+"'":"undefined",w="undefined"!=typeof i?"'"+i+"'":"undefined",y=f.getCommandArguments(p,j),z="var "+p+"=this;\n",z+="var "+q+"=$callback;\n",z+="with(this.data){\n",z+="	 return (function(){\n",z+="		 try{\n",z+="			 if(typeof "+p+".data."+g+"!='undefined')"+" throw '"+g+" 是渲染数据的属性，不能定义为遍历单元值的别名称';\n","undefined"!=typeof h&&(z+="			 if(typeof "+p+".data."+h+"!='undefined')"+" throw '"+h+" 是渲染数据的属性，不能定义为遍历单元键的别名称';\n"),"undefined"!=typeof i&&(z+="			 if(typeof "+p+".data."+i+"!='undefined')"+" throw '"+i+" 是渲染数据的属性，不能定义为遍历单元索引的别名称';\n"),z+="			 var "+r+"="+y+";\n",z+="			 if(typeof "+r+"!='object') "+"throw '"+j.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是一个对象，无法进行遍历操作';\n",z+="			 if("+r+" && "+r+".constructor == Array){\n",z+="				 for(var "+s+"=0; "+s+"<"+r+".length; "+s+"++){\n",z+="					 "+p+".data."+g+"="+r+"["+s+"]; \n","undefined"!=typeof h&&(z+="					 "+p+".data."+h+"="+s+"; \n"),"undefined"!=typeof i&&(z+="					 "+p+".data."+i+"="+s+"; \n"),z+="					 "+q+"("+p+","+s+","+r+","+s+","+u+","+v+","+w+"); \n",z+="				 }\n",z+="			 }else{\n",z+="				 var "+t+"=0;\n",z+="				 for(var "+s+" in "+r+"){\n",z+="					 "+p+".data."+g+"="+r+"["+s+"]; \n","undefined"!=typeof h&&(z+="					 "+p+".data."+h+"="+s+"; \n"),"undefined"!=typeof i&&(z+="					 "+p+".data."+i+"="+t+"; \n"),z+="					 "+q+"("+p+","+t+","+r+","+s+","+u+","+v+","+w+"); \n",z+="					 "+t+"++;\n",z+="				 }\n",z+="			 }\n",z+="			 if(typeof "+p+".data."+g+" != 'undefined') delete "+p+".data."+g+";\n","undefined"!=typeof h&&(z+="			 if(typeof "+p+".data."+h+" != 'undefined') delete "+p+".data."+h+";\n"),"undefined"!=typeof i&&(z+="			 if(typeof "+p+".data."+i+" != 'undefined') delete "+p+".data."+i+";\n"),z+="		 }catch(e){\n",z+="			 "+p+'.abstractNodeTree.templateError("'+d+'",e);return ""; \n',z+="		 }\n",z+="	 }());\n",z+="}",A=f.createFunction(a,d,z),"function"!=typeof A?!1:(a.command["for"]=A,a.commandTemplate["for"]=x.decodeHTML(d),void 0)):a.templateError(d,'for 命令错误。示例：av-for="(valueName,keyName,index) Object"、av-for="(valueName) Object"、av-for="(valueName,keyName) Object()"',!0))},f.commandIs=function(a,b,c,d,e){var g,h,i,j,k;return d=x.encodeHTML(d),"undefined"!=typeof a.command["is"]?a.templateWarning(d,"is 命令不能在同一个标签中同时存在或存在多个"):"av-is"==e&&""==c.replace(/\s/g,"")?a.templateError(d,"is 命令不能为空",!0):(g=(new Date).valueOf(),h="$_TEMPORARY_THIS_"+g+"_",i=f.getCommandArguments(h,c),j="var "+h+"=this;\n",j+="with(this.data){\n",j+="	 return (Boolean(function(){try{return "+i+";}catch(e){"+h+'.abstractNodeTree.templateError("'+d+'",e);return false;}}()));\n',j+="}",k=f.createFunction(a,d,j),"function"!=typeof k?!1:(a.command["is"]=k,a.commandTemplate["is"]=x.decodeHTML(d),void 0))},f.commandVoid=function(a,b,c,d){a.command["void"]=!0,a.commandTemplate["void"]=x.decodeHTML(d)},f.commandAttribute=function(a,b,c,d){var g,h;return d=x.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"attribute 命令不能为空"):(h=f.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(f.setCommandAppend(a,"attribute",h),f.setCommandTemplate(a,"attribute",x.decodeHTML(d)),void 0))},f.commandClass=function(a,b,c,d){var g,h;return d=x.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"class 命令不能为空"):(h=f.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(f.setCommandAppend(a,"class",h),f.setCommandTemplate(a,"class",x.decodeHTML(d)),void 0))},f.commandStyle=function(a,b,c,d){var g,h;return d=x.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g?a.templateWarning(d,"style 命令不能为空"):(h=f.setAttrClassStyleFunction(a,b,c,d),"function"!=typeof h?!1:(f.setCommandAppend(a,"style",h),f.setCommandTemplate(a,"style",x.decodeHTML(d)),void 0))},f.commandEvent=function(a,b,c,d){var g,h,i,j,k,l,m,n,o,p,q,r;if(d=x.encodeHTML(d),g=c.replace(/^\s+/g,""),""==g)return a.templateWarning(d,"event 命令不能为空");if(h=/^\[([^\[\]]+)\]\s{0,}(.*)?/i,i=h.exec(g),!i)return a.templateWarning(d,"event 命令不合法");if(i[1]=x.trim(i[1]),""==i[1])return a.templateWarning(d,"event 命令缺少事件名称");if(j=i[1].split(/\s+/),k=i[2],l=(new Date).valueOf(),m="$_TEMPORARY_THIS_"+l+"_",n="$_TEMPORARY_EVENT_"+l+"_",o=f.getCommandArguments(m,k,n),p="var "+m+"=this;\n",p+="var "+n+"=$event;\n",p+="with(this.data){\n",p+="	 return (function(){\n",p+="		 try{\n",p+="			 return "+o+";\n",p+="		 }catch(e){\n",p+="			 "+m+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',p+="		 }\n",p+="	 }());\n",p+="}",q=f.createFunction(a,d,p,"warning"),"function"!=typeof q)return!1;f.setCommandTemplate(a,"event",x.decodeHTML(d)),"undefined"==typeof a.command["event"]&&(a.command["event"]=new Object);for(r in j)"undefined"==typeof a.command["event"][j[r]]&&(a.command["event"][j[r]]=new Array),a.command["event"][j[r]].push(q)},f.commandBefore=function(a,b,c,d){var g,h;return d=x.encodeHTML(d),g=x.trim(c),""==g?a.templateWarning(d,"before 命令不能为空"):(h=f.setBeforeAfterFunction(a,b,g,d),"function"!=typeof h?!1:(f.setCommandAppend(a,"before",h),f.setCommandTemplate(a,"before",x.decodeHTML(d)),void 0))},f.commandAfter=function(a,b,c,d){var g,h;return d=x.encodeHTML(d),g=x.trim(c),""==g?a.templateWarning(d,"after 命令不能为空"):(h=f.setBeforeAfterFunction(a,b,g,d),"function"!=typeof h?!1:(f.setCommandAppend(a,"after",h),f.setCommandTemplate(a,"after",x.decodeHTML(d)),void 0))},f.setBeforeAfterFunction=function(a,b,c,d){var e=(new Date).valueOf(),g="$_TEMPORARY_THIS_"+e+"_",h=f.getCommandArguments(g,c),i="var "+g+"=this;\n";return i+="with(this.data){\n",i+="	 return (function(){\n",i+="		 try{\n",i+="			"+h+";\n",i+="		 }catch(e){\n",i+="			 "+g+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',i+="		 }\n",i+="	 }());\n",i+="}",f.createFunction(a,d,i,"warning")},f.setAttrClassStyleFunction=function(a,b,c,d){var e=(new Date).valueOf(),g="$_TEMPORARY_THIS_"+e+"_",h="$_TEMPORARY_OBJECT_"+e+"_",i=f.getCommandArguments(g,c),j="var "+g+"=this;\n";return j+="with(this.data){\n",j+="	 return (function(){\n",j+="		 try{\n",j+="			 var "+h+"="+i+";\n",j+="			 if(typeof "+h+" == 'object'){\n",j+="				 return "+h+";\n",j+="			 }else{\n",j+="				 throw '"+c.replace(/\'/g,"\\'").replace(/\"/g,'\\"')+" 不是对象';\n",j+="			 }\n",j+="		 }catch(e){\n",j+="			 "+g+'.abstractNodeTree.templateWarning("'+d+'",e);return false; \n',j+="		 }\n",j+="	 }());\n",j+="}",f.createFunction(a,d,j,"warning")},f.setCommandAppend=function(a,b,c){"undefined"==typeof a.command[b]&&(a.command[b]=new Array),a.command[b].push(c)},f.setCommandTemplate=function(a,b,c){"undefined"==typeof a.commandTemplate[b]&&(a.commandTemplate[b]=new Array),a.commandTemplate[b].push(c)},f.getCommandArguments=function(a,b,c){return f.filter(b,function(b,d,e,g){return b=b.replace(/\#\s{0,}(\w+)/g,a+".argument("+a+".abstractNodeTree,'#$1',"+c+")"),f.filterRecover(b,d,e,g)})},g.setting=function(a){var c,b={commands:void 0,group:void 0,index:-1,each:void 0,bound:g.boundClone()};if(a)for(c in a)"undefined"!=typeof a[c]&&(b[c]=a[c]);return b},g.bound={global:{},props:{abstractNodeTree:void 0,command:void 0},notify:{abstractNodeTree:void 0,command:void 0}},g.boundClone=function(){var a={notify:{abstractNodeTree:g.bound.notify.abstractNodeTree,command:g.bound.notify.command}};return a},g.boundRecover=function(a){g.bound.notify.abstractNodeTree=a.notify.abstractNodeTree,g.bound.notify.command=a.notify.command},g.boundProps=function(a,b,c){g.bound.props.abstractNodeTree=a,g.bound.props.command=b;var d=c();return g.bound.props.abstractNodeTree=void 0,g.bound.props.command=void 0,d},g.boundNotify=function(a,b,c){if(g.bound.notify.abstractNodeTree&&g.bound.notify.command)return c();g.bound.notify.abstractNodeTree=a,g.bound.notify.command=b;var d=c();return g.bound.notify.abstractNodeTree=void 0,g.bound.notify.command=void 0,d},g.commandLogStorage=new Object,g.commandLog=function(a,b){if("undefined"==typeof g.commandLogStorage[a.index])g.commandLogStorage[a.index]=[b];else{var c=","+g.commandLogStorage[a.index].join(",")+",";c.indexOf(","+b+",")<0&&g.commandLogStorage[a.index].push(b)}},g.commandState=function(a,b,c){if(g.commandLog(a,c),"undefined"==typeof b.commands)return!0;for(var d in b.commands){if("if"==b.commands[d]||"is"==b.commands[d]||"print"==b.commands[d]||"for"==b.commands[d]||"template"==b.commands[d])return!0;if(b.commands[d]==c)return!0}return!1},g.node=function(a,b,c,d){var e,f,h;if(b.deleted)return b.remove(),b=null,!1;if(!b||b.commandError||!b.isRenderState())return!1;if(e=g.setting(d),b.renderFunction=function(d){"undefined"!=typeof d.commands&&(e.commands=d.commands),g.trigger(c,e,function(){c.refresh=!1,g.node(a,b,c,e),c.onChange(b,d)
})},b.lastTemplateError="",c.abstractNodeTree=b,b.command["before"]){if(b.isError())return null;g.boundProps(b,"before",function(){g.commandBefore(b,c,d,"before")})}if(b.isError())return null;if(f=g.boundProps(b,"if",function(){return g.commandIf(b,c,d,"if")}),!f)return!1;if(b.command["template"]){if(b.isError())return null;g.boundProps(b,"template",function(){g.commandTemplate(b,c,d,"template")})}if(b.command["for"])return b.isError()?null:g.boundProps(b,"for",function(){return g.commandFor(a,b,c,d,"for")});if(b.command["is"]){if(b.isError())return null;if(h=g.boundProps(b,"is",function(){return g.commandIs(b,c,d,"is")}),!h)return!1}if(b.command["print"]){if(b.isError())return null;g.boundProps(b,"print",function(){g.commandPrint(b,c,d,"print")})}if(b.isVoid())return b.isError()?null:g.boundProps(b,"void",function(){return g.commandVoid(a,b,c,d,"void")});if(!b.node&&!b.isVoid()){if(b.isError())return null;b.createNode()}if(b.node){if(b.command["attribute"]){if(b.isError())return null;g.boundProps(b,"attribute",function(){g.commandAttribute(b,c,d,"attribute")})}if(b.command["class"]){if(b.isError())return null;g.boundProps(b,"class",function(){g.commandClass(b,c,d,"class")})}if(b.command["style"]){if(b.isError())return null;g.boundProps(b,"style",function(){g.commandStyle(b,c,d,"style")})}if(b.command["event"]){if(b.isError())return null;g.boundProps(b,"event",function(){g.commandEvent(b,c,d,"event")})}if(b.isStylesheet()){if(b.isError())return null;g.boundProps(b,"stylesheet",function(){g.commandStylesheet(b,c,d,"stylesheet","stylesheet-notify")})}if(b.isTextarea()){if(b.isError())return null;g.boundProps(b,"textarea",function(){g.commandTextarea(b,c,d,"textarea","textarea-notify")})}}if(b.command["after"]){if(b.isError())return null;g.boundProps(b,"after",function(){g.commandAfter(b,c,d,"after")})}if(b.node&&!b.isStylesheet()&&!b.isTextarea()){if(b.isError())return null;g.boundProps(b,"childAbstractNodeTree",function(){g.childAbstractNodeTree(b,c,d,"childAbstractNodeTree")})}g.childNode(a,b,c,d)},g.trigger=function(a,b,c){var i,k,l,m,n,o,d=new Array,e=new Object,f=x.encodeHTML("av-for"),h=void 0;try{if(b.each&&b.each.length)for(i in b.each)if(h=b.each[i].abstractNodeTree,b.each[i].forObject,k=b.each[i].key,l=b.each[i].index,m=b.each[i].valueName,n=b.each[i].keyName,o=b.each[i].indexName,void 0!==m){if("undefined"==typeof e[m]){if("undefined"!=typeof a.data[m])throw m+" 是渲染数据的属性，不能定义为遍历单元值的别名称";e[m]=!0}if(a.data[m]=b.each[i].forObject[k],d.push(m),void 0!==n){if("undefined"==typeof e[n]){if("undefined"!=typeof a.data[n])throw n+" 是渲染数据的属性，不能定义为遍历单元键的别名称";e[n]=!0}a.data[n]=k,d.push(n)}if(void 0!==o){if("undefined"==typeof e[o]){if("undefined"!=typeof a.data[o])throw o+" 是渲染数据的属性，不能定义为遍历单元索引的别名称";e[o]=!0}a.data[o]=l,d.push(o)}}b.bound&&g.boundRecover(b.bound),c()}catch(p){h.templateError(f,p)}if(d.length)for(i in d)"undefined"!=typeof a.data[d[i]]&&delete a.data[d[i]]},g.childAbstractNodeTree=function(a,b,c,d){var e,f;if(!g.commandState(a,c,d))return!1;if(a.children&&a.children.length)for(e=g.setting({commands:c.commands,group:a.children,each:c.each}),f=0;f<a.children.length;f++)e.index=f,g.node(a.node,a.children[f],b,e)},g.childNode=function(a,b,c,d){if(!a||!b||!b.node)return!1;if(a instanceof HTMLElement&&b.node.parentNode!=a){b.node.parentNode&&b.node.parentNode.removeChild(b.node);try{var e=g.getBrotherAbstractNodeTree(a,b,c,d);e?a.insertBefore(b.node,e.node):a.appendChild(b.node)}catch(f){console.error(f)}return!0}},g.getBrotherAbstractNodeTree=function(a,b,c){var e,f,h,i,j,k,l;if("undefined"==typeof b)return void 0;if(!a.childNodes)return void 0;for(e=b,f=new Array,h=!1,i=2;i>0;){if(e.isVoid()||e.command["for"]||i--,"undefined"==typeof e.parent?(f=c.compiler.abstractNodeTree,h=!0):f=e.parent.children,f.length){for(j=!1,k=0;k<f.length;k++)if(!f[k].deleted)if(f[k].index!=e.index){if(j)if(f[k].isVoid()||f[k].command["for"]){if(l=g.getValidAbstractNodeTree(a,f[k].children))return l}else if(f[k].node&&f[k].node.parentNode==a)return f[k]}else j=!0}else if(h)return void 0;if("undefined"==typeof e.parent)return void 0;e=e.parent}},g.getValidAbstractNodeTree=function(a,b){var c,d;if(!b.length)return void 0;for(c=0;c<b.length;c++)if(!b[c].deleted)if(b[c].isVoid()||b[c].command["for"]){if(d=g.getValidAbstractNodeTree(a,b[c].children))return d}else if(b[c].node&&b[c].node.parentNode==a)return b[c];return void 0},g.eventListener=function(a,b,c,d,e){var e=e||s||window.event;g.trigger(b,c,function(){var c,f;b.refresh=!1,b.abstractNodeTree=a;for(c in d)f=d[c].apply(b,void 0,e),!1===f&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0})},g.nodeElementValue=function(a,b,c,d,e,f){var j,h=c+"Node",i=c+"Value";"undefined"==typeof a.commandValue[h]&&(a.commandValue[h]=document.createElement("div")),e||a.children&&a.children.length&&g.boundNotify(a,d,function(){var d,c=g.setting({group:a.children});for(d=0;d<a.children.length;d++)c.index=d,g.node(a.commandValue[h],a.children[d],b,c)}),j="undefined"!=typeof a.commandValue[h].textContent?a.commandValue[h].textContent:"undefined"!=typeof a.commandValue[h].innerText?a.commandValue[h].innerText:"",(a.commandValue[i]!=j||b.refresh)&&(f(j),a.commandValue[i]=j)},g.forTagBeforeClear=function(a){var d,b=a.tagBefore,c=a.attributeTemplate["av-for"];a.attributeTemplate["av-if"]&&(c=c.concat(a.attributeTemplate["av-if"])),a.attributeTemplate["av-elseif"]&&(c=c.concat(a.attributeTemplate["av-elseif"])),a.attributeTemplate["av-else-if"]&&(c=c.concat(a.attributeTemplate["av-else-if"])),a.attributeTemplate["av-else"]&&(c=c.concat(a.attributeTemplate["av-else"])),a.attributeTemplate["av-template"]&&(c=c.concat(a.attributeTemplate["av-template"]));for(d in c)b=b.replace(" "+c[d],"");return b},g.ifElseSyntax=function(a,b){var d,e,f,c=0;if("undefined"==typeof b.group||"undefined"==typeof b.index||0==b.index)return c;for(d=parseInt(b.index)-1,c=2,e=d;e>=0;e--)if(f=b.group[e],"element"==f.nodeType){if("undefined"!=typeof f.commandValue["if"]){f.command["if"].call(a),f.commandValue["if"]&&(c=1);break}"undefined"!=typeof f.commandValue["elseif"]?(f.command["elseif"].call(a),f.commandValue["elseif"]&&(c=1)):c=0}return c},g.commandIf=function(a,b,c,d){var e;if(a.command&&a.command["if"]){if(g.commandState(a,c,d)&&(a.commandValue["if"]=a.command["if"].call(b)),!a.commandValue["if"])return a.clear(),!1}else if(a.command&&a.command["elseif"]){if(e=g.ifElseSyntax(b,c),0==e)return a.clear(),a.templateError(x.encodeHTML("av-else-if/av-elseif"),"“else if”命令错误,必须是if接else if",!0),!1;if(g.commandState(a,c,d)&&(a.commandValue["elseif"]=a.command["elseif"].call(b)),1==e&&(a.commandValue["elseif"]=!1),!a.commandValue["elseif"])return a.clear(),!1}else if(a.command&&a.command["else"]){if(e=g.ifElseSyntax(b,c),0==e)return a.clear(),a.templateError(x.encodeHTML("av-else"),"“else”命令错误,必须是if、else if接else",!0),!1;if(a.commandValue["else"]=1==e?!1:!0,!a.commandValue["else"])return a.clear(),!1}return!0},g.commandTemplate=function(a,b,c,e){var f,h,i;if(!g.commandState(a,c,e))return null;if(f=a.command["template"].call(b),f=a.tagContent+f,"undefined"==typeof a.commandValue["template"]||a.commandValue["template"]!=f){if(a.commandValue["template"]=f,a.clear(),a.node&&a.node.childNodes)for(;a.node.childNodes.length;)a.node.removeChild(a.node.firstChild);a.removeChild(),a.children=new Array,a.command["for"]?(h=g.forTagBeforeClear(a),a.commandValue["forTemplate"]=h+a.commandValue["template"]+a.tagAfter):(i=new d(a.commandValue["template"],{parent:b.compiler,parentAbstractNodeTree:a}),a.children=i.abstractNodeTree)}},g.commandFor=function(a,b,c,e,f){var h,i,j;return g.commandState(b,e,f)?("undefined"==typeof b.commandValue["forTemplate"]&&(h=g.forTagBeforeClear(b),b.commandValue["forTemplate"]=h+b.tagContent+b.tagAfter,b.removeChild(),b.children=new Array),i=g.setting({group:b.children}),j=0,b.command["for"].call(c,function(h,k,l,m,n,o,p){if("undefined"==typeof b.children[k]){var q=new d(b.commandValue["forTemplate"],{parent:c.compiler,parentAbstractNodeTree:b});b.children.push(q.abstractNodeTree[0])}j++,i.index=k,i.each=new Array,x.isArray(e.each)&&(i.each=i.each.concat(e.each)),i.each.push({abstractNodeTree:b,forObject:l,key:m,index:k,valueName:n,keyName:o,indexName:p}),g.node(a,b.children[k],h,i),g.bound.props.abstractNodeTree=b,g.bound.props.command=f}),b.removeChild(j),null):null},g.commandIs=function(a,b,c,d){return g.commandState(a,c,d)&&(a.commandValue["is"]=a.command["is"].call(b)),a.commandValue["is"]?!0:(a.clear(),!1)},g.commandPrint=function(a,b,c,e){var f,h,i,j;if(f=g.commandState(a,c,e)?a.command["print"].call(b):a.commandValue["print"],"undefined"==typeof a.commandValue["print"]||a.commandValue["print"]!=f||b.refresh){if("object"==typeof a.commandValue["printAbstractNodeTree"]){for(h in a.commandValue["printAbstractNodeTree"]){for(i in a.children)if(a.children[i]==a.commandValue["printAbstractNodeTree"][h]){a.children.splice(i,1);break}a.commandValue["printAbstractNodeTree"][h].remove()}a.commandValue["printAbstractNodeTree"]=new Array}""!==f&&(j=new d(f,{commandState:!1,parent:b.compiler,parentAbstractNodeTree:a}),a.children=a.children.concat(j.abstractNodeTree),a.commandValue["printAbstractNodeTree"]=j.abstractNodeTree),a.commandValue["print"]=f}},g.commandVoid=function(a,b,c,d,e){var f,h;if(!g.commandState(b,d,e))return!1;for(f=g.setting({commands:d.commands,group:b.children,each:d.each}),h=0;h<b.children.length;h++)f.index=h,g.node(a,b.children[h],c,f);return null},g.commandAttribute=function(a,b,c,d){var e,f,h,i,j;if(!g.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["attribute"]&&(a.commandValue["attribute"]=new Object);for(e in a.command["attribute"])if(f=a.command["attribute"][e].call(b),f&&"object"==typeof f)for(h in f)i="function"==typeof f[h]?f[h]():f[h],("undefined"==typeof a.commandValue["attribute"][h]||a.commandValue["attribute"][h]!=i||b.refresh)&&("input"==a.node.nodeName.toLowerCase()&&("checked"!=k.toLowerCase()||"checkbox"!=a.node.type&&"radio"!=a.node.type?"value"==k.toLowerCase()&&a.node.value!=i&&(a.node.value="string"!=typeof i&&"number"!=typeof i?"":i):a.node.checked=i?!0:!1),"textarea"==a.node.nodeName.toLowerCase()&&"value"==k.toLowerCase()&&(a.node.value="string"!=typeof i&&"number"!=typeof i?"":i),"option"==a.node.nodeName.toLowerCase()&&"selected"==k.toLowerCase()&&(a.node.selected=i?!0:!1),j=a.node.getAttribute(h),i===!1||""===i?null!==j&&a.node.removeAttribute(h):j!=i&&a.node.setAttribute(h,i),a.commandValue["attribute"][h]=i)},g.commandClass=function(a,b,c,d){var e,f,h,i,j,k;if(!g.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["class"]&&(a.commandValue["class"]=new Object);for(e in a.command["class"])if(f=a.command["class"][e].call(b),f&&"object"==typeof f)for(h in f)i="function"==typeof f[h]?f[h]():f[h],("undefined"==typeof a.commandValue["class"][h]||a.commandValue["class"][h]!=i||b.refresh)&&(i?(j=h.replace(/(^\s*)|(\s*$)/g,""),k=new RegExp("(\\s|^)"+j+"(\\s|$)"),a.node.className&&a.node.className.match(k)||(a.node.className?a.node.className+=" "+j:a.node.className=j)):(j=h.replace(/(^\s*)|(\s*$)/g,""),k=new RegExp("(\\s|^)"+j+"(\\s|$)","g"),a.node.className.match(k)&&(a.node.className=a.node.className.replace(k," ").replace(/(^\s*)|(\s*$)/g,""))),a.commandValue["class"][h]=i);""==a.node.className&&a.node.removeAttribute("class")},g.commandStyle=function(a,b,c,d){var e,f,h,i,j,k;if(!g.commandState(a,c,d))return null;"undefined"==typeof a.commandValue["style"]&&(a.commandValue["style"]=new Object);for(e in a.command["style"])if(f=a.command["style"][e].call(b),f&&"object"==typeof f)for(h in f)if(i="function"==typeof f[h]?f[h]():f[h],"undefined"==typeof a.commandValue["style"][h]||a.commandValue["style"][h]!=i||b.refresh){if(j=h.replace(/(^\s*)|(\s*$)/g,""),"object"==typeof i){for(k in i)if(a.node.style[j]=i[k],a.node.style[j]==i[k])break}else a.node.style[j]=i;a.commandValue["style"][h]=i}""==a.node.getAttribute("style")&&a.node.removeAttribute("style")},g.commandEvent=function(a,b,c,d){if(!g.commandState(a,c,d))return null;for(var e in a.command["event"])!function(d){var e,f;"undefined"!=typeof a.eventListener[d]&&("function"==typeof a.node.removeEventListener?a.node.removeEventListener(d,a.eventListener[d],!1):"function"==typeof a.node.detachEvent?a.node.detachEvent("on"+d,a.eventListener[d]):a.node["on"+d]=null,delete a.eventListener[d]),e=new Array;for(f in a.command["event"][d])e.push(a.command["event"][d][f]);return e.length?(a.eventListener[d]=function(d){g.eventListener(a,b,c,e,d)},"function"==typeof a.node.addEventListener?(a.node.addEventListener(d,a.eventListener[d],!1),a.node.removeEventListener(d,a.eventListener[d],!0)):"function"==typeof a.node.attachEvent?a.node.attachEvent("on"+d,a.eventListener[d]):a.node["on"+d]=a.eventListener[d],void 0):!1}(e)},g.commandBefore=function(a,b,c,d){if(!g.commandState(a,c,d))return null;for(var e in a.command["before"])a.command["before"][e].call(b);"undefined"==typeof a.commandValue["before"]?a.commandValue["before"]=1:a.commandValue["before"]++},g.commandAfter=function(a,b,c,d){if(!g.commandState(a,c,d))return null;for(var e in a.command["after"])a.command["after"][e].call(b);"undefined"==typeof a.commandValue["after"]?a.commandValue["after"]=1:a.commandValue["after"]++},g.commandStylesheet=function(a,b,c,d,e){var i,f=g.commandState(a,c,d),h=g.commandState(a,c,e);return f||h?(i=f?!1:!0,g.nodeElementValue(a,b,d,e,i,function(b){"undefined"!=typeof a.node.textContent?a.node.textContent=b:"undefined"!=typeof a.node.innerText&&(a.node.innerText=b)}),void 0):!1},g.commandTextarea=function(a,b,c,d,e){var i,f=g.commandState(a,c,d),h=g.commandState(a,c,e);return f||h?(i=f?!1:!0,g.nodeElementValue(a,b,d,e,i,function(b){a.node.value=b}),void 0):!1},h.prototype={constructor:h,trigger:function(a,b){return"undefined"==typeof this.props[a]?!1:(j.observerTrigger(this,a,b),void 0)},bound:function(a){var b=g.bound;"undefined"!=typeof b.props.abstractNodeTree&&"undefined"!=typeof b.props.command&&j.observerBound(this,a,b.props.abstractNodeTree,b.props.command),"undefined"!=typeof b.notify.abstractNodeTree&&"undefined"!=typeof b.notify.command&&(this.notify[a]={abstractNodeTree:b.notify.abstractNodeTree,command:b.notify.command})},remove:function(a,b,c){var e,f,d=new Array;c=","+c.join(",")+",";for(e in this.props[a][b.index][1])f=this.props[a][b.index][1][e],c.indexOf(","+f+",")<0&&d.push(f);this.props[a][b.index][1]=null,this.props[a][b.index][1]=d}},j.compilerAutoIncrement=0,j.abstractNodeTreeAutoIncrement=0,j.observerName="__av.js:observer|"+c+"__",j.observerStart=function(a,b){var c;if(x.isObject(a))for(c in a)j.defineProperty(a,c,a[c]);else{if(!x.isArray(a))return!1;for(c=0;c<a.length;c++)"undefined"==typeof a[c]&&(a[c]=void 0),j.defineProperty(a,c,a[c])}(!a.hasOwnProperty(j.observerName)||b)&&Object.defineProperty(a,j.observerName,{value:new h(a),writable:!0,enumerable:!1})},j.observerBound=function(a,b,c,d){if(!c.isObserverState())return!1;if("undefined"==typeof a.props[b])a.props[b]=new Object,a.props[b][c.index]=new Array(c,[d]);else if("undefined"==typeof a.props[b][c.index])a.props[b][c.index]=new Array(c,[d]);else{var e=","+a.props[b][c.index][1].join(",")+",";e.indexOf(","+d+",")<0&&a.props[b][c.index][1].push(d)}},j.observerTrigger=function(a,b,c){var e,f,h,i,k,d=a.props[b];g.commandLogStorage=new Object;for(e in d)if(f=d[e][0],h=d[e][1],f&&f.isObserverState())if(f.deleted)delete d[e],f=null;else if(f&&"function"==typeof f.renderFunction){if(i=j.observerCommands(f,h),i.length<1)continue;a.remove(b,f,i),f.renderFunction({property:b,message:c,commands:i})}k=a.notify[b],k&&"undefined"!=typeof k.abstractNodeTree&&"undefined"!=typeof k.command&&k.abstractNodeTree.renderFunction({property:b,message:c,commands:[k.command]})},j.observerCommands=function(a,b){var c,d,e;if("undefined"==typeof g.commandLogStorage[a.index])return b;c=","+g.commandLogStorage[a.index].join(",")+",",d=new Array;for(e in b)c.indexOf(","+b[e]+",")<0&&d.push(b[e]);return d},j.observerLengthContrast=function(a,b,c){var d;b.constructor==Object?d=Object.keys(b).length:b.constructor==Array&&(d=b.length),a.length!=d&&(a.length=d,c())},j.isObserver=function(a){return a&&"object"==typeof a&&a[j.observerName]?!0:!1},j.defineProperty=function(a,b,c){return j.observerStart(c),Object.getOwnPropertyDescriptor(a,b)&&Object.getOwnPropertyDescriptor(a,b).get&&Object.getOwnPropertyDescriptor(a,b).set?!0:(Object.defineProperty(a,b,{configurable:!0,get:function(){return j.isObserver(a)&&a[j.observerName].bound(b),j.isObserver(c)&&setTimeout(function(){return j.isObserver(c)?(j.observerLengthContrast(c[j.observerName],c,function(){j.defineProperty(a,b,c),j.isObserver(a)&&a[j.observerName].trigger(b,"length change")}),void 0):!1},0),c},set:function(d){var e=!1;typeof c!=typeof d?e=!0:"function"==typeof c&&"function"==typeof d?c.toString()!=d.toString()&&(e=!0):c!=d&&(e=!0),e&&(c=d,setTimeout(function(){j.defineProperty(a,b,c),j.isObserver(a)&&a[j.observerName].trigger(b,"set change")},0))}}),void 0)},l.prototype={constructor:l,reload:function(a){return a?window.location.reload(!0):window.location.reload(),this},request:function(a){return a?window.location.replace(this.href):window.location.assign(this.href),this},open:function(a,b,c){var d={};return d.width=a&&"number"==typeof a?a:100,d.height=b&&"number"==typeof b?b:100,d.left=c&&"number"==typeof c.left?c.left:(window.screen.width-d.width)/2,d.top=c&&"number"==typeof c.top?c.top:(window.screen.height-d.height)/2,d.target=!c||"string"!=typeof c.target&&"number"!=typeof c.target?"_blank":c.target,d.toolbar=c&&"string"==typeof c.toolbar?c.toolbar:"no",d.scrollbars=c&&"string"==typeof c.scrollbars?c.scrollbars:"no",d.menubar=c&&"string"==typeof c.menubar?c.menubar:"no",d.location=c&&"string"==typeof c.location?c.location:"no",d.resizable=c&&"string"==typeof c.resizable?c.resizable:"no",d.status=c&&"string"==typeof c.status?c.status:"no",window.open(this.href,d.target,"height="+d.height+", width="+d.width+", top="+d.top+", left="+d.left+", toolbar="+d.toolbar+", menubar="+d.menubar+", scrollbars="+d.scrollbars+", resizable="+d.resizable+",location="+d.location+", status="+d.status),this}},m.merge=function(a,b){"undefined"!=typeof b.isAbsolute&&(a.isAbsolute=b.isAbsolute);for(var c in a)"undefined"!=typeof b[c]&&("pathStruct"==c?a[c]=m.mergePathStruct(a[c],b[c],a.isAbsolute):"queryStruct"==c||"fragmentQueryStruct"==c||"fragmentPathStruct"==c?a[c]=m.mergeStruct(a[c],b[c]):"fragmentExist"==c?void 0!==b[c]&&(a[c]=b[c]):a[c]=b[c])},m.mergeStruct=function(a,b){if(b&&"object"==typeof b)for(var c in b)a[c]=x.clone(b[c]);return a},m.mergePathStruct=function(a,b,c){var d,e;if(x.isArray(a)||(a=new Array),x.isArray(b))if(a.length>1&&a.length>b.length&&!c)for(d=b.length-1,e=a.length-1;e>=0&&!(0>d);e--)a[e]=x.clone(b[d]),d--;else for(e in b)a[e]=x.clone(b[e]);return a},m.parse=function(a,b){var c,d,e,f,g,h;return x.isString(b)?(b=x.trim(b),c=/^([a-zA-Z_]+)\:\/\/([^\/]{0,})/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.scheme=d[1],void 0!==d[2]&&(e=/^([^\:\@]+)\:([^\@]+)\@([^\:]+)[\:]?(.*)?/,f=e.exec(d[2]),f?(a.user=f[1],a.password=f[2],a.domainName=f[3],"undefined"!=typeof f[4]&&(a.port=f[4])):(e=/^([^\:]+)[\:]?(.*)?/,f=e.exec(d[2]),f&&(a.domainName=f[1],"undefined"!=typeof f[2]&&(a.port=f[2]))))),c=/^([^\?\#]+)/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.isAbsolute=d[1].match(/^\//g)?!0:!1,a.isFile=d[1].match(/\/$/g)?!1:!0,d[1]=d[1].replace(/(^\/)|(\/$)/g,""),""!=d[1]&&(g=d[1].split("/"),a.pathStruct=m.mergePathStruct(a.pathStruct,g,a.isAbsolute))),c=/^([^\#]+)/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.queryStruct=m.mergeStruct(a.queryStruct,m.parseQuery(d[1]))),c=/^\#([^\#]+)?/,d=c.exec(b),d&&(b=b.substr(d[0].length),a.fragmentExist=!0,void 0!==d[1]&&(h=new l,m.parse(h,d[1]),a.fragmentPathStruct=m.mergeStruct(a.fragmentPathStruct,h.pathStruct),a.fragmentQueryStruct=m.mergeStruct(a.fragmentQueryStruct,h.queryStruct))),void 0):!1},m.parseQuery=function(a){var b,c,d,e,f,g,h,i,j,k;if("number"==typeof a&&(a=a.toString()),"string"!=typeof a)return!1;for(b=a.replace(/^(\?|\#){0,}/g,""),c=b.split("&"),d=new Object,e=0;e<c.length;e++)if(f=c[e].split("="),g=f.shift(),h=f.join("="),i=/\[([^\[\]]*){0,}\]$/g,g.match(i)){if(j=g.split("["),k=j.shift(),""==k)continue;d[k]=void 0!==d[k]?d[k]:new Object,d[k]=m.parseQueryChild(d[k],j,h)}else d[g]=h;return d=x.decodeURL(d)},m.parseQueryChild=function(a,b,c){var g,d=b.shift(),e=d.replace(/\]$/g,""),f=/^\d$/g;for(e.match(f)&&(e=parseInt(e)),g=0;""==e&&0!==e;){if(void 0===a[g]){e=g;break}g++}return b.length?(a[e]=void 0!==a[e]?a[e]:new Object,a[e]=m.parseQueryChild(a[e],b,c),a):(a[e]=c,a)},m.buildQuery=function(a){var b,c,d,e;if("object"!=typeof a)return a;b="";for(c in a){d=m.buildQueryChild(a[c]);for(e in d)c=x.encodeURL(c),b+=c+d[e]+"&"}return b=b.substr(0,b.length-1)},m.buildQueryChild=function(a){var c,d,e,b=new Array;if("object"==typeof a)for(c in a){d=m.buildQueryChild(a[c]);for(e in d)c=x.encodeURL(c),b.push("["+c+"]"+d[e])}else a="="+x.encodeURL(a),b.push(a);return b},m.build=function(a){var b;if(a.protocol=a.scheme?a.scheme+"://":"",a.account=a.user||a.password?a.user+(a.password?":":"")+a.password+"@":"",a.domain=a.domainName||a.port?a.domainName+(a.port?":":"")+a.port:"",a.host=a.account||a.domain?a.protocol+a.account+a.domain+"/":"",a.path="",x.isArray(a.pathStruct)&&a.pathStruct.length){for(b in a.pathStruct)a.path+="file"==a.scheme?"/"+x.decodeURL(a.pathStruct[b]):"/"+x.encodeURL(a.pathStruct[b]);a.isFile||(a.path+="/")}if(""!=a.path&&(""==a.host&&""==a.protocol&&!a.isAbsolute||""!=a.host)&&(a.path=a.path.replace(/^\//g,"")),a.query="",x.isObject(a.queryStruct)&&Object.keys(a.queryStruct).length&&(a.query="?"+m.buildQuery(a.queryStruct)),a.fragmentPath="",x.isArray(a.fragmentPathStruct)&&a.fragmentPathStruct.length)for(b in a.fragmentPathStruct)a.fragmentPath+="/"+x.encodeURL(a.fragmentPathStruct[b]);a.fragmentQuery="",x.isObject(a.fragmentQueryStruct)&&Object.keys(a.fragmentQueryStruct).length&&(a.fragmentQuery="?"+m.buildQuery(a.fragmentQueryStruct)),""!=a.fragmentPath||!a.fragmentExist&&""==a.fragmentQuery||(a.fragmentPath="/"),a.fragment="",(""!=a.fragmentPath||""!=a.fragmentQuery)&&(a.fragment="#"+a.fragmentPath+a.fragmentQuery),a.location=""==a.host?a.protocol+a.path:a.host+a.path,a.link=a.location+a.query,a.href=a.link+a.fragment},n.prototype={constructor:n,isExists:function(){var a,b,c,d,e;if(""==this.file||""==this.type)return!1;if(a=!1,b={js:"script",css:"link"},c=b[this.type],void 0!=c){d=document.getElementsByTagName(c);for(e in d)if(d[e].href&&"-1"!=d[e].href.toString().indexOf(this.file)||d[e].src&&"-1"!=d[e].src.toString().indexOf(this.file)){a=!0;break}}return a},removeAll:function(){var a,b,c,d,e;if(""==this.file||""==this.type)return!1;if(a=!1,b={js:"script",css:"link"},c=b[this.type],void 0!=c){d=document.getElementsByTagName(c);for(e in d)(d[e].href&&"-1"!=d[e].href.toString().indexOf(this.file)||d[e].src&&"-1"!=d[e].src.toString().indexOf(this.file))&&(d[e].parentNode.removeChild(d[e]),a=!0)}return a},remove:function(){return"object"!=typeof this.element||!this.element.constructor||this.element.constructor!=HTMLLinkElement&&this.element.constructor!=HTMLScriptElement?!1:(this.element.parentNode&&this.element.parentNode.removeChild(this.element),!0)},isLoad:function(){return"object"!=typeof this.element||!this.element.constructor||this.element.constructor!=HTMLLinkElement&&this.element.constructor!=HTMLScriptElement?!1:this.element.parentNode?!0:!1},load:function(a){var b,c;return this.isExists()&&this.unique?!0:(this.element=void 0,o.createElement(this),"object"==typeof this.selector&&this.selector instanceof HTMLElement?b=this.selector:("string"==typeof this.selector||"number"==typeof this.selector)&&(c=document.querySelectorAll(this.selector),b=c.length&&c[0]?c[0]:void 0),"function"==typeof this.onError&&(this.element.onerror=this.onError),"function"==typeof this.onSuccess&&(this.element.onload=this.onSuccess),"function"==typeof a?(a.call(this,b),!0):b&&"function"==typeof b.appendChild?(b.appendChild(this.element),!0):!1)},onError:void 0,onSuccess:void 0},o.merge=function(a,b){var c,d,e;("string"==typeof b.file||"number"==typeof b.file)&&(a.file=b.file,"number"==typeof a.file&&(a.file=a.file.toString()),c=m(a.file),a.file=c.location,a.query=c.query),d="","string"==typeof b.type&&(d=x.trim(b.type.toLowerCase())),""==d&&""!=a.file&&(d=x.trim(a.file.split(".").pop().toLowerCase())),("css"==d||"js"==d)&&(a.type=d),""!=a.query&&(a.query=x.trim(a.query),a.query="?"+a.query.replace(/^\?{0,}/g,"")),("string"==typeof b.query||"number"==typeof b.query)&&(e=b.query,"number"==typeof e&&(e=e.toString()),e=x.trim(e),e=e.replace(/^\?{0,}/g,"").replace(/^\&{0,}/g,""),""!=a.query?a.query+="&"+e:a.query="?"+e),("string"==typeof b.charset||"number"==typeof b.charset)&&(a.charset=b.charset),"object"==typeof b.selector&&b.selector instanceof HTMLElement?a.selector=b.selector:("string"==typeof b.selector||"number"==typeof b.selector)&&(a.selector=b.selector)},o.createElement=function(a){if("css"===a.type)a.element=document.createElement("link"),a.element.rel="stylesheet",a.element.href=a.file+a.query,a.charset&&(a.element.charset=a.charset);else{if("js"!==a.type)return!1;a.element=document.createElement("script"),a.element.type="text/javascript",a.element.src=a.file+a.query,a.charset&&(a.element.charset=a.charset)}},p.prototype={constructor:p,request:function(){return q.send(this,this.method),this},post:function(){return q.send(this,"POST"),this},get:function(){return q.send(this,"GET"),this},abort:function(){return"undefined"!=typeof this.XMLHttpRequest&&"undefined"!=typeof this.XMLHttpRequest.abort&&this.XMLHttpRequest.abort(),this},onReady:function(){},onRequest:function(){},onResponse:function(){},onSuccess:function(){},onError:function(){}},q.merge=function(a,b){var c,d,e,f;"string"==typeof b.url&&(a.url=b.url),"string"==typeof b.method&&(c=x.trim(b.method.toUpperCase()),("POST"==c||"GET"==c)&&(a.method=c)),"undefined"!=typeof b.async&&(a.async=b.async?!0:!1),"undefined"!=typeof b.data&&(d=b.data,("string"==typeof b.data||"number"==typeof b.data)&&(d=m.parseQuery(b.data)),d&&"object"==typeof d&&(a.data=d)),b.header&&"object"==typeof b.header&&(a.header=b.header),"undefined"!=typeof b.timeout&&(e=parseInt(b.timeout),e&&!isNaN(e)&&(a.timeout=e)),"string"==typeof b.type&&(f=x.trim(b.type.toLowerCase()),("text"==f||"xml"==f||"json"==f)&&(a.type=f)),"function"==typeof b.onReady&&(a.onReady=b.onReady),"function"==typeof b.onRequest&&(a.onRequest=b.onRequest),"function"==typeof b.onSuccess&&(a.onSuccess=b.onSuccess),"function"==typeof b.onError&&(a.onError=b.onError),"function"==typeof b.onResponse&&(a.onResponse=b.onResponse)},q.createXMLHttpRequest=function(a){var b,c;if("undefined"!=typeof a.XMLHttpRequest&&"undefined"!=typeof a.XMLHttpRequest.abort&&a.XMLHttpRequest.abort(),a.XMLHttpRequest=void 0,window.XMLHttpRequest)a.XMLHttpRequest=new XMLHttpRequest;else if(window.ActiveXObject)for(b=["Microsoft.XMLHTTP","MSXML2.XMLHTTP"],c=0;c<b.length;c++)try{a.XMLHttpRequest=new ActiveXObject(b[c]);break}catch(d){a.onError.call(a,"您的浏览器不支持Ajax")}return!0},q.send=function(a,b){var c,d,e,f,g,h;if(q.createXMLHttpRequest(a),"undefined"==typeof a.XMLHttpRequest||"undefined"==typeof a.XMLHttpRequest.open)return!1;if(c={url:"",data:null,isTimeout:!1,setTimeoutId:null,errorExecuted:!1,error:function(a,b,c,d){return this.errorExecuted?!1:(this.errorExecuted=!0,"undefined"==typeof c&&(c=a.XMLHttpRequest.status),"undefined"==typeof d&&(d=a.XMLHttpRequest.statusText),a.onError.call(a,b,c,d))}},a.XMLHttpRequest.onreadystatechange=function(){var b,e,f,g;if(a.onReady.call(a,a.XMLHttpRequest.readyState),4==a.XMLHttpRequest.readyState){if(clearTimeout(c.setTimeoutId),b=void 0,"text"==a.type)b=a.XMLHttpRequest.responseText;else if("xml"==a.type)b=a.XMLHttpRequest.responseXML;else if("json"==a.type)try{b=""!==a.XMLHttpRequest.response?JSON.parse(a.XMLHttpRequest.response):{}}catch(d){b={},console.warn(d)}else b=a.XMLHttpRequest.response;return e=a.XMLHttpRequest.status,f=a.XMLHttpRequest.statusText,!c.isTimeout&&(e>=200&&300>e||304==e)?a.onSuccess.call(a,b,e,f):c.isTimeout?(a.XMLHttpRequest.fireEvent?a.XMLHttpRequest.fireEvent("ontimeout"):(g=document.createEvent("HTMLEvents"),g.initEvent("timeout",!1,!0),a.XMLHttpRequest.dispatchEvent(g)),f="The request timeout",c.error(a,"timeout",e,f)):setTimeout(function(){c.error(a,"error",e,f)},0),a.onResponse.call(a,b,e,f),!0}},a.XMLHttpRequest.onabort=function(){c.error(a,"abort")},a.XMLHttpRequest.onerror=function(){c.error(a,"error")},d=x.clone(a.header),"POST"==b?(c.url=a.url,a.data&&"object"==typeof a.data?"undefined"!=typeof FormData&&a.data.constructor==FormData?(c.data=a.data,"undefined"!=typeof d["Content-Type"]&&delete d["Content-Type"]):c.data=m.buildQuery(a.data):("string"==typeof a.data||"number"==typeof a.data)&&(c.data=String(a.data))):"GET"==b?("undefined"!=typeof a.data?(e=m(a.url),f=new Object,!a.data||"object"!=typeof a.data||"undefined"!=typeof FormData&&a.data.constructor==FormData?("string"==typeof a.data||"number"==typeof a.data)&&(f=m.parseQuery(a.data)):f=a.data,m.mergeStruct(e.queryStruct,f),c.url=m(e).href):c.url=a.url,c.data=null):(c.url=a.url,c.data=null),a.XMLHttpRequest.open(b,c.url,a.async),g=a.onRequest.call(a,a.XMLHttpRequest),!1===g)return a.XMLHttpRequest.abort(),!1;if(d&&"object"==typeof d)for(h in d)a.XMLHttpRequest.setRequestHeader(h,d[h]);x.isNumeric(a.timeout)&&(console.log("设置了超时时间",parseInt(a.timeout)),c.setTimeoutId=setTimeout(function(){4!=a.XMLHttpRequest.readyState&&(c.isTimeout=!0,a.XMLHttpRequest.onabort=null,a.XMLHttpRequest.abort(),clearTimeout(c.setTimeoutId))},parseInt(a.timeout))),a.XMLHttpRequest.send(c.data)},r.prototype={constructor:r,pageList:{back:new Array,forward:new Array,callback:function(){}},routerList:{back:new Array,forward:new Array,callback:function(){}}},s.prototype={constructor:s},t.prototype={constructor:t,debug:function(){return console.log(u.structs[this.index]),this},error:function(a){return w.triggerOnError("project",1,a),this},"new":function(a){return u.createChild(this,a)},ready:function(a){var b,c;return"function"==typeof a&&(b=this,c=setInterval(function(){return"undefined"==typeof u.prepares[b.index]?(clearInterval(c),a(),!0):void 0},0)),this},template:function(a){var b=u.structs[this.index];return"undefined"==typeof a?b.template:("number"==typeof a&&(a=String(a)),"string"==typeof a&&(b.template=a,"object"==typeof b.compiler&&b.compiler.template!=a&&(b.compiler=j(a))),this)},compiler:function(){return u.structs[this.index].compiler},selector:function(a){var b=u.structs[this.index];return"undefined"!=typeof a&&(b.selector=a,w.projectRenderSelectorCreate(this,a)),b.renderSelector},render:function(a){return w.projectRender(this,a),this},run:function(){return w.projectRun(this),this},start:function(){var a=u.structs[this.index];return a.runState=1,a.runEvent=!0,this},pause:function(){var a=u.structs[this.index];return a.runState=2,a.runEvent=!0,this},stop:function(){var a=u.structs[this.index];return a.runState=0,a.runEvent=!0,this},html:function(){var a=u.structs[this.index];return a.renderSelector?a.renderSelector.innerHTML:a.compiler?a.compiler.element.innerHTML:void 0},text:function(){var b,a=u.structs[this.index];if(a.renderSelector)b=a.renderSelector;else{if(!a.compiler)return void 0;b=a.compiler.element}return"undefined"!=typeof b.innerText?b.innerText:"undefined"!=typeof b.textContent?b.textContent:void 0},node:function(){var a=u.structs[this.index];return a.renderSelector?a.renderSelector:a.compiler?a.compiler.element:void 0},onPageBefore:null,onPageAfter:null,onPageNotFound:null,onPageChange:null,onProgress:null,onRouterChange:null,onIncludeBefore:null,onIncludeAfter:null,onLoadBefore:null,onLoadAfter:null,onReadyBefore:null,onReadyAfter:null,onRunBefore:null,onRunAfter:null,onRunStart:null,onRunPause:null,onRunStop:null,onRenderBefore:null,onRenderAfter:null,onRenderChange:null,onWindowResize:null,onWindowShow:null,onWindowHide:null,onError:null},u.autoIncrement=0,u.find=function(a){var b=w();
if("undefined"==typeof a){if(b.pageProject)return b.pageProject}else if("string"==typeof a&&b.project[a])return b.project[a];return void 0},u.create=function(a,b){var c=w();w.triggerOnLoad("onLoadBefore",a),c.project[a]=new t(a),u.setStruct(c.project[a],b),u.setData(c.project[a],b),u.setPrototype(c.project[a],b),u.prepares[c.project[a].index]=c.project[a],w.triggerOnLoad("onLoadAfter",a)},u.createChild=function(a,b){var d,c=w();return"string"!=typeof b&&"number"!=typeof b&&(b=u.getUniqueName(c)),"undefined"!=typeof c.project[b]?!1:(d=u.structs[a.index],u.create(b,d.struct),w.projectReady(c.project[b]),"undefined"!=typeof c.project[b]&&(a.children.push(c.project[b]),c.project[b].parent=a),c.project[b])},u.getUniqueName=function(a){for(var b=23,c="ABCDEFGHIJKLMNOPQRSTVUWXYZabcdefghijklmnopqrstvuwxyz1234567890",d=c.length,e="";;){for(e=(new Date).valueOf().toString(),i=0;b>i;i++)e+=c.charAt(Math.floor(Math.random()*d));if("undefined"==typeof a.project[e])break}return e},u.structs=new Object,u.prepares=new Object,u.setStruct=function(a,b){var c,d,e,f,g;if(u.structs[a.index]={struct:b,compiler:void 0,selector:"undefined"!=typeof b.selector?b.selector:void 0,include:new Object,includeState:!1,extend:x.isArray(b.extend)?b.extend:new Array,template:"string"==typeof b.template||"number"==typeof b.template?String(b.template):void 0,renderSelector:null,renderCount:0,runEvent:!1,runState:1,runInterval:null,runCount:0},x.isArray(b.include))for(c in b.include)d=void 0,e=void 0,"string"==typeof b.include[c]?d=w.getIncludeResource(b.include[c]):b.include[c]&&"string"==typeof b.include[c].file&&(f="string"==typeof b.include[c].type?x.trim(b.include[c].type):void 0,g="undefined"!=typeof b.include[c].selector?b.include[c].selector:void 0,d=w.getIncludeResource(b.include[c].file,f,g,b.include[c].async),"function"==typeof b.include[c].callback&&(e=b.include[c].callback)),d&&(u.structs[a.index].include[d.index]={file:d,callback:e})},u.setData=function(a,b){"function"==typeof b.data?(b.data.prototype.constructor=Object,a.data=new b.data):x.isObject(b.data)&&(a.data=x.clone(b.data))},u.setPrototype=function(a,b){if(b)for(var c in b)0===c.indexOf("on")&&"undefined"!=typeof t.prototype[c]&&(a[c]=b[c])},v.prototype={constructor:v,includeSelector:"action",includeQueryTime:!1,renderSelector:"view",historyPageMaximum:10,historyRouterMaximum:10,debug:!1,version:"2.0.0",onPage:null,onPageBefore:null,onPageAfter:null,onPageNotFound:null,onPageChange:null,onProgress:null,onRouterChange:null,onIncludeBefore:null,onIncludeAfter:null,onLoadBefore:null,onLoadAfter:null,onReadyBefore:null,onReadyAfter:null,onRunBefore:null,onRunAfter:null,onRunStart:null,onRunPause:null,onRunStop:null,onRenderBefore:null,onRenderAfter:null,onRenderChange:null,onWindowResize:null,onWindowShow:null,onWindowHide:null,onError:null},w.instance=void 0,w.setPrototype=function(a){if(a)for(var b in a)"constructor"!=b&&("page"==b?w.setPage(a[b]):"undefined"!=typeof v.prototype[b]&&(w.instance[b]=a[b]))},w.setPage=function(a){var b,c,d;if(a&&"object"==typeof a){b=m();for(c in a)a[c]&&"object"==typeof a[c]&&(d={file:"string"!=typeof a[c].file?void 0:a[c].file,project:"string"!=typeof a[c].project?void 0:a[c].project,callback:"function"!=typeof a[c].callback?void 0:a[c].callback,router:void 0},d.router=""===c?m(b.link):m(b.link,"#"+c),d.router.fragmentQueryStruct=new Object,d.router=m(d.router),w.instance.page[d.router.href]=d)}},w.resourceAutoIncrement=0,w.checkPageProject=function(a){return w.instance.pageProject&&w.instance.pageProject.index==a.index?!0:!1},w.setInclude=function(a,b,c,d){a.constructor==n?(w.triggerOnInclude("onIncludeBefore","loader",a),a.onSuccess=function(c){w.triggerOnInclude("onIncludeAfter","loader",a),b(c)},a.onError=function(b){a.remove(),w.triggerOnError("include",1,"“"+a.file+"” 文件引入异常"),w.triggerOnInclude("onIncludeAfter","loader",a),c(b)},a.load(d)):a.constructor==p&&(w.triggerOnInclude("onIncludeBefore","ajax",a),a.onSuccess=function(c,d,e){w.triggerOnInclude("onIncludeAfter","ajax",a),b(c,d,e)},a.onError=function(b,d,e){w.triggerOnError("include",1,"“"+a.url+"” 文件引入异常:"+JSON.stringify({type:b,status:d,statusText:e})),w.triggerOnInclude("onIncludeAfter","ajax",a),c(b,d,e)},a.get())},w.getIncludeResource=function(a,b,c,d){var f,g,h,e=m(a);if("string"!=typeof b&&(b=x.trim(e.location.split(".").pop().toLowerCase()),"js"!=b&&"css"!=b&&"json"!=b&&(b="text")),"undefined"==typeof w.instance.include[b]&&(w.instance.include[b]=new Object),f=w.instance.include[b],"undefined"==typeof f[e.location]){if("js"==b||"css"==b){if("object"==typeof c&&c instanceof HTMLElement)g=c;else{if("string"!=typeof c&&"number"!=typeof c&&(c=w.getIncludeSelector()),h=document.querySelectorAll(c),!h.length||!h[0])return w.triggerOnError("include",1,"在 document 中没有找到“"+c+"”筛选元素，无法引入文件"),void 0;g=h[0]}f[e.location]={type:b,isExecute:!1,error:!1,async:d?!0:!1,location:e.location,resource:o({file:a,query:w.getIncludeQuery(),selector:g,type:b})}}else{if("json"!=b&&"text"!=b)return void 0;f[e.location]={data:void 0,type:b,isExecute:!1,error:!1,async:d?!0:!1,location:e.location,resource:q({url:a,data:w.getIncludeQuery(),method:"GET",async:!0,type:b})}}Object.defineProperty(f[e.location],"index",{value:w.resourceAutoIncrement,writable:!1,configurable:!1}),w.resourceAutoIncrement++}return f[e.location]},w.getIncludeSelector=function(){var a=v.prototype.includeSelector;return("string"==typeof w.instance.includeSelector||"number"==typeof w.instance.includeSelector)&&(a=w.instance.includeSelector),a},w.getRenderSelector=function(){var a=v.prototype.renderSelector;return("string"==typeof w.instance.renderSelector||"number"==typeof w.instance.renderSelector)&&(a=w.instance.renderSelector),a},w.getIncludeQuery=function(){var c,a={},b=v.prototype.version;return("string"==typeof w.instance.version||"number"==typeof w.instance.version)&&(b=w.instance.version),c=v.prototype.includeQueryTime,"undefined"!=typeof w.instance.includeQueryTime&&(c=w.instance.includeQueryTime?!0:!1),""!==b&&(a["version"]=b),c&&(a["time"]=x.date("yyyy.MM.dd.hh.mm.ss.S",(new Date).getTime())),m.buildQuery(a)},w.getHistoryPageMaximum=function(){var b,a=v.prototype.historyPageMaximum;return"undefined"!=typeof w.instance.historyPageMaximum&&(b=Number(w.instance.historyPageMaximum),isNaN(b)||(a=b)),a},w.getHistoryRouterMaximum=function(){var b,a=v.prototype.historyRouterMaximum;return"undefined"!=typeof w.instance.historyRouterMaximum&&(b=Number(w.instance.historyRouterMaximum),isNaN(b)||(a=b)),a},w.trigger=function(a,b,c){for(var d in a)if(a[d]===b){"function"==typeof w.instance[a[d]]&&w.instance[a[d]](c),c.project&&"function"==typeof c.project[a[d]]&&c.project[a[d]](c);break}},w.triggerOnPage=function(a,b,c,d,e){var g,f=new s({type:"page",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,router:b,page:c,accept:d,ignore:e});"onPage"===a?"function"==typeof w.instance.onPage?w.instance.onPage(f):c():"onPageChange"===a?"function"==typeof w.instance.onPageChange?(f.project&&"function"==typeof f.project.onPageChange&&(f.accept=function(){f.accept=d,f.project.onPageChange(f)}),w.instance.onPageChange(f)):f.project&&"function"==typeof f.project.onPageChange?f.project.onPageChange(f):d():(g=["onPageNotFound","onPageBefore","onPageAfter"],w.trigger(g,a,f))},w.triggerOnProgress=function(a,b){var c=new s({type:"progress",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,total:10,loaded:b}),d=["onProgress"];w.trigger(d,a,c)},w.triggerOnRouter=function(a,b){var c=new s({type:"router",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,router:b}),d=["onRouterChange"];w.trigger(d,a,c)},w.triggerOnInclude=function(a,b,c){var d=new s({type:"include",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,module:b,resource:c}),e=["onIncludeBefore","onIncludeAfter"];w.trigger(e,a,d)},w.triggerOnLoad=function(a,b){var c=new s({type:"ready",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,loadProjectName:b}),d=["onLoadBefore","onLoadAfter"];w.trigger(d,a,c)},w.triggerOnReady=function(a,b){var c=new s({type:"ready",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,readyProject:b}),d=["onReadyBefore","onReadyAfter"];w.trigger(d,a,c)},w.triggerOnRun=function(a,b,c,d){var f,g,h,i,e=new s({type:"run",target:a,runtime:w.instance.runtime,project:b,state:c});f="undefined"==typeof d||"boolean"!=typeof d?[w.instance,b]:d?[b]:[w.instance],g=["onRunBefore","onRunStart","onRunPause","onRunStop","onRunAfter"];for(h in g)if(g[h]===a){for(i in f)f[i]&&"function"==typeof f[i][g[h]]&&f[i][g[h]](e);break}},w.triggerOnRender=function(a,b,c,d){var e=new s({type:"render",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,renderProject:b,abstractNodeTree:c,trigger:d}),f=["onRenderBefore","onRenderChange","onRenderAfter"];w.trigger(f,e.target,e)},w.triggerOnWindow=function(a,b,c,d){var f,e=new s({type:"window",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,width:c,height:d,visibility:b});"visibility"===a&&("hidden"===b?e.target="onWindowHide":"visible"===b&&(e.target="onWindowShow")),f=["onWindowResize","onWindowHide","onWindowShow"],w.trigger(f,e.target,e)},w.triggerOnError=function(a,b,c){var d=new s({type:"error",target:a,runtime:w.instance.runtime,project:w.instance.pageProject,code:b,message:c}),e=["onError"];w.trigger(e,"onError",d)},w.monitorWindowVisibility=function(){var b={hidden:null,change:null,eventListener:function(){w.triggerOnWindow("visibility",document.visibilityState,a.innerWidth,a.innerHeight)}};return"undefined"!=typeof document.hidden?(b.hidden="hidden",b.change="visibilitychange"):"undefined"!=typeof document.mozHidden?(b.hidden="mozHidden",b.change="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(b.hidden="msHidden",b.change="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(b.hidden="webkitHidden",b.change="webkitvisibilitychange"),b.hidden&&b.change?(document.addEventListener?(document.addEventListener(b.change,b.eventListener,!1),document.removeEventListener(b.change,b.eventListener,!0)):document.attachEvent?document.attachEvent("on"+b.change,b.eventListener):document["on"+b.change]=b.eventListener,!0):!1},w.monitorWindowClose=function(){},w.monitorIntervalId=null,w.monitor=function(){var b,c,d,e,f;return w.monitorIntervalId?!1:(w.monitorWindowVisibility(),w.monitorWindowClose(),b=m(),c=null,r("page",b),r("router",b),d=a.innerWidth,e=a.innerHeight,f=null,w.monitorIntervalId=setInterval(function(){c||(c=setTimeout(function(){var d,e,a=m();b.fragmentPath!==a.fragmentPath?(d=function(){r("page",a),r("router",a),b=a,c=null,w.page()},e=function(){b.fragmentExist||(b.fragmentExist=!0,b=m(b)),b.request(),c=null},w.triggerOnPage("onPageChange",a,void 0,d,e)):b.fragment!==a.fragment?(r("router",a),b=a,c=null,w.triggerOnRouter("onRouterChange",a)):c=null},0)),f||(f=setTimeout(function(){var b,c;f=null,b=a.innerHeight,c=a.innerWidth,(b!=e||c!=d)&&(e=b,d=c,w.triggerOnWindow("onWindowResize",document.visibilityState,c,b))},0))},0),void 0)},w.page=function(a){var b,c,d;w.instance.pageProject&&(b=u.structs[w.instance.pageProject.index],b.compiler&&(b.compiler.observerState=!1)),w.instance.runtime=(new Date).valueOf(),w.instance.pageProject=void 0,w.instance.pageRouter=void 0,w.instance.isPageFirstLoad=a?!0:!1,c=m(),w.triggerOnProgress("onProgress",1),w.triggerOnPage("onPageBefore",c),c.fragmentQueryStruct=new Object,c=m(c),"undefined"==typeof w.instance.page[c.href]?(d=function(a){w.pageLoad(a,c)},w.triggerOnPage("onPage",c,d)):w.pageLoad(w.instance.page[c.href],c)},w.pageLoad=function(a,b){var d,e,f,g;return!a||"string"!=typeof a.project&&"number"!=typeof a.project?(w.triggerOnError("page",1,"“"+b.href+"” 页面不存在"),w.triggerOnPage("onPageNotFound",b),w.pageEnd(),!1):(w.triggerOnProgress("onProgress",2),a.file&&"string"==typeof a.file?(d=w.getIncludeResource(a.file,"js"))?d.resource.isLoad()?w.pageProject(a.project,b):(d.isExecute=!0,e=function(){return w.instance.isPageFirstLoad?(console.warn("防止暴力刷新，页面守护启动!......更多技术支持："+c),d.isExecute=!1,w.page(),!1):(w.triggerOnError("page",1,"工程名称为 “"+a.project+"” 的页面，工程文件 “"+b.href+"” 加载失败！"),w.triggerOnPage("onPageNotFound",b),w.pageEnd(),void 0)},f=function(){return w.pageProject(a.project,b)},g="function"==typeof a.callback?a.callback:void 0,w.setInclude(d.resource,f,e,g),void 0):!1:w.pageProject(a.project,b))},w.pageEnd=function(){w.triggerOnProgress("onProgress",9),w.triggerOnPage("onPageAfter",w.instance.pageRouter),w.triggerOnProgress("onProgress",10)},w.pageProject=function(a,b){return"undefined"==typeof w.instance.project[a]?(w.triggerOnError("project",1,"工程名称为 “"+a+"” 的页面不存在"),w.triggerOnPage("onPageNotFound",b),w.pageEnd(),!1):(w.triggerOnProgress("onProgress",3),w.instance.pageProject=w.instance.project[a],w.instance.pageRouter=b,w.projectPrepares(function(){return w.projectRun(w.instance.pageProject)}),void 0)},w.projectPrepares=function(a){for(var b in u.prepares)return w.projectReady(u.prepares[b],function(){return w.projectPrepares(a)});return a?a():void 0},w.projectReady=function(a,b){w.triggerOnReady("onReadyBefore",a),w.projectReadyStart(a,b)},w.projectReadyStart=function(a,b){var c,d,e,f,g;if("undefined"==typeof u.prepares[a.index])return b?b():void 0;if(c=u.structs[a.index],!c.includeState){for(d in c.include)if(!c.include[d].file.isExecute){if(c.include[d].file.isExecute=!0,!c.include[d].file.async)return w.projectReadyInclude(c.include[d],a,b);w.projectReadyInclude(c.include[d],a,b)}c.includeState=!0}if(c.extend.length){for(d in c.extend)if(e=w.instance.project[c.extend[d]],e&&"undefined"!=typeof u.prepares[e.index])return w.projectReady(e,function(){return w.projectReadyStart(a,b)});for(d in c.extend)if(e=w.instance.project[c.extend[d]],"undefined"!=typeof e){for(f in e)0===f.indexOf("on")&&"function"!=typeof a[f]&&"function"==typeof e[f]&&(a[f]=e[f]);for(f in e.data)"undefined"==typeof a.data[f]&&(a.data[f]=x.clone(e.data[f]));g=u.structs[e.index],"undefined"==typeof c.selector&&"undefined"!=typeof g.selector&&(c.selector=g.selector),"undefined"==typeof c.template&&"string"==typeof g.template&&(c.template=g.template)}else w.triggerOnError("project",1,"当前工程名称为 “"+a.name+"” 继承 父级工程名称为“"+c.extend[d]+"” 失败！av('"+c.extend[d]+"') 工程不存在！")}return"undefined"==typeof c.template&&(c.template=""),delete u.prepares[a.index],w.triggerOnReady("onReadyAfter",a),b?b():void 0},w.projectReadyInclude=function(a,b,c){var g,h,d=a.file.resource,e=a.file.async,f=a.callback;return e?(g=function(){a.file.error=!0},h=d.constructor==n?function(){}:function(c){a.file.data=c,"function"==typeof f&&f.call(b,c)}):(g=function(){return a.file.error=!0,w.projectReadyStart(b,c)},h=d.constructor==n?function(){return w.projectReadyStart(b,c)}:function(d){return a.file.data=d,"function"==typeof f&&f.call(b,d),w.projectReadyStart(b,c)}),w.setInclude(d,h,g,f)},w.projectRun=function(a){w.triggerOnProgress("onProgress",4);var b=u.structs[a.index];b.runCount++,b.runState=1,w.triggerOnRun("onRunBefore",a,b.runState,!1),w.projectRunState(a,function(){w.triggerOnProgress("onProgress",5),w.triggerOnRun("onRunBefore",a,b.runState,!0),w.projectRunState(a,function(){w.triggerOnProgress("onProgress",6),w.projectRender(a),w.projectRunState(a,function(){w.triggerOnProgress("onProgress",7),w.triggerOnRun("onRunAfter",a,b.runState,!1),w.projectRunState(a,function(){w.triggerOnProgress("onProgress",8),w.triggerOnRun("onRunAfter",a,b.runState,!0),w.projectRunState(a,function(){w.pageEnd()})})})})})},w.projectRunState=function(a,b){var c=u.structs[a.index];return w.checkPageProject(a)?1==c.runState?(c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunStart",a,c.runState)),b()):2!=c.runState?(console.log("【工程运行状态】已关闭！","工程ID："+a.name),c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunStop",a,c.runState)),w.pageEnd(),!1):(c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunPause",a,c.runState)),c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),c.runInterval=setInterval(function(){return w.checkPageProject(a)?2==c.runState?(c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunPause",a,c.runState)),!0):(c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),1==c.runState?(c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunStart",a,c.runState)),b()):(c.runEvent&&(c.runEvent=!1,w.triggerOnRun("onRunStop",a,c.runState)),w.pageEnd(),!1)):(c.runInterval&&(clearInterval(c.runInterval),c.runInterval=null),!1)},0),void 0):!1},w.projectRender=function(a,b){w.triggerOnRender("onRenderBefore",a);var c=u.structs[a.index];"object"!=typeof c.compiler&&(c.compiler=j(c.template)),c.compiler.observerState=!0,b||(b=new Object),b.refresh=b.refresh?!0:!1,b.reload=b.reload?!0:!1,(!c.renderSelector||b.reload)&&w.projectRenderSelectorCreate(a,b.selector),w.projectRenderSelectorClear(c.renderSelector,c.compiler,b.reload),c.compiler.render(a.data,{selector:c.renderSelector,refresh:b.refresh,onChange:function(b,c){w.triggerOnRender("onRenderChange",a,b,c)}}),w.triggerOnRender("onRenderAfter",a)},w.projectRenderSelectorClear=function(a,b,c){if("object"!=typeof a)return!1;if(!c&&b){var d=g.getValidAbstractNodeTree(a,b.abstractNodeTree);if(d)return!0}for(;a.childNodes.length;)a.removeChild(a.firstChild)},w.projectRenderSelectorCreate=function(a,b){var d,e,c=u.structs[a.index];if(d=b&&"undefined"!=typeof b?b:"undefined"!=typeof c.selector?c.selector:w.getRenderSelector(),c.renderSelector=void 0,"object"==typeof d&&d instanceof HTMLElement)c.renderSelector=d;else if("string"==typeof d||"number"==typeof d)try{e=document.querySelectorAll(d),e.length&&e[0]&&(c.renderSelector=e[0])}catch(f){w.triggerOnError("render",1,"筛选器错误："+f)}},x.prototype={constructor:x},x.version="2.0.0",x.author=c,x.js="av.js 全称 Action View for JavaScript，是JavaScript操作视图的小引擎、SPA架构小框架！v"+x.version,x.framework=function(){return w.apply(w,arguments)},x.project=function(){return u.apply(u,arguments)},x.compiler=function(){return j.apply(j,arguments)},x.router=function(){return m.apply(m,arguments)},x.loader=function(){return o.apply(o,arguments)},x.ajax=function(){return q.apply(q,arguments)},x.trim=function(a){return x.isString(a)&&(a=a.replace(/(^\s+)|(\s+$)/g,"")),a},x.clone=function(a){var b,c;if(x.isArray(a))for(b=new Array,c=0;c<a.length;c++)x.isArray(a)||x.isObject(a)?b.push(x.clone(a[c])):b.push(a[c]);else if(x.isObject(a)){b=new Object;for(c in a)b[c]=x.isArray(a)||x.isObject(a)?x.clone(a[c]):a[c]}else b=a;return b},x.isArray=function(a){return null===a||"object"!=typeof a||a.constructor!=Array?!1:!0},x.isObject=function(a){return null===a||"object"!=typeof a||a.constructor!=Object?!1:!0},x.isString=function(a){return null===a||"string"!=typeof a?!1:!0},x.isNumber=function(a){return null===a||"number"!=typeof a?!1:!0},x.isNumeric=function(a){return null===a||"number"!=typeof a&&"string"!=typeof a?!1:/^[0-9]+$|^[0-9]+\.[0-9]+$/.test(a)},x.encodeURL=function(a){var b,c,d;if(0==arguments.length)return null;if(!a)return a;if(x.isArray(a)){for(b=new Array,c=0;c<a.length;c++)b[c]=x.encodeURL(a[c]);return b}if(x.isObject(a)){d=new Object;for(c in a)d[x.encodeURL(c)]=x.encodeURL(a[c]);return d}return x.isString(a)?encodeURIComponent(a):a},x.decodeURL=function(a){var b,c,d;if(0==arguments.length)return null;if(!a)return a;if(x.isArray(a)){for(b=new Array,c=0;c<a.length;c++)b[c]=x.decodeURL(a[c]);return b}if(x.isObject(a)){d=new Object;for(c in a)d[x.decodeURL(c)]=x.decodeURL(a[c]);return d}return x.isString(a)?decodeURIComponent(a):a},x.encodeHTML=function(a){var b,c;return 0==arguments.length?null:"string"!=typeof a?a:(b=document.createElement("DIV"),b.innerText?b.innerText=a:b.textContent=a,c=b.innerHTML,b=null,c=c.replace(/\'/g,"&apos;").replace(/\"/g,"&quot;"))},x.decodeHTML=function(a){var b,c;return 0==arguments.length?null:"string"!=typeof a?a:(b=document.createElement("DIV"),b.innerHTML=a,c=b.innerText||b.textContent,b=null,c)},x.date=function(a,b){var c,d,e,f;c=b?new Date(b):new Date,d={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":0==c.getHours()%12?12:c.getHours()%12,"H+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()},e={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(a)&&(a=a.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+e[c.getDay()+""]));for(f in d)new RegExp("("+f+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?d[f]:("00"+d[f]).substr((""+d[f]).length)));return decodeURI(a)},x.byte=function(a,b){var c,d,e;return isNaN(a)?"":(c=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(a)/Math.log(2)),1>d&&(d=0),e=Math.floor(d/10),a/=Math.pow(2,10*e),a.toString().length>a.toFixed(2).toString().length&&(a=a.toFixed(2)),"string"!=typeof b&&(b=""),a+b+c[e])},x.triggerClick=function(a){var c,b="Microsoft Internet Explorer"==navigator.appName?!0:!1;b?a.click():(c=document.createEvent("MouseEvents"),c.initEvent("click",!0,!0),a.dispatchEvent(c))},x.getFileURL=function(a){var b="";try{void 0!=window.createObjectURL?b=window.createObjectURL(a):void 0!=window.URL?b=window.URL.createObjectURL(a):void 0!=window.webkitURL&&(b=window.webkitURL.createObjectURL(a))}catch(c){b=""}return b},x.setWindowTitle=function(a,b){if(x.isString(a)||x.isNumber(a)||(a=""),document.title==a)return!1;if(document.title=a,"string"==typeof b){var c=document.createElement("iframe");c.style["left"]="-99999px",c.style["position"]="absolute",c.src=b,c.onload=function(){document.body.removeChild(c)},document.body.appendChild(c)}return!0},a.av=x}(window,document,"wangaho@anditogether.com");